在 Nuxt 3 项目中配置和使用环境变量主要通过以下几种方式：

1. **`.env` 文件**
2. **`runtimeConfig` (运行时配置)**
3. **`app.config` (应用配置 - 主要用于构建时确定的公共变量)**

最常用且推荐的方式是结合使用 `.env` 文件和 `runtimeConfig`。

**详细步骤:**

**1. 创建 `.env` 文件**

在你的 Nuxt 项目根目录下创建一个 `.env` 文件。Nuxt 会自动加载这个文件中的变量。你还可以根据不同的环境创建特定的文件，例如：

- `.env`: 默认加载，会被其他环境的 `.env` 文件覆盖。
- `.env.development`: 仅在开发环境 (`npm run dev`) 加载。
- `.env.production`: 仅在生产环境 (`npm run build` 后 `npm run start` 或部署时) 加载。

在 `.env` 文件中定义你的环境变量，格式为 `KEY=VALUE`：

Bash

```
# .env 文件示例

# 这个变量只在服务器端可用 (默认)
API_SECRET=这是我的秘密API密钥

# 这个变量在服务器端和客户端都可用 (需要 NUXT_PUBLIC_ 前缀)
NUXT_PUBLIC_API_BASE_URL=https://api.example.com
NUXT_PUBLIC_SITE_NAME=我的Nuxt网站
```

**注意:**

- 只有以 `NUXT_` 开头的变量（或在 `nuxt.config.ts` 中显式配置的变量）才会被 `runtimeConfig` 识别。
- 要在客户端（浏览器）也能访问的环境变量，必须以 `NUXT_PUBLIC_` 开头。**永远不要**将敏感信息（如私钥、密码）放在以 `NUXT_PUBLIC_` 开头的变量中。

**2. 配置 `nuxt.config.ts`**

你需要编辑项目根目录下的 `nuxt.config.ts` 文件，定义哪些环境变量应该通过 `runtimeConfig` 暴露给你的应用程序。

TypeScript

```ts
// nuxt.config.ts
export default defineNuxtConfig({
  // 运行时配置
  runtimeConfig: {
    // 只在服务器端可用的私有键 (可以从 .env 读取，无需 NUXT_ 前缀，因为它们是在这里显式声明的)
    // .env 文件中的 API_SECRET 会覆盖这里的默认值 '默认密钥'
    apiSecret: process.env.API_SECRET || '默认密钥', 

    // public 中的键在客户端也可访问
    public: {
      // .env 文件中的 NUXT_PUBLIC_API_BASE_URL 会覆盖这里的默认值
      apiBase: process.env.NUXT_PUBLIC_API_BASE_URL || '/api', 
      // 也可以直接定义，不一定非要来自 .env
      siteName: process.env.NUXT_PUBLIC_SITE_NAME || '默认网站名' 
    }
  },

  // 其他 Nuxt 配置...
  devtools: { enabled: true }
})
```

**解释:**

- `runtimeConfig`: 这个对象用来定义运行时可访问的变量。
- `runtimeConfig` 的顶层属性 (如 `apiSecret`): 这些变量**默认只在服务器端可用**。Nuxt 会尝试从 `process.env` 中读取同名变量（这里是 `API_SECRET`）。如果环境变量未设置，则会使用你在 `nuxt.config.ts` 中提供的默认值（`'默认密钥'`）。
- `runtimeConfig.public`: 这个对象里的属性 (如 `apiBase`, `siteName`) **在服务器端和客户端都可以访问**。Nuxt 会尝试从 `process.env` 中读取对应的 `NUXT_PUBLIC_` 前缀的变量（如 `NUXT_PUBLIC_API_BASE_URL`）。同样，如果环境变量未设置，则使用 `nuxt.config.ts` 中的默认值。

**3. 在你的应用中使用环境变量**

在你的页面 (`pages/`)、组件 (`components/`)、插件 (`plugins/`) 或 API 路由 (`server/api/`) 中，你可以使用 `useRuntimeConfig()` 这个 composable 函数来访问配置好的环境变量。

代码段

```vue
<template>
  <div>
    <h1>{{ config.public.siteName }}</h1>
    <p>API Base URL (公开): {{ config.public.apiBase }}</p>
    <button @click="fetchData">获取数据 (需要服务器端密钥)</button>
    <pre>{{ data }}</pre>
  </div>
</template>

<script setup>
import { ref } from 'vue'
// 引入 useRuntimeConfig
const config = useRuntimeConfig()
const data = ref(null)

// 在 setup 函数中可以直接访问
console.log('网站名称 (客户端/服务器端):', config.public.siteName)
console.log('API Base (客户端/服务器端):', config.public.apiBase) 
// 注意：直接在 setup (客户端执行部分) 访问非 public 的 config.apiSecret 会得到 undefined
// console.log('API Secret (客户端):', config.apiSecret) // -> 输出 undefined

async function fetchData() {
  // 可以在客户端发起请求到服务器路由，由服务器路由使用密钥
  try {
    // 调用我们自己的服务器 API 路由，这个路由在服务器端运行，可以访问 apiSecret
    const response = await $fetch('/api/mydata') 
    data.value = response
  } catch (error) {
    console.error('获取数据失败:', error)
    data.value = { error: '获取数据失败' }
  }
}

// 如果需要在 <script setup> 的服务器端部分（例如，在 useAsyncData 或服务器中间件）访问私有密钥
// const { data: serverData } = await useAsyncData('server-info', () => {
//   console.log('API Secret (服务器端 in useAsyncData):', config.apiSecret)
//   // 这里可以使用 config.apiSecret 进行服务器端操作
//   return Promise.resolve({ secretInfo: `密钥长度: ${config.apiSecret?.length}` })
// })
// console.log(serverData.value)

</script>
```

TypeScript

```ts
// server/api/mydata.ts (示例 API 路由)
export default defineEventHandler(async (event) => {
  // 在服务器路由中，可以安全地访问所有 runtimeConfig 变量
  const config = useRuntimeConfig(event) // 在服务器事件处理程序中传递 event

  console.log('在服务器 API 中访问 API Secret:', config.apiSecret)
  console.log('在服务器 API 中访问 Public API Base:', config.public.apiBase)

  // 假设你需要使用 API 密钥调用外部服务
  // const externalApiResponse = await $fetch('https://external.service/data', {
  //   headers: {
  //     'Authorization': `Bearer ${config.apiSecret}`
  //   }
  // })

  // 返回一些数据
  return {
    message: '成功从服务器获取数据',
    site: config.public.siteName,
    // 不要直接返回密钥！这里只是演示可以访问
    secretUsed: !!config.apiSecret 
  }
})
```

**总结:**

1. **定义变量:** 在 `.env` 文件中定义变量。使用 `NUXT_PUBLIC_` 前缀指定客户端可访问的变量。
2. **暴露变量:** 在 `nuxt.config.ts` 的 `runtimeConfig` 中声明需要使用的变量，并指定哪些是 `public` 的。可以设置默认值。
3. **使用变量:** 在应用代码中通过 `useRuntimeConfig()` 来访问这些变量。记住 `public` 下的变量前后端都可访问，顶层的变量（非 `public` 下）只在服务器端可访问。

**关于 `app.config.ts` (简要说明)**

还有一个 `app.config.ts` 文件，它用于定义**构建时确定**且**完全公开**的配置。这些配置会被打包到最终的 JavaScript 代码中。它通常用于主题配置、网站标题等不太可能随环境变化或不需要保密的信息。它**不适合**存放像 API 密钥这样的敏感信息，并且它的值通常不直接由 `.env` 文件驱动（虽然可以通过脚本在构建前修改它）。

TypeScript

```ts
// app.config.ts (示例)
export default defineAppConfig({
  // 这个配置在构建时确定，并且完全公开
  theme: {
    primaryColor: 'blue'
  },
  siteTitle: '我的应用'
})

// 在组件中使用:
// const appConfig = useAppConfig()
// console.log(appConfig.theme.primaryColor) // -> 'blue'
```

对于大多数需要根据部署环境（开发、生产）变化的配置（如 API 地址、密钥），`runtimeConfig` 结合 `.env` 文件是更常用和推荐的方式。