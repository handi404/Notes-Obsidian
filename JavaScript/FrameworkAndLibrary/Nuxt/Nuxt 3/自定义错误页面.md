在 Nuxt 3 中创建**自定义错误页面**。

当你的 Nuxt 应用遇到无法处理的错误时（比如访问了不存在的页面导致 404 Not Found，或者服务端渲染时 API 请求失败导致 500 Internal Server Error），Nuxt 需要显示一个错误提示页面。默认情况下，Nuxt 会提供一个基础的错误页面，但通常你会希望用一个符合你网站设计、更友好的页面来替代它。

**核心机制：根目录下的 `error.vue` 文件**

与 Nuxt 2 不同（Nuxt 2 使用 `layouts/error.vue`），**Nuxt 3** 的方式更加直接：

1.  **创建 `error.vue` 文件**：在你的 Nuxt 项目的**根目录**下（与 `app.vue`, `nuxt.config.ts` 同级），创建一个名为 `error.vue` 的文件。
    ```
    your-nuxt-project/
    ├── app.vue
    ├── nuxt.config.ts
    ├── package.json
    ├── pages/
    ├── components/
    ├── layouts/
    └── error.vue  <-- 就是这个文件！
    ```

2.  **编写错误页面组件**：这个 `error.vue` 文件就是一个普通的 Vue 组件。Nuxt 会在捕获到未处理的错误时，自动渲染这个组件。

**关键：接收错误信息 (`error` Prop)**

为了在你的自定义错误页面中显示相关的错误信息（比如错误状态码、错误消息），Nuxt 会自动将一个包含错误详情的**对象**作为名为 `error` 的 **prop** 传递给你的 `error.vue` 组件。

你需要使用 `defineProps` 来接收这个 prop：

```vue
<!-- error.vue -->
<template>
  <div class="error-page">
    <!-- 根据状态码显示不同内容 -->
    <div v-if="error.statusCode === 404">
      <h1>😕 页面未找到 (404)</h1>
      <p>抱歉，我们找不到您要访问的页面：<code>{{ error.url || $route.path }}</code></p>
      <p>也许您可以尝试返回首页？</p>
    </div>
    <div v-else>
      <h1>😟 发生错误 ({{ error.statusCode }})</h1>
      <p>抱歉，服务器或应用内部出现了一些问题。</p>
      <p>{{ error.message || '未知错误' }}</p>
      <!-- 在开发模式下可以显示堆栈信息 -->
      <pre v-if="isDevelopment && error.stack">{{ error.stack }}</pre>
      <p>您可以尝试刷新页面，或返回首页。</p>
    </div>

    <button @click="handleErrorClear">返回首页</button>
  </div>
</template>

<script setup>
// 接收 Nuxt 传递过来的 error 对象 prop
const props = defineProps({
  error: {
    type: Object,
    required: true
  }
});

// 判断是否为开发环境，可选
const isDevelopment = process.dev;

// 获取 Nuxt 提供的 clearError 工具函数
const handleErrorClear = () => {
  // clearError 会清除当前的 Nuxt 错误状态，并可以重定向用户
  clearError({ redirect: '/' }); // 重定向到首页
};

// 可选：设置页面标题
useHead({
  title: `错误 ${props.error.statusCode}`,
});
</script>

<style scoped>
.error-page {
  padding: 2rem;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 80vh; /* 让内容垂直居中 */
}
.error-page h1 {
  color: #e74c3c; /* 红色 */
  margin-bottom: 1rem;
}
.error-page p {
  margin-bottom: 1rem;
  color: #555;
}
.error-page code {
  background-color: #f0f0f0;
  padding: 2px 5px;
  border-radius: 3px;
}
.error-page button {
  padding: 0.8rem 1.5rem;
  background-color: #3498db; /* 蓝色 */
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
  transition: background-color 0.3s ease;
}
.error-page button:hover {
  background-color: #2980b9;
}
.error-page pre {
  background-color: #f5f5f5;
  padding: 1rem;
  border-radius: 4px;
  overflow-x: auto; /* 水平滚动 */
  text-align: left;
  max-width: 80%;
  margin-top: 1rem;
  white-space: pre-wrap; /* 保持换行 */
  word-wrap: break-word;
}
</style>
```

**`error` Prop 对象的常见属性：**

*   `statusCode` (Number): HTTP 错误状态码 (如 `404`, `500`, `403` 等)。这是最有用的属性，可以用来区分不同类型的错误。
*   `statusMessage` (String): 与状态码对应的文本消息 (如 `'Not Found'`, `'Internal Server Error'`)。
*   `message` (String): 更具体的错误描述信息。
*   `description` (String): 错误的详细描述（不常用）。
*   `data` (Any): 附加的错误数据（如果通过 `showError` 传递了）。
*   `stack` (String, **仅限开发模式**): 错误的堆栈跟踪信息，用于调试。**不要在生产环境显示！**
*   `url` (String): 导致错误的原始 URL (通常是 404 时提供)。

**`clearError` 函数：**

*   当用户在错误页面上时，应用仍然处于“错误状态”。
*   `clearError` 是 Nuxt 提供的全局辅助函数，用于**清除这个错误状态**。
*   通常你会给用户提供一个按钮（比如“返回首页”），点击时调用 `clearError` 并**重定向**到一个安全的页面（通常是首页 `/`）。
*   `clearError({ redirect: '/' })`

**如何触发错误（用于测试或程序逻辑）：**

*   **404 错误**：访问一个不存在的路由即可。
*   **编程式错误**：在你的页面、组件、插件或服务器路由的 `<script setup>` 或逻辑中，可以使用 `showError` 辅助函数来主动触发一个错误，并交由 `error.vue` 处理。

    ```javascript
    // 在某个页面或组件中
    import { showError } from '#app'; // 或 #imports

    async function fetchData() {
      try {
        const data = await $fetch('/api/protected-resource');
        // ... 处理数据
      } catch (err) {
        if (err.response?.status === 403) {
          // 触发一个 403 错误页面
          return showError({
            statusCode: 403,
            statusMessage: 'Forbidden',
            message: '您没有权限访问此资源。'
          });
        } else {
          // 触发一个通用的 500 错误页面
          return showError({
            statusCode: 500,
            statusMessage: 'Internal Server Error',
            message: '获取数据时发生服务器错误。'
          });
        }
      }
    }
    ```

**总结：**

创建 Nuxt 3 自定义错误页面非常简单：

1.  在项目**根目录**创建 `error.vue` 文件。
2.  在 `error.vue` 中使用 `defineProps({ error: Object })` 接收错误信息。
3.  根据 `props.error.statusCode` 和 `props.error.message` 等属性来定制错误显示。
4.  提供一个按钮，调用 `clearError({ redirect: '...' })` 让用户可以离开错误页面。
5.  使用 `showError(errorObject)` 可以在代码中主动触发错误处理。

这样你就能为用户提供一个统一且符合应用风格的错误处理体验了。