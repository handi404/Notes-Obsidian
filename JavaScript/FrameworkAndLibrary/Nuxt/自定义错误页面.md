# **📌 Nuxt 自定义错误页面（Error Handling）详解**

在 Nuxt 应用中，错误处理是必不可少的，包括 **404 页面**、**服务器错误**、**API 请求失败** 等。Nuxt 提供了**全局错误页面**和**局部错误处理**两种方式，本文将详细解析如何在 Nuxt 中自定义错误页面。

---

## **🚀 1. 全局错误页面 (`error.vue`)**

📌 **Nuxt 允许你在 `error.vue` 里定义全局错误页面，统一处理 404 和 500 等错误。**

### **✅ 创建 `error.vue`**

在 `layouts/` 目录下创建 `error.vue`：

```vue
<template>
  <div class="error-page">
    <h1 v-if="error.statusCode === 404">😢 页面未找到</h1>
    <h1 v-else>⚠️ 发生错误</h1>
    <p>{{ error.message }}</p>
    <NuxtLink to="/">🏠 返回首页</NuxtLink>
  </div>
</template>

<script setup>
defineProps(['error']);
</script>

<style>
.error-page {
  text-align: center;
  padding: 50px;
}
</style>
```

✅ **当用户访问不存在的页面（如 `/non-existent`）时，会自动显示此页面！**

---

## **🚀 2. 局部错误处理（`useError` & `showError`）**

📌 **如果你只想在某个页面或组件里处理错误，可以使用 `useError()` 或 `showError()`。**

### **✅ 在页面中使用 `useError()`**

```vue
<script setup>
const error = useError();
</script>

<template>
  <div>
    <h1>📌 这是一个页面</h1>
    <p v-if="error">❌ {{ error.message }}</p>
  </div>
</template>
```

✅ **`useError()` 可以在某个页面里获取错误状态，而不会影响其他页面。**

---

### **✅ 在组件或页面手动触发 `showError()`**

📌 **如果你想在 API 请求失败时手动抛出错误，可以使用 `showError()`。**

```vue
<script setup>
const fetchData = async () => {
  try {
    const data = await $fetch('/api/fake-url');
  } catch (err) {
    showError({ statusCode: 500, message: '服务器请求失败！' });
  }
};
</script>

<template>
  <button @click="fetchData">获取数据</button>
</template>
```

✅ **当 API 请求失败时，用户会被自动重定向到 `error.vue` 页面。**

---

## **🚀 3. 404 页面（自定义 `not-found.vue`）**

📌 **如果你想创建独立的 404 页面（而不是 `error.vue` 处理所有错误），可以手动拦截 404 请求。**

### **✅ 创建 `pages/not-found.vue`**

```vue
<template>
  <div class="not-found">
    <h1>🚫 404 - 页面未找到</h1>
    <NuxtLink to="/">🏠 返回首页</NuxtLink>
  </div>
</template>

<style>
.not-found {
  text-align: center;
  padding: 50px;
}
</style>
```

### **✅ 在 `middleware` 里拦截 404**

📌 **创建 `middleware/notFound.ts`**

```ts
export default defineNuxtRouteMiddleware((to, from) => {
  if (!to.matched.length) {
    return navigateTo('/not-found', { replace: true });
  }
});
```

然后在 `nuxt.config.ts` 里注册：

```ts
export default defineNuxtConfig({
  router: {
    options: {
      middleware: ['notFound']
    }
  }
});
```

✅ **这样所有 404 页面都会跳转到 `/not-found` 页面！**

---

## **🚀 4. API 错误处理**

📌 **如果你的 Nuxt 应用调用后端 API 时发生错误，你可以在 `server/api/` 里自定义错误响应。**

### **✅ 在 `server/api/example.ts` 里抛出 API 错误**

```ts
export default defineEventHandler(() => {
  throw createError({ statusCode: 500, statusMessage: '服务器出错！' });
});
```

### **✅ 在前端调用 API 并处理错误**

```vue
<script setup>
const { data, error } = useFetch('/api/example');
</script>

<template>
  <div v-if="error">❌ {{ error.statusMessage }}</div>
  <div v-else>{{ data }}</div>
</template>
```

✅ **这样 `useFetch` 会自动捕获 API 错误，并显示友好的错误信息！**

---

## **🚀 5. 自定义错误布局**

📌 **如果你想让 `error.vue` 使用不同的布局，而不是 `default.vue`，可以手动指定 `layout`。**

### **✅ 修改 `error.vue` 让它使用 `error-layout.vue`**

```vue
<script setup>
definePageMeta({
  layout: 'error-layout'
});
defineProps(['error']);
</script>
```

### **✅ 创建 `layouts/error-layout.vue`**

```vue
<template>
  <div class="error-layout">
    <h1>⚠️ 自定义错误页面</h1>
    <slot />
  </div>
</template>
```

✅ **这样错误页面会使用 `error-layout.vue` 作为布局！**

---

## **🎯 总结**

|**错误类型**|**解决方案**|**示例**|
|---|---|---|
|**404 页面**|`error.vue` 处理|自动显示 404|
|**局部错误处理**|`useError()`|`<p v-if="error">{{ error.message }}</p>`|
|**手动抛出错误**|`showError({ statusCode: 500 })`|API 失败时跳转错误页|
|**API 错误处理**|`throw createError({ statusCode: 500 })`|`server/api/` 里自定义错误|
|**自定义错误布局**|`definePageMeta({ layout: 'error-layout' })`|`error-layout.vue`|

📌 **💡 Nuxt 提供了丰富的错误处理机制，无论是全局错误、API 失败，还是 404 页面，都可以灵活定制！**