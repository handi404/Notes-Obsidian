### Vue 生命周期和钩子函数详解

#### 一、什么是生命周期？
Vue 组件的生命周期是指组件从 **创建** → **挂载** → **更新** → **销毁** 的整个过程。每个阶段会触发特定的 **钩子函数**，开发者可在这些函数中插入自定义逻辑。

---

### 二、Vue 2 的生命周期和钩子函数
Vue 2 使用 **选项式 API**，生命周期钩子是组件选项对象的方法。

#### 1. 生命周期阶段和钩子函数
| 阶段        | 钩子函数           | 触发时机                                                                 |
|-------------|--------------------|--------------------------------------------------------------------------|
| **创建**    | `beforeCreate`     | 实例初始化后，数据观测/事件配置前                                        |
|             | `created`          | 实例创建完成，数据观测/计算属性/方法已配置，但 DOM 未生成                |
| **挂载**    | `beforeMount`      | 模板编译完成，但尚未挂载到 DOM                                           |
|             | `mounted`          | 实例挂载到 DOM 后，可操作 DOM                                            |
| **更新**    | `beforeUpdate`     | 数据变化后，DOM 更新前                                                   |
|             | `updated`          | DOM 更新后                                                               |
| **销毁**    | `beforeDestroy`    | 实例销毁前，可清理定时器、解绑事件等                                     |
|             | `destroyed`        | 实例销毁后，所有子实例也被销毁                                           |

#### 2. 使用示例（选项式 API）
```javascript
export default {
  data() {
    return { count: 0 };
  },
  beforeCreate() {
    console.log('组件初始化前');
  },
  created() {
    console.log('数据已初始化，可请求数据');
  },
  mounted() {
    console.log('DOM 已挂载，可操作 DOM');
  },
  beforeDestroy() {
    console.log('销毁前，清理定时器');
  }
}
```

---

### 三、Vue 3 的生命周期和钩子函数
Vue 3 支持 **选项式 API** 和 **组合式 API**，生命周期钩子名称和用法略有变化。

#### 1. 选项式 API（与 Vue 2 类似，但钩子名称变化）
- `beforeDestroy` → `beforeUnmount`
- `destroyed` → `unmounted`

```javascript
export default {
  beforeUnmount() {
    console.log('组件卸载前');
  },
  unmounted() {
    console.log('组件卸载后');
  }
}
```

#### 2. 组合式 API（通过 `setup` 函数使用）
需从 `vue` 中导入钩子函数，命名规则为 `onXxx`。

| 选项式 API       | 组合式 API         | 触发时机                                  |
|------------------|--------------------|------------------------------------------|
| `beforeCreate`   | `setup()` 替代     | `setup()` 在 `beforeCreate` 前执行       |
| `created`        | `setup()` 替代     | `setup()` 在 `created` 前执行            |
| `beforeMount`    | `onBeforeMount`    | 挂载前                                   |
| `mounted`        | `onMounted`        | 挂载完成                                 |
| `beforeUpdate`   | `onBeforeUpdate`   | 数据变化，DOM 更新前                     |
| `updated`        | `onUpdated`        | DOM 更新后                               |
| `beforeUnmount`  | `onBeforeUnmount`  | 组件卸载前                               |
| `unmounted`      | `onUnmounted`      | 组件卸载后                               |

#### 3. 使用示例（组合式 API）
```javascript
import { onMounted, onUnmounted } from 'vue';

export default {
  setup() {
    onMounted(() => {
      console.log('DOM 已挂载');
    });

    onUnmounted(() => {
      console.log('组件卸载，清理副作用');
    });
  }
}
```

#### 4. 新增钩子（针对 `<keep-alive>`）
- `onActivated`: 被缓存的组件激活时触发。
- `onDeactivated`: 被缓存的组件失活时触发。

---

### 四、Vue 2 与 Vue 3 生命周期对照表

| Vue 2 钩子         | Vue 3 选项式 API      | Vue 3 组合式 API       |
|-------------------|----------------------|-----------------------|
| `beforeCreate`    | `beforeCreate`       | `setup()` 替代        |
| `created`         | `created`            | `setup()` 替代        |
| `beforeMount`     | `beforeMount`        | `onBeforeMount`       |
| `mounted`         | `mounted`            | `onMounted`           |
| `beforeUpdate`    | `beforeUpdate`       | `onBeforeUpdate`      |
| `updated`         | `updated`            | `onUpdated`           |
| `beforeDestroy`   | `beforeUnmount`      | `onBeforeUnmount`     |
| `destroyed`       | `unmounted`          | `onUnmounted`         |

---

### 五、核心差异总结
1. **钩子命名变化**：销毁阶段钩子更名（`beforeDestroy` → `beforeUnmount`）。
2. **组合式 API**：通过 `setup()` 替代 `beforeCreate` 和 `created`，其他钩子以 `onXxx` 形式导入。
3. **Tree-shaking 优化**：Vue 3 的钩子函数需显式导入，减少未使用代码体积。
4. **执行顺序**：组合式 API 的钩子（如 `onMounted`）比选项式 API 的 `mounted` 先执行。

---

### 六、使用场景建议
- **数据初始化**：在 `created`（Vue2）或 `setup()`（Vue 3）中请求数据。
- **DOM 操作**：在 `mounted` 或 `onMounted` 中操作 DOM。
- **清理副作用**：在 `beforeUnmount` 或 `onBeforeUnmount` 中清除定时器/事件监听。

通过合理使用生命周期钩子，可以更精准地控制组件行为，提升性能和可维护性。