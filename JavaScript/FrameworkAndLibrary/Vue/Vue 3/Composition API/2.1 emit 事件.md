# **Vue 3 `emit` äº‹ä»¶è¯¦è§£ï¼ˆé€‚ç”¨äº `setup()`ï¼‰**

åœ¨ Vue 3 ä¸­ï¼Œå­ç»„ä»¶å¯ä»¥ä½¿ç”¨ `emit` è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œå¹¶å‘çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®ã€‚çˆ¶ç»„ä»¶ç›‘å¬è¿™äº›äº‹ä»¶å¹¶æ‰§è¡Œç›¸åº”çš„å¤„ç†é€»è¾‘ã€‚è¿™ç§æ–¹å¼ç¡®ä¿äº†**å•å‘æ•°æ®æµ**ï¼Œå³**æ•°æ®ä»çˆ¶ç»„ä»¶ä¼ é€’åˆ°å­ç»„ä»¶ï¼Œäº‹ä»¶ä»å­ç»„ä»¶è§¦å‘å¹¶ä¼ é€’ç»™çˆ¶ç»„ä»¶**ã€‚

---

## **1. åŸºæœ¬ç”¨æ³•**

### **å­ç»„ä»¶è§¦å‘äº‹ä»¶**

å­ç»„ä»¶é€šè¿‡ `defineEmits()` å£°æ˜å¯ä»¥è§¦å‘çš„äº‹ä»¶ï¼Œç„¶ååœ¨åˆé€‚çš„æ—¶æœºè°ƒç”¨ `emit()` æ¥è§¦å‘äº‹ä»¶å¹¶ä¼ é€’æ•°æ®ã€‚
[[setup(props, { emit }) è§£é‡Š]]
### **ç¤ºä¾‹ï¼šå­ç»„ä»¶è§¦å‘äº‹ä»¶**

**å­ç»„ä»¶ (`Child.vue`)**

```vue
<template>
  <div>
    <input v-model="message" placeholder="è¾“å…¥ä¿¡æ¯" />
    <button @click="sendMessage">å‘é€åˆ°çˆ¶ç»„ä»¶</button>
  </div>
</template>

<script>
import { ref, defineEmits } from 'vue';

export default {
  setup(props, { emit }) {
    const message = ref('');

    // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶
    const sendMessage = () => {
      emit('update-message', message.value);
    };

    return { message, sendMessage };
  }
};
</script>
```

---

**çˆ¶ç»„ä»¶ (`Parent.vue`)**

```vue
<template>
  <div>
    <h3>çˆ¶ç»„ä»¶</h3>
    <p>æ¥è‡ªå­ç»„ä»¶çš„ä¿¡æ¯: {{ parentMessage }}</p>
    <Child @update-message="handleUpdateMessage" />
  </div>
</template>

<script>
import { ref } from 'vue';
import Child from './Child.vue';

export default {
  components: { Child },
  setup() {
    const parentMessage = ref('');

    // ç›‘å¬å­ç»„ä»¶çš„äº‹ä»¶
    const handleUpdateMessage = (message) => {
      parentMessage.value = message;
    };

    return { parentMessage, handleUpdateMessage };
  }
};
</script>
```

### **ğŸ“Œ è§£æ**

1. **å­ç»„ä»¶**
    
    - ä½¿ç”¨ `defineEmits(['update-message'])` å£°æ˜äº‹ä»¶ï¼ˆæ¨èæ–¹å¼ï¼‰ã€‚
    - `emit('update-message', message.value)` è§¦å‘äº‹ä»¶ï¼Œå¹¶ä¼ é€’ `message` æ•°æ®ç»™çˆ¶ç»„ä»¶ã€‚
2. **çˆ¶ç»„ä»¶**
    
    - é€šè¿‡ `@update-message="handleUpdateMessage"` ç›‘å¬å­ç»„ä»¶çš„ `update-message` äº‹ä»¶ã€‚
    - äº‹ä»¶è§¦å‘æ—¶ï¼Œè°ƒç”¨ `handleUpdateMessage()` æ–¹æ³•ï¼Œå¹¶æ›´æ–° `parentMessage`ã€‚

---

## **2. `defineEmits()` å®šä¹‰äº‹ä»¶ï¼ˆæ¨èï¼‰**

Vue 3 å¼•å…¥äº† `defineEmits()` æ¥æ˜¾å¼å£°æ˜ç»„ä»¶æ”¯æŒçš„äº‹ä»¶ï¼Œè¿™æ ·å¯ä»¥æ›´æ¸…æ™°åœ°ç®¡ç†äº‹ä»¶ï¼Œå¹¶æé«˜ä»£ç å¯è¯»æ€§ã€‚

### **ç¤ºä¾‹**

```vue
<script setup>
import { ref, defineEmits } from 'vue';

const emit = defineEmits(['update-message']);
const message = ref('');

const sendMessage = () => {
  emit('update-message', message.value);
};
</script>
```

### **ğŸ“Œ è§£æ**

- `defineEmits(['update-message'])` å£°æ˜ç»„ä»¶å¯ä»¥è§¦å‘ `update-message` äº‹ä»¶ã€‚
- `emit('update-message', message.value)` è§¦å‘äº‹ä»¶ï¼Œç¡®ä¿äº‹ä»¶åç§°ç¬¦åˆå·²å£°æ˜çš„äº‹ä»¶åˆ—è¡¨ã€‚

---

## **3. äº‹ä»¶ä¼ é€’å¤šä¸ªå‚æ•°**

å¦‚æœéœ€è¦å‘çˆ¶ç»„ä»¶ä¼ é€’å¤šä¸ªå‚æ•°ï¼Œå¯ä»¥åœ¨ `emit()` æ–¹æ³•ä¸­ä¼ é€’å¤šä¸ªå€¼ã€‚

### **ç¤ºä¾‹**

**å­ç»„ä»¶ (`Child.vue`)**

```vue
<template>
  <button @click="sendInfo">å‘é€ä¿¡æ¯</button>
</template>

<script setup>
import { defineEmits } from 'vue';

const emit = defineEmits(['send-data']);

const sendInfo = () => {
  emit('send-data', 'Hello', 123, { name: 'Vue' });
};
</script>
```

---

**çˆ¶ç»„ä»¶ (`Parent.vue`)**

```vue
<template>
  <Child @send-data="handleData" />
</template>

<script setup>
import Child from './Child.vue';

const handleData = (msg, number, obj) => {
  console.log('æ”¶åˆ°æ¶ˆæ¯:', msg);
  console.log('æ”¶åˆ°æ•°å­—:', number);
  console.log('æ”¶åˆ°å¯¹è±¡:', obj);
};
</script>
```

### **ğŸ“Œ è§£æ**

- å­ç»„ä»¶ `emit('send-data', 'Hello', 123, { name: 'Vue' })` è§¦å‘äº‹ä»¶ï¼Œå¹¶ä¼ é€’å¤šä¸ªå‚æ•°ã€‚
- çˆ¶ç»„ä»¶ `@send-data="handleData"` ç›‘å¬äº‹ä»¶ï¼Œå¹¶æ¥æ”¶å¤šä¸ªå‚æ•°ã€‚

---

## **4. äº‹ä»¶æ ¡éªŒ**

Vue 3 `defineEmits()` å…è®¸å¯¹äº‹ä»¶çš„å‚æ•°è¿›è¡Œæ ¡éªŒï¼Œç¡®ä¿ä¼ é€’çš„æ•°æ®ç¬¦åˆé¢„æœŸæ ¼å¼ã€‚

### **ç¤ºä¾‹**

```vue
<script setup>
import { defineEmits } from 'vue';

const emit = defineEmits({
  'update-message': (message) => {
    if (typeof message !== 'string') {
      console.warn('update-message äº‹ä»¶çš„å‚æ•°å¿…é¡»æ˜¯å­—ç¬¦ä¸²');
      return false;
    }
    return true;
  }
});

const sendMessage = () => {
  emit('update-message', 'Hello Vue!');
};
</script>
```

### **ğŸ“Œ è§£æ**

- `defineEmits({ 'update-message': (message) => { ... } })` ä¸º `update-message` äº‹ä»¶æ·»åŠ æ ¡éªŒé€»è¾‘ã€‚
- å¦‚æœ `message` ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å› `false`ï¼Œé˜»æ­¢äº‹ä»¶è§¦å‘ï¼Œå¹¶æ‰“å°è­¦å‘Šã€‚

---

## **5. ç›‘å¬å­ç»„ä»¶äº‹ä»¶å¹¶ä¼ é€’åˆ°æ›´ä¸Šå±‚**

æœ‰æ—¶ï¼Œçˆ¶ç»„ä»¶éœ€è¦ç›‘å¬å­ç»„ä»¶çš„äº‹ä»¶ï¼Œå¹¶å°†å…¶ä¼ é€’åˆ°æ›´ä¸Šå±‚çš„ç»„ä»¶ï¼ˆç¥–ç»„ä»¶ï¼‰ã€‚

### **ç¤ºä¾‹**

**å­ç»„ä»¶ (`Child.vue`)**

```vue
<template>
  <button @click="sendData">ç‚¹å‡»å‘é€</button>
</template>

<script setup>
import { defineEmits } from 'vue';

const emit = defineEmits(['child-click']);

const sendData = () => {
  emit('child-click', 'æ¥è‡ªå­ç»„ä»¶çš„æ•°æ®');
};
</script>
```

---

**ä¸­é—´ç»„ä»¶ (`Middle.vue`)**

```vue
<template>
  <Child @child-click="$emit('child-click', $event)" />
</template>

<script setup>
import Child from './Child.vue';
defineEmits(['child-click']);
</script>
```

---

**çˆ¶ç»„ä»¶ (`Parent.vue`)**

```vue
<template>
  <Middle @child-click="handleChildClick" />
</template>

<script setup>
import Middle from './Middle.vue';

const handleChildClick = (data) => {
  console.log('æ”¶åˆ°å­ç»„ä»¶çš„æ•°æ®:', data);
};
</script>
```

### **ğŸ“Œ è§£æ**

- å­ç»„ä»¶ `Child.vue` è§¦å‘ `child-click` äº‹ä»¶ï¼Œå¹¶ä¼ é€’æ•°æ®ã€‚
- `Middle.vue` ä½œä¸ºä¸­é—´å±‚ï¼Œä½¿ç”¨ `$emit('child-click', $event)` ç›´æ¥è½¬å‘äº‹ä»¶ã€‚
- `Parent.vue` ç›‘å¬ `child-click`ï¼Œå¹¶æ¥æ”¶æ•°æ®ã€‚

---

## **6. äº‹ä»¶ä¿®é¥°ç¬¦ï¼ˆ`.once`ï¼‰**

åœ¨æ¨¡æ¿ä¸­ç›‘å¬å­ç»„ä»¶äº‹ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `.once` è®©äº‹ä»¶åªè§¦å‘ä¸€æ¬¡ã€‚

### **ç¤ºä¾‹**

```vue
<Child @update-message.once="handleUpdateMessage" />
```

### **ğŸ“Œ è§£æ**

- `.once` åªä¼šç›‘å¬äº‹ä»¶çš„**ç¬¬ä¸€æ¬¡è§¦å‘**ï¼Œä¹‹åçš„è§¦å‘ä¸ä¼šç”Ÿæ•ˆã€‚

---

## **æ€»ç»“**

|æ–¹æ³•|é€‚ç”¨åœºæ™¯|ä»£ç ç®€æ´åº¦|
|---|---|---|
|**åŸºæœ¬ `emit()`**|å•å‘æ•°æ®ä¼ é€’|â­â­â­â­â­|
|**`defineEmits()`**|äº‹ä»¶å£°æ˜ + ä»£ç å¯è¯»æ€§|â­â­â­â­â­|
|**å¤šå‚æ•°ä¼ é€’**|å¤æ‚æ•°æ®ç»“æ„|â­â­â­â­|
|**äº‹ä»¶æ ¡éªŒ**|ç¡®ä¿æ•°æ®æ ¼å¼|â­â­â­|
|**äº‹ä»¶è½¬å‘**|äº‹ä»¶é€çº§ä¼ é€’|â­â­â­|
|**`.once` ä¿®é¥°ç¬¦**|åªè§¦å‘ä¸€æ¬¡çš„äº‹ä»¶|â­â­â­|

---

## **æ¨èä½¿ç”¨**

1. **åŸºæœ¬ `emit()` ä¼ é€’æ•°æ®** â†’ é€‚ç”¨äºæ‰€æœ‰ç»„ä»¶é—´é€šä¿¡
2. **`defineEmits()` å£°æ˜äº‹ä»¶** â†’ æé«˜å¯è¯»æ€§å’Œä»£ç å¥å£®æ€§
3. **å¤šå‚æ•°ä¼ é€’å’Œäº‹ä»¶æ ¡éªŒ** â†’ ç¡®ä¿æ•°æ®æ ¼å¼æ­£ç¡®
4. **äº‹ä»¶è½¬å‘** â†’ é€‚ç”¨äºå¤šå±‚çº§ç»„ä»¶é€šä¿¡