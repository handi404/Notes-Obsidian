在 Vue 3 中，子组件向父组件传递数据的常见方法包括 **自定义事件 (`emit`)、`defineModel()`、`ref` 传递和 `provide/inject`**。下面详细讲解如何在 `setup()` 中使用这些方法。

---

# **1. 通过 `emit` 事件传递数据（推荐）**

Vue 提供 `emit` 方法，子组件可以通过 `emit` 触发事件，并传递数据给父组件。

### **示例**

**子组件（`Child.vue`）**

```vue
<template>
  <div>
    <input v-model="message" placeholder="输入信息" />
    <button @click="sendMessage">发送到父组件</button>
  </div>
</template>

<script>
import { ref, defineEmits } from 'vue';

export default {
  setup(props, { emit }) {
    const message = ref('');

    const sendMessage = () => {
      emit('update-message', message.value); // 触发事件，传递数据
    };

    return { message, sendMessage };
  }
};
</script>
```

---

**父组件（`Parent.vue`）**

```vue
<template>
  <div>
    <h3>父组件</h3>
    <p>来自子组件的信息: {{ parentMessage }}</p>
    <Child @update-message="handleUpdateMessage" />
  </div>
</template>

<script>
import { ref } from 'vue';
import Child from './Child.vue';

export default {
  components: { Child },
  setup() {
    const parentMessage = ref('');

    const handleUpdateMessage = (message) => {
      parentMessage.value = message;
    };

    return { parentMessage, handleUpdateMessage };
  }
};
</script>
```

### **📌 解析**

- **`emit('update-message', message.value)`**：子组件触发 `update-message` 事件，传递数据到父组件。
- **`@update-message="handleUpdateMessage"`**：父组件监听 `update-message` 事件，并调用 `handleUpdateMessage` 方法更新数据。

---

# **2. 通过 `defineModel()` 实现双向绑定（Vue 3.4+ 推荐）**

Vue 3.4 引入了 `defineModel()`，让子组件可以直接修改父组件的数据。

### **示例**

**子组件（`Child.vue`）**

```vue
<template>
  <input v-model="message" placeholder="输入信息" />
</template>

<script setup>
import { defineModel } from 'vue';

// 定义一个 model 变量，自动绑定到父组件
const message = defineModel();
</script>
```

---

**父组件（`Parent.vue`）**

```vue
<template>
  <div>
    <h3>父组件</h3>
    <p>来自子组件的信息: {{ parentMessage }}</p>
    <Child v-model="parentMessage" />
  </div>
</template>

<script setup>
import { ref } from 'vue';
import Child from './Child.vue';

const parentMessage = ref('');
</script>
```

### **📌 解析**

- `defineModel()` **让子组件的 `message` 自动绑定到父组件的 `parentMessage`**，修改 `message` 会同步更新 `parentMessage`。
- **更简单易用**，无需 `emit`。

---

# **3. 通过 `ref` 传递子组件实例**

如果父组件需要直接访问子组件的方法或数据，可以使用 `ref` 绑定子组件。

### **示例**

**子组件（`Child.vue`）**

```vue
<template>
  <div>
    <p>子组件消息: {{ message }}</p>
  </div>
</template>

<script>
import { ref, defineExpose } from 'vue';

export default {
  setup() {
    const message = ref('子组件的数据');

    // 让父组件能访问这个数据
    defineExpose({ message });

    return { message };
  }
};
</script>
```

---

**父组件（`Parent.vue`）**

```vue
<template>
  <div>
    <h3>父组件</h3>
    <p>子组件的数据: {{ childRef?.message }}</p>
    <Child ref="childRef" />
    <button @click="updateMessage">更新子组件数据</button>
  </div>
</template>

<script>
import { ref } from 'vue';
import Child from './Child.vue';

export default {
  components: { Child },
  setup() {
    const childRef = ref(null);

    const updateMessage = () => {
      if (childRef.value) {
        childRef.value.message = '父组件修改后的数据';
      }
    };

    return { childRef, updateMessage };
  }
};
</script>
```

### **📌 解析**

- **`ref="childRef"`**：父组件通过 `ref` 获取子组件实例。
- **`defineExpose({ message })`**：让父组件能够访问 `message`，否则 `message` 在 `setup()` 内部不可见。
- **`childRef.value.message`**：父组件可以直接修改子组件的数据。

---

# **4. 通过 `provide/inject` 共享数据**

如果数据需要在多个层级组件间共享，`provide/inject` 是更合适的方案。

### **示例**

**祖组件（`Parent.vue`）**

```vue
<template>
  <div>
    <h3>父组件</h3>
    <Child />
  </div>
</template>

<script>
import { ref, provide } from 'vue';
import Child from './Child.vue';

export default {
  components: { Child },
  setup() {
    const message = ref('祖组件的消息');
    
    // 让所有子组件都能访问 message
    provide('message', message);

    return { message };
  }
};
</script>
```

---

**子组件（`Child.vue`）**

```vue
<template>
  <div>
    <p>子组件接收到的消息: {{ message }}</p>
  </div>
</template>

<script>
import { inject } from 'vue';

export default {
  setup() {
    const message = inject('message'); // 获取祖组件提供的数据

    return { message };
  }
};
</script>
```

### **📌 解析**

- **`provide('message', message)`**：父组件提供 `message` 变量，供所有子组件使用。
- **`inject('message')`**：子组件获取 `message` 并显示。

---

# **总结**

|方式|适用场景|优势|代码简洁度|
|---|---|---|---|
|**`emit` 事件**|适用于单个子组件向父组件传递数据|官方推荐，单向数据流清晰|⭐⭐⭐|
|**`defineModel()`**|Vue 3.4+ 双向绑定|代码更简单，避免 `emit`|⭐⭐⭐⭐⭐|
|**`ref` 传递组件实例**|需要父组件访问子组件方法/数据|灵活，但可能导致耦合|⭐⭐|
|**`provide/inject`**|多层级组件共享数据|适用于深层组件传递|⭐⭐⭐⭐|

---

# **推荐使用**

1. **单向数据传递** → `emit`（Vue 3.4+ 推荐 `defineModel()`）
2. **访问子组件方法或数据** → `ref` + `defineExpose()`
3. **深层组件共享数据** → `provide/inject`

选择合适的方式可以提高组件的可维护性和可读性！🚀