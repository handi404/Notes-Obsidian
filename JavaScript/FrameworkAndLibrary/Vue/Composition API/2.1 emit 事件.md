# **Vue 3 `emit` 事件详解（适用于 `setup()`）**

在 Vue 3 中，子组件可以使用 `emit` 触发自定义事件，并向父组件传递数据。父组件监听这些事件并执行相应的处理逻辑。这种方式确保了**单向数据流**，即**数据从父组件传递到子组件，事件从子组件触发并传递给父组件**。

---

## **1. 基本用法**

### **子组件触发事件**

子组件通过 `defineEmits()` 声明可以触发的事件，然后在合适的时机调用 `emit()` 来触发事件并传递数据。
[[setup(props, { emit }) 解释]]
### **示例：子组件触发事件**

**子组件 (`Child.vue`)**

```vue
<template>
  <div>
    <input v-model="message" placeholder="输入信息" />
    <button @click="sendMessage">发送到父组件</button>
  </div>
</template>

<script>
import { ref, defineEmits } from 'vue';

export default {
  setup(props, { emit }) {
    const message = ref('');

    // 触发自定义事件
    const sendMessage = () => {
      emit('update-message', message.value);
    };

    return { message, sendMessage };
  }
};
</script>
```

---

**父组件 (`Parent.vue`)**

```vue
<template>
  <div>
    <h3>父组件</h3>
    <p>来自子组件的信息: {{ parentMessage }}</p>
    <Child @update-message="handleUpdateMessage" />
  </div>
</template>

<script>
import { ref } from 'vue';
import Child from './Child.vue';

export default {
  components: { Child },
  setup() {
    const parentMessage = ref('');

    // 监听子组件的事件
    const handleUpdateMessage = (message) => {
      parentMessage.value = message;
    };

    return { parentMessage, handleUpdateMessage };
  }
};
</script>
```

### **📌 解析**

1. **子组件**
    
    - 使用 `defineEmits(['update-message'])` 声明事件（推荐方式）。
    - `emit('update-message', message.value)` 触发事件，并传递 `message` 数据给父组件。
2. **父组件**
    
    - 通过 `@update-message="handleUpdateMessage"` 监听子组件的 `update-message` 事件。
    - 事件触发时，调用 `handleUpdateMessage()` 方法，并更新 `parentMessage`。

---

## **2. `defineEmits()` 定义事件（推荐）**

Vue 3 引入了 `defineEmits()` 来显式声明组件支持的事件，这样可以更清晰地管理事件，并提高代码可读性。

### **示例**

```vue
<script setup>
import { ref, defineEmits } from 'vue';

const emit = defineEmits(['update-message']);
const message = ref('');

const sendMessage = () => {
  emit('update-message', message.value);
};
</script>
```

### **📌 解析**

- `defineEmits(['update-message'])` 声明组件可以触发 `update-message` 事件。
- `emit('update-message', message.value)` 触发事件，确保事件名称符合已声明的事件列表。

---

## **3. 事件传递多个参数**

如果需要向父组件传递多个参数，可以在 `emit()` 方法中传递多个值。

### **示例**

**子组件 (`Child.vue`)**

```vue
<template>
  <button @click="sendInfo">发送信息</button>
</template>

<script setup>
import { defineEmits } from 'vue';

const emit = defineEmits(['send-data']);

const sendInfo = () => {
  emit('send-data', 'Hello', 123, { name: 'Vue' });
};
</script>
```

---

**父组件 (`Parent.vue`)**

```vue
<template>
  <Child @send-data="handleData" />
</template>

<script setup>
import Child from './Child.vue';

const handleData = (msg, number, obj) => {
  console.log('收到消息:', msg);
  console.log('收到数字:', number);
  console.log('收到对象:', obj);
};
</script>
```

### **📌 解析**

- 子组件 `emit('send-data', 'Hello', 123, { name: 'Vue' })` 触发事件，并传递多个参数。
- 父组件 `@send-data="handleData"` 监听事件，并接收多个参数。

---

## **4. 事件校验**

Vue 3 `defineEmits()` 允许对事件的参数进行校验，确保传递的数据符合预期格式。

### **示例**

```vue
<script setup>
import { defineEmits } from 'vue';

const emit = defineEmits({
  'update-message': (message) => {
    if (typeof message !== 'string') {
      console.warn('update-message 事件的参数必须是字符串');
      return false;
    }
    return true;
  }
});

const sendMessage = () => {
  emit('update-message', 'Hello Vue!');
};
</script>
```

### **📌 解析**

- `defineEmits({ 'update-message': (message) => { ... } })` 为 `update-message` 事件添加校验逻辑。
- 如果 `message` 不是字符串，则返回 `false`，阻止事件触发，并打印警告。

---

## **5. 监听子组件事件并传递到更上层**

有时，父组件需要监听子组件的事件，并将其传递到更上层的组件（祖组件）。

### **示例**

**子组件 (`Child.vue`)**

```vue
<template>
  <button @click="sendData">点击发送</button>
</template>

<script setup>
import { defineEmits } from 'vue';

const emit = defineEmits(['child-click']);

const sendData = () => {
  emit('child-click', '来自子组件的数据');
};
</script>
```

---

**中间组件 (`Middle.vue`)**

```vue
<template>
  <Child @child-click="$emit('child-click', $event)" />
</template>

<script setup>
import Child from './Child.vue';
defineEmits(['child-click']);
</script>
```

---

**父组件 (`Parent.vue`)**

```vue
<template>
  <Middle @child-click="handleChildClick" />
</template>

<script setup>
import Middle from './Middle.vue';

const handleChildClick = (data) => {
  console.log('收到子组件的数据:', data);
};
</script>
```

### **📌 解析**

- 子组件 `Child.vue` 触发 `child-click` 事件，并传递数据。
- `Middle.vue` 作为中间层，使用 `$emit('child-click', $event)` 直接转发事件。
- `Parent.vue` 监听 `child-click`，并接收数据。

---

## **6. 事件修饰符（`.once`）**

在模板中监听子组件事件时，可以使用 `.once` 让事件只触发一次。

### **示例**

```vue
<Child @update-message.once="handleUpdateMessage" />
```

### **📌 解析**

- `.once` 只会监听事件的**第一次触发**，之后的触发不会生效。

---

## **总结**

|方法|适用场景|代码简洁度|
|---|---|---|
|**基本 `emit()`**|单向数据传递|⭐⭐⭐⭐⭐|
|**`defineEmits()`**|事件声明 + 代码可读性|⭐⭐⭐⭐⭐|
|**多参数传递**|复杂数据结构|⭐⭐⭐⭐|
|**事件校验**|确保数据格式|⭐⭐⭐|
|**事件转发**|事件逐级传递|⭐⭐⭐|
|**`.once` 修饰符**|只触发一次的事件|⭐⭐⭐|

---

## **推荐使用**

1. **基本 `emit()` 传递数据** → 适用于所有组件间通信
2. **`defineEmits()` 声明事件** → 提高可读性和代码健壮性
3. **多参数传递和事件校验** → 确保数据格式正确
4. **事件转发** → 适用于多层级组件通信