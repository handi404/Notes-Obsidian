[[setInterval 重复执行指定的函数或代码片段]]

```jsx
import React, {useState, useEffect, useRef} from 'react';

function Stopwatch(){

    const [isRunning, setIsRunning] = useState(false);
    const [elapsedTime, setElapsedTime] = useState(0);
    //存储 `setInterval` 返回的 ID，以便后续清除定时器。
    const intervalIdRef = useRef(null);
    //开始时的时间戳
    const startTimeRef = useRef(0);

    useEffect(() => {

        if(isRunning){
            intervalIdRef.current = setInterval(() => {
                setElapsedTime(Date.now() - startTimeRef.current);
            }, 10);
        }

        return () => {
            clearInterval(intervalIdRef.current);
        }
    }, [isRunning]);

    function start(){
        setIsRunning(true);
        startTimeRef.current = Date.now() - elapsedTime;
    }

    function stop(){
        setIsRunning(false);
    }

    function reset(){
        setElapsedTime(0);
        setIsRunning(false);
    }

    function formatTime(){
		//elapsedTime为毫秒，得到时需/ (1000 * 60 * 60)
        let hours = Math.floor(elapsedTime / (1000 * 60 * 60));
        //得到分
        let minutes = Math.floor(elapsedTime / (1000 * 60) % 60);
        //得到秒
        let seconds = Math.floor(elapsedTime / (1000) % 60);
        //得到毫秒。实际1000ms为1s，但在秒表看到的为100后(经过了1000ms)得到1s
        let milliseconds = Math.floor((elapsedTime % 1000) / 10);
		//确保显示的数字总是两位数（不足两位时在前面补 `0`）
        hours = String(hours).padStart(2, "0");
        minutes = String(minutes).padStart(2, "0");
        seconds = String(seconds).padStart(2, "0");
        milliseconds = String(milliseconds).padStart(2, "0");

        return `${minutes}:${seconds}:${milliseconds}`;
    }

    return(
        <div className="stopwatch">
            <div className="display">{formatTime()}</div>
            <div className="controls">
                <button onClick={start} className="start-button">Start</button>
                <button onClick={stop} className="stop-button">Stop</button>
                <button onClick={reset} className="reset-button">Reset</button>
            </div>
        </div>
    );
}
export default Stopwatch
```

这个代码定义了一个简单的计时器（`Stopwatch`）组件，用于显示和控制计时功能。该组件包含启动、停止和重置计时器的功能，并实时显示经过的时间。我们逐步分析这段代码的各个部分及其功能。

### 1. 引入 React 相关的 Hooks

```javascript
import React, {useState, useEffect, useRef} from 'react';
```

- **`useState`**：用于管理组件的状态，在这里用于管理计时器的运行状态 (`isRunning`) 和经过时间 (`elapsedTime`)。
- **`useEffect`**：用于处理副作用，主要在 `isRunning` 状态变化时处理计时器的启动和停止。
- **`useRef`**：用于创建可变的引用，保存一些跨渲染周期的数据，而不引发组件重新渲染。

### 2. 初始化状态和引用

```javascript
const [isRunning, setIsRunning] = useState(false);
const [elapsedTime, setElapsedTime] = useState(0);
const intervalIdRef = useRef(null);
const startTimeRef = useRef(0);
```

- **`isRunning`**：表示计时器当前是否在运行，初始状态为 `false`。
- **`elapsedTime`**：表示已经过去的时间，初始状态为 `0`。
- **`intervalIdRef`**：用于存储 `setInterval` 返回的 ID，以便后续清除定时器。
- **`startTimeRef`**：用于记录计时器开始时的时间戳，以计算经过的时间。

### 3. 处理计时器逻辑的 `useEffect`

```javascript
useEffect(() => {
    if(isRunning){
        intervalIdRef.current = setInterval(() => {
            setElapsedTime(Date.now() - startTimeRef.current);
        }, 10);
    }

    return () => {
        clearInterval(intervalIdRef.current);
    }
}, [isRunning]);
```

- 当 `isRunning` 变为 `true` 时：
  - `useEffect` 启动一个 `setInterval` 定时器，每 10 毫秒更新一次 `elapsedTime`。通过 `Date.now() - startTimeRef.current` 计算已经过去的时间。
  - 这个定时器的 ID 被保存到 `intervalIdRef.current` 中，以便后续可以通过 `clearInterval` 清除。

- 当 `isRunning` 变为 `false` 或组件卸载时：
  - `useEffect` 返回的清理函数会执行，调用 `clearInterval(intervalIdRef.current)` 以停止定时器，防止内存泄漏或不必要的执行。

### 4. 控制按钮的功能

```javascript
function start(){
    setIsRunning(true);
    startTimeRef.current = Date.now() - elapsedTime;
}

function stop(){
    setIsRunning(false);
}

function reset(){
    setElapsedTime(0);
    setIsRunning(false);
}
```

- **`start` 函数**：
  - 当用户点击“Start”按钮时，计时器开始运行。
  - `setIsRunning(true)` 设置 `isRunning` 为 `true`，触发 `useEffect` 启动定时器。
  - `startTimeRef.current` 保存当前时间（减去已过去的时间，以支持暂停后继续计时的功能）。

- **`stop` 函数**：
  - 当用户点击“Stop”按钮时，计时器停止运行。
  - `setIsRunning(false)` 设置 `isRunning` 为 `false`，触发 `useEffect` 清除定时器。

- **`reset` 函数**：
  - 当用户点击“Reset”按钮时，计时器重置。
  - `setElapsedTime(0)` 重置已经过去的时间为 0。
  - `setIsRunning(false)` 停止计时器。

### 5. 格式化显示时间

```javascript
function formatTime(){
    let hours = Math.floor(elapsedTime / (1000 * 60 * 60));
    let minutes = Math.floor(elapsedTime / (1000 * 60) % 60);
    let seconds = Math.floor(elapsedTime / (1000) % 60);
    let milliseconds = Math.floor((elapsedTime % 1000) / 10);

    hours = String(hours).padStart(2, "0");
    minutes = String(minutes).padStart(2, "0");
    seconds = String(seconds).padStart(2, "0");
    milliseconds = String(milliseconds).padStart(2, "0");

    return `${minutes}:${seconds}:${milliseconds}`;
}
```

- 这个函数将 `elapsedTime`（以毫秒为单位）格式化为 `时:分钟:秒:毫秒` 的形式，并将其显示在界面上。
- `padStart(2, "0")` 用于确保显示的数字总是两位数（不足两位时在前面补 `0`）。

### 6. 组件的渲染输出

```javascript
return(
    <div className="stopwatch">
        <div className="display">{formatTime()}</div>
        <div className="controls">
            <button onClick={start} className="start-button">Start</button>
            <button onClick={stop} className="stop-button">Stop</button>
            <button onClick={reset} className="reset-button">Reset</button>
        </div>
    </div>
);
```

- **`formatTime()`** 返回的格式化时间会显示在 `<div className="display">` 中。
- 三个按钮分别绑定到 `start`、`stop` 和 `reset` 函数，允许用户控制计时器的运行、停止和重置。

### 7. 总结

这个 `Stopwatch` 组件通过 `useState` 管理计时器的状态和已过去的时间，通过 `useRef` 保存定时器的 ID 和开始时间，避免了重新渲染时丢失这些值的情况。`useEffect` 被用来在计时器运行时启动和停止定时器，确保正确地更新计时器的显示。这段代码展示了如何在 React 中结合使用不同的 Hook 来实现复杂的功能。

```css
body{
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: hsl(0, 0%, 95%);
}
.stopwatch{
    display: flex;
    flex-direction: column;
    align-items: center;
    border: 5px solid;
    border-radius: 50px;
    background-color: white;
    padding: 30px;
}
.display{
    font-size: 5rem;
    font-family: monospace;
    font-weight: bold;
    color: hsl(0, 0%, 30%);
    text-shadow: 2px 2px 2px hsla(0, 0%, 0%, 0.75);
    margin-bottom: 25px;
}
.controls button{
    font-size: 1.5rem;
    font-weight: bold;
    padding: 10px 20px;
    margin: 5px;
    min-width: 125px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    color: white;
    transition: background-color 0.5s ease;
}
.start-button{
    background-color: hsl(115, 100%, 40%);
}
.start-button:hover{
    background-color: hsl(115, 100%, 35%);
}
.stop-button{
    background-color: hsl(10, 90%, 50%);
}
.stop-button:hover{
    background-color: hsl(10, 90%, 45%);
}
.reset-button{
    background-color: hsl(205, 90%, 60%);
}
.reset-button:hover{
    background-color: hsl(205, 90%, 55%);
}
```