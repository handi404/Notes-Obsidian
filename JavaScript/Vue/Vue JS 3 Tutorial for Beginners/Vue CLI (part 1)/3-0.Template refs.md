在 Vue 3 中，**Template Refs**（模板引用）是一种方便的机制，用来直接访问 DOM 元素或子组件的实例。它通过在模板中为元素或组件指定 `ref` 属性，然后在组件的逻辑部分访问该元素或组件的引用。

### 1. **Template Refs 的概念**
Template refs 主要用于在组件中直接获取：
- **DOM 元素**：例如 `<div>`、`<input>`、`<button>` 等 HTML 元素。
- **子组件实例**：用于访问子组件的方法或数据。

在 Vue 3 中，`ref` 是响应式的，可以动态地随着组件的生命周期更新。

### 2. **如何使用 Template Refs**

#### **(1) 基本用法**
在模板中使用 `ref` 属性给某个元素或组件打上标记，然后在 `<script>` 或 `<script setup>` 中使用 `ref()` 函数来访问这些元素或组件。

##### **示例：访问 DOM 元素**
```vue
<template>
  <div>
    <input ref="inputRef" type="text" placeholder="Enter something" />
    <button @click="focusInput">Focus Input</button>
  </div>
</template>

<script>
import { ref, onMounted } from 'vue';

export default {
  setup() {
    const inputRef = ref(null); // 定义一个响应式的 ref，用来保存 DOM 元素引用

    function focusInput() {
      inputRef.value.focus(); // 通过 .value 访问引用的 DOM 元素
    }

    return {
      inputRef,
      focusInput
    };
  }
};
</script>
```

**解释：**
- 在模板中，给 `<input>` 元素添加 `ref="inputRef"`，这使得 Vue 可以捕捉该元素。
- 在 `<script>` 部分，使用 `ref(null)` 来初始化一个变量 `inputRef`。
- 通过 `inputRef.value` 获取 DOM 元素，并调用其方法（如 `.focus()`）操作该元素。

#### **(2) 访问子组件实例**
除了获取 DOM 元素，Vue 还允许通过 `ref` 来访问子组件实例，以便调用子组件上的方法或获取其内部状态。

##### **示例：访问子组件**
```vue
<!-- ParentComponent.vue -->
<template>
  <div>
    <ChildComponent ref="childRef" />
    <button @click="callChildMethod">Call Child Method</button>
  </div>
</template>

<script>
import { ref } from 'vue';
import ChildComponent from './ChildComponent.vue';

export default {
  components: {
    ChildComponent
  },
  setup() {
    const childRef = ref(null); // 引用子组件

    function callChildMethod() {
      childRef.value.childMethod(); // 调用子组件中的方法
    }

    return {
      childRef,
      callChildMethod
    };
  }
};
</script>
```

```vue
<!-- ChildComponent.vue -->
<template>
  <div>I am a child component</div>
</template>

<script>
export default {
  methods: {
    childMethod() {
      console.log('Child method called!');
    }
  }
};
</script>
```

**解释：**
- 在父组件中，给 `ChildComponent` 组件添加 `ref="childRef"`，使得 Vue 可以引用该子组件。
- 在父组件的 `<script>` 部分，使用 `ref(null)` 定义 `childRef`。
- 通过 `childRef.value` 访问子组件的实例，调用子组件内部的方法 `childMethod()`。

### 3. **在 `<script setup>` 中使用 Template Refs**
Vue 3 提供了 `<script setup>` 语法糖，可以更简洁地处理模板引用。下面是使用 `<script setup>` 的方式。

##### **示例：使用 `<script setup>` 访问 DOM 元素**
```vue
<template>
  <div>
    <input ref="inputRef" type="text" placeholder="Enter something" />
    <button @click="focusInput">Focus Input</button>
  </div>
</template>

<script setup>
import { ref } from 'vue';

const inputRef = ref(null);

function focusInput() {
  inputRef.value.focus();
}
</script>
```

在这种语法下，`setup` 函数和逻辑部分更加简洁。`inputRef` 直接在模板和逻辑中使用，无需显式返回。

### 4. **响应式的 Template Refs**
在 Vue 3 中，`ref` 是响应式的，意味着它会在 DOM 渲染完成后自动更新，开发者无需手动管理 DOM 的更新。这一点在 Vue 的生命周期中尤为重要。

#### **使用 `onMounted` 获取 DOM 引用**
有时候，需要确保在组件挂载完成后再操作 DOM 元素，Vue 提供了 `onMounted` 钩子函数来处理这种场景。

##### **示例：在 `onMounted` 中操作 DOM**
```vue
<template>
  <div>
    <input ref="inputRef" type="text" placeholder="Enter something" />
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';

const inputRef = ref(null);

onMounted(() => {
  inputRef.value.focus(); // 组件挂载完成后获取 DOM 元素并聚焦
});
</script>
```

**解释：**
- `onMounted` 是一个生命周期钩子，它会在组件挂载到 DOM 后触发。
- 在 `onMounted` 钩子中，可以安全地操作 DOM 元素，如调用 `inputRef.value.focus()`。

### 5. **模板引用的动态性**
Template refs 是响应式的，因此它们会自动跟踪 DOM 元素的更新。当模板中的 `v-if`、`v-for` 或其他动态内容更新时，`ref` 也会随之更新。

#### **示例：在 `v-if` 中使用 `ref`**
```vue
<template>
  <div>
    <button @click="toggleShow">Toggle Input</button>
    <input v-if="show" ref="inputRef" type="text" placeholder="Conditional Input" />
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';

const inputRef = ref(null);
const show = ref(false);

function toggleShow() {
  show.value = !show.value;
}

onMounted(() => {
  if (show.value && inputRef.value) {
    inputRef.value.focus();
  }
});
</script>
```

**解释：**
- `v-if` 控制 `<input>` 是否渲染。
- 由于 `inputRef` 仅在 `v-if="true"` 时才存在，必须在 `onMounted` 中或通过 `watch` 动态判断其是否存在。

### 6. **访问多个 DOM 元素**
在 `v-for` 循环中，可以给每个元素绑定一个 `ref`，并将其存储在数组中。

##### **示例：使用 `v-for` 和 `ref`**
```vue
<template>
  <ul>
    <li v-for="(item, index) in items" :key="index" :ref="el => itemRefs[index] = el">
      {{ item }}
    </li>
  </ul>
</template>

<script setup>
import { ref } from 'vue';

const items = ref(['Item 1', 'Item 2', 'Item 3']);
const itemRefs = ref([]);

function logRefs() {
  console.log(itemRefs.value); // 访问每个列表项的 DOM 元素
}
</script>
```

**解释：**
- `:ref="el => itemRefs[index] = el"` 用来动态收集每个列表项的引用。
- `itemRefs` 是一个包含 DOM 元素引用的数组，可以通过 `itemRefs.value` 来访问。

### 7. **注意事项**
- **访问时机**：在组件未挂载时，`ref` 可能还未初始化（为 `null`）。因此，操作 DOM 元素通常需要放在 `onMounted` 或通过 `watch` 监听来确保元素已经渲染。
- **动态引用**：当 DOM 元素或子组件是动态生成时，`ref` 也会动态变化。如果一个 `v-if` 控制的元素消失了，对应的 `ref` 会变成 `null`。
- **组合式 API 的使用**：在组合式 API 中，`ref` 是处理响应式数据和 DOM 引用的核心工具，既可以操作模板引用，也可以管理普通数据。

### 总结
- **Template refs** 是 Vue 3 中用于访问 DOM 元素和子组件实例的机制。通过 `ref` 属性标记元素或组件，并在 JavaScript 中使用 `ref()` 函数来获取引用。
- 它适用于访问原生 DOM 元素、调用子组件方法或直接操控 DOM，通常与生命周期钩子如 `onMounted` 配合使用。
- Vue 3 中的 Template refs 是响应式的，可以在模板动态变化时自动更新。

Template refs 让开发者可以轻松访问 DOM 元素和组件实例，为需要直接操作 DOM 或组件的场景提供了强大的工具。