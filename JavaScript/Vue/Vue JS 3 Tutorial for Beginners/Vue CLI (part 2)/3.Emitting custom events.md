在 Vue 3 中，自定义事件（Custom Events）用于在**子组件**与**父组件**之间进行通信。当父组件向子组件传递数据时，可以通过 `Props`，而当子组件需要将数据或事件传递回父组件时，通常使用自定义事件。Vue 3 提供了组合式 API（`emit`）来实现子组件向父组件发送自定义事件。

### 1. **基本概念**

子组件可以通过 `emit` 来触发自定义事件，父组件通过监听这些事件来响应。当某些操作（如按钮点击、表单提交等）发生在子组件中，子组件会使用 `emit` 向父组件发送事件通知，父组件则可以监听这些事件并作出相应的处理。

### 2. **基本用法**

#### **步骤：**
- **子组件**：使用 `emit` 触发自定义事件。
- **父组件**：监听子组件的事件，并执行相应的操作。

#### **示例：基本用法**

##### **子组件（ChildComponent.vue）**
```vue
<template>
  <button @click="sendEvent">Click Me</button>
</template>

<script setup>
const emit = defineEmits(); // 使用 defineEmits 定义 emit

function sendEvent() {
  emit('my-custom-event', 'Hello from child component!');  // 触发事件并传递数据
}
</script>
```

##### **父组件（ParentComponent.vue）**
```vue
<template>
  <div>
    <ChildComponent @my-custom-event="handleEvent" />
  </div>
</template>

<script setup>
import ChildComponent from './ChildComponent.vue';

function handleEvent(message) {
  console.log(message);  // 接收来自子组件的事件数据
}
</script>
```

**解释：**
- 在子组件中，使用 `emit('my-custom-event')` 触发了一个名为 `my-custom-event` 的自定义事件，并将 `'Hello from child component!'` 作为数据传递出去。
- 在父组件中，通过 `@my-custom-event="handleEvent"` 监听这个自定义事件，并执行 `handleEvent` 方法，接收来自子组件的消息。

### 3. **使用 `defineEmits` 定义事件**

Vue 3 中，使用组合式 API `defineEmits` 来定义并使用 `emit`。这是在 `setup` 函数中触发自定义事件的标准方式。

#### **示例：定义 emit 事件**

```vue
<script setup>
const emit = defineEmits(['submit', 'cancel']);  // 定义了两个事件：submit 和 cancel

function onSubmit() {
  emit('submit', { name: 'John', age: 30 });  // 触发 submit 事件并传递对象数据
}

function onCancel() {
  emit('cancel');  // 触发 cancel 事件，不传递数据
}
</script>

<template>
  <button @click="onSubmit">Submit</button>
  <button @click="onCancel">Cancel</button>
</template>
```

**解释：**
- 使用 `defineEmits` 来定义了两个事件 `submit` 和 `cancel`。
- `onSubmit` 方法中使用 `emit('submit', { name: 'John', age: 30 })` 触发 `submit` 事件，并传递一个对象数据。
- `onCancel` 方法中触发了 `cancel` 事件，没有传递数据。

### 4. **父组件监听多个自定义事件**

父组件可以通过 `v-on` 或 `@` 指令监听子组件的多个自定义事件。

#### **示例：父组件监听多个事件**

```vue
<template>
  <ChildComponent @submit="handleSubmit" @cancel="handleCancel" />
</template>

<script setup>
import ChildComponent from './ChildComponent.vue';

function handleSubmit(data) {
  console.log('Submit event received:', data);
}

function handleCancel() {
  console.log('Cancel event received');
}
</script>
```

**解释：**
- 父组件通过 `@submit` 监听子组件的 `submit` 事件，通过 `@cancel` 监听 `cancel` 事件。
- 当 `submit` 事件被触发时，父组件会接收到传递的数据并处理；当 `cancel` 事件被触发时，父组件也会响应。

### 5. **带验证的自定义事件**

在 Vue 3 中，`defineEmits` 支持对事件进行类型验证。你可以通过传递一个函数来验证事件的参数是否符合预期。

#### **示例：带验证的自定义事件**

```vue
<script setup>
const emit = defineEmits({
  submit: (payload) => {
    if (typeof payload.name === 'string' && typeof payload.age === 'number') {
      return true;  // 验证通过
    } else {
      console.warn('Invalid payload for submit event');
      return false;  // 验证失败
    }
  }
});

function onSubmit() {
  emit('submit', { name: 'John', age: 30 });  // 如果验证通过，触发事件
}
</script>

<template>
  <button @click="onSubmit">Submit</button>
</template>
```

**解释：**
- 在 `defineEmits` 中，`submit` 事件带有一个验证函数，确保传入的 `payload` 中 `name` 是字符串，`age` 是数字。
- 如果验证失败，Vue 会在控制台输出警告信息，且事件不会被触发。

### 6. **使用 v-model 实现双向绑定**

在 Vue 3 中，自定义事件还可以用于实现双向数据绑定。Vue 3 使用 `v-model` 来简化这种双向绑定的逻辑。

#### **示例：使用 v-model 实现双向绑定**

##### **父组件**
```vue
<template>
  <ChildComponent v-model:title="title" />
  <p>Title in Parent: {{ title }}</p>
</template>

<script setup>
import { ref } from 'vue';
import ChildComponent from './ChildComponent.vue';

const title = ref('Default Title');
</script>
```

##### **子组件**
```vue
<template>
  <input v-model="localTitle" @input="updateTitle" />
</template>

<script setup>
const props = defineProps({
  title: String
});
const emit = defineEmits();

const localTitle = ref(props.title);  // 本地副本

function updateTitle() {
  emit('update:title', localTitle.value);  // 触发 update:title 事件，更新父组件数据
}
</script>
```

**解释：**
- 在父组件中，使用 `v-model:title` 绑定 `title`，使其实现双向数据绑定。
- 在子组件中，通过监听 `input` 事件并触发 `update:title` 自定义事件来更新父组件中的数据。
- 这种方式简化了父子组件之间的数据同步。

### 7. **总结**

- **自定义事件的基本流程**：子组件通过 `emit` 触发事件，父组件通过 `@event` 监听事件。
- **定义自定义事件**：使用 `defineEmits` 在子组件中定义事件名称和验证规则。
- **事件数据传递**：子组件可以通过 `emit` 传递数据，父组件可以接收并处理这些数据。
- **事件验证**：可以对自定义事件的数据进行验证，确保事件的参数类型和内容符合预期。
- **双向数据绑定**：通过 `v-model` 和自定义事件结合，可以实现子组件与父组件的数据同步。

自定义事件在 Vue 组件间的通信中扮演了重要角色，特别是在需要子组件向父组件发送消息时，帮助实现了数据和行为的解耦与复用。