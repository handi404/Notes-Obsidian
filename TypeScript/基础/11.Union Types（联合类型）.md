TypeScript 中的 **Union Types (联合类型)**。

### Union Types (联合类型)

**是什么？**

联合类型允许一个变量、函数参数或属性可以持有**多种类型中的一种**。它使用**竖线 `|`** 作为分隔符，表示“或”的关系。

**简单来说：** 一个值可以是类型 A **或** 类型 B **或** 类型 C ...

**语法：**

```typescript
let variableName: TypeA | TypeB | TypeC;
```

**为什么需要联合类型？**

1.  **增加灵活性**: 当一个值可能来自不同的源头，或者可以接受不同类型的输入时，联合类型非常有用。例如，一个函数可能接受数字 ID 或字符串 UUID。
2.  **精确建模**: 真实世界的数据往往不是单一类型的。API 响应、用户输入等可能包含多种可能性。联合类型可以精确地描述这些情况，而不是退回到使用 `any` 丢失类型信息。
3.  **替代 `null` / `undefined` 的显式处理**: 常常用来表示一个值可能存在也可能不存在（例如 `string | null` 或 `User | undefined`）。

**示例：**

```typescript
// 1. 变量可以是字符串或数字
let id: string | number;
id = 101;      // OK
id = "user-abc"; // OK
// id = true;  // Error: Type 'boolean' is not assignable to type 'string | number'.

// 2. 函数参数可以是字符串或字符串数组
function printMessage(message: string | string[]) {
  if (typeof message === "string") {
    console.log(message); // 这里 message 被推断为 string
  } else { // message 必定是 string[]
    message.forEach(msg => console.log(msg)); // 这里 message 被推断为 string[]
  }
}
printMessage("Hello!");
printMessage(["Hello", "World"]);

// 3. 表示可能为 null 的值
type User = { name: string };
let currentUser: User | null = null; // 可能还没有用户登录
// ... 登录逻辑后 ...
currentUser = { name: "Alice" };

// 4. 组合更复杂的类型
type Status = "pending" | "processing" | "success" | "error"; // 字面量联合类型
let currentStatus: Status = "pending";
// currentStatus = "failed"; // Error: Type '"failed"' is not assignable to type 'Status'.

interface Circle {
  kind: "circle"; // 字面量类型属性，作为判别属性 (Discriminant)
  radius: number;
}
interface Square {
  kind: "square";
  sideLength: number;
}
// 对象形状的联合类型 (常被称为 Discriminated Unions 或 Tagged Unions)
type Shape = Circle | Square;

function getArea(shape: Shape): number {
  // 使用判别属性来安全地访问特定属性
  if (shape.kind === "circle") {
    return Math.PI * shape.radius ** 2; // shape 被推断为 Circle
  } else {
    return shape.sideLength ** 2;       // shape 被推断为 Square
  }
}

let myCircle: Shape = { kind: "circle", radius: 5 };
let mySquare: Shape = { kind: "square", sideLength: 4 };
console.log(getArea(myCircle));
console.log(getArea(mySquare));
```

### 使用联合类型的注意事项 (类型窄化 - Type Narrowing)

当一个值的类型是联合类型时，TypeScript 只允许你访问**所有联合成员共有的**属性或方法。如果你想访问特定类型的成员，你需要先**缩小 (Narrow)** 类型的范围，让 TypeScript 确定当前值的具体类型。

**常见的类型窄化方法：**

1.  **`typeof` 检查**: 主要用于原始类型 (`"string"`, `"number"`, `"boolean"`, `"symbol"`, `"undefined"`, `"object"`, `"function"`, `"bigint"`)。
    ```typescript
    function processId(id: string | number) {
      if (typeof id === "string") {
        console.log(id.toUpperCase()); // OK, id is string here
      } else {
        console.log(id.toFixed(2));    // OK, id is number here
      }
    }
    ```
2.  **真值/假值判断 (Truthiness/Falsiness)**: 可以用来排除 `null`, `undefined`, `false`, `0`, `""` 等。
    ```typescript
    function printName(name: string | null | undefined) {
      if (name) {
        console.log(name.toUpperCase()); // OK, name is string here (non-null/undefined)
      } else {
        console.log("No name provided");
      }
    }
    ```
3.  **相等性检查**: 比如检查是否等于 `null` 或特定的字面量值。
    ```typescript
    function handleValue(value: string | number | null) {
      if (value !== null) {
        // value is string | number here
      }
      if (value === "hello") {
         // value is "hello" (string) here
      }
    }
    ```
4.  **`in` 操作符检查**: 检查对象是否具有某个属性。
    ```typescript
    type Fish = { swim: () => void };
    type Bird = { fly: () => void };
    function move(animal: Fish | Bird) {
      if ("swim" in animal) {
        animal.swim(); // OK, animal is Fish here
      } else {
        animal.fly();  // OK, animal is Bird here
      }
    }
    ```
5.  **`instanceof` 检查**: 用于检查一个值是否是某个类的实例。
    ```typescript
    class Cat { meow() {} }
    class Dog { bark() {} }
    function makeSound(pet: Cat | Dog) {
      if (pet instanceof Cat) {
        pet.meow(); // OK, pet is Cat here
      } else {
        pet.bark(); // OK, pet is Dog here
      }
    }
    ```
6.  **判别属性/标签 (Discriminated Unions)**: 如上面 `Shape` 示例所示，检查具有唯一字面量类型的公共属性 (`kind`) 是处理对象联合类型最常用且最可靠的方式。

### 总结

*   联合类型使用 `|` 表示一个值可以是多种类型之一。
*   它极大地提高了代码的灵活性和类型表达能力，是 `any` 的类型安全替代方案。
*   处理联合类型的值时，通常需要进行**类型窄化**，以确保安全地访问特定类型的属性或方法。
*   **Discriminated Unions** (使用公共字面量类型属性区分) 是处理对象联合类型的最佳实践之一。

联合类型是 TypeScript 类型系统中非常基础且强大的一个特性，理解并善用它可以让你的代码更加健壮和易于维护。