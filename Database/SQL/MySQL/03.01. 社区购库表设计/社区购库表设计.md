# 1. 复习、三范式

## 1.1. 抛出问题

```
问 数据库设计原则中三范式分别是什么？ 并用 老师表、老师授课表、学生表、
学生选课表，分别为三个范式举例说明什么是不规范的设计和规范的设计
答  ChatGPT
数据库设计的三范式是一组规范，用于确保数据库中的数据结构合理、有效地组织。
这三个范式分别是：
```

## 1.2. 第一范式

```
答   第一范式（1NF）：

    每个表中的每一列都是不可拆分的原子数据，确保每个字段的值都是单一的、不可再分的。
    例如，如果我们有一个老师表，其中有一个字段是 "教授科目"，这个字段包含多个科目，如 "数学, 物理"，则不符合第一范式。正确的做法是将其分解为多个原子值，每个字段对应一个科目。

plaintext

错误示例（不符合1NF）：
| 老师ID | 教授科目      |
|--------|--------------|
| 1      | 数学, 物理    |

正确示例（符合1NF）：
| 老师ID | 教授科目  |
|--------|----------|
| 1      | 数学     |
| 1      | 物理     |
```

## 1.3. 第一范式引发的思考：

SheQuGouV6A中，找出不满足第一范式的设计要求的地方

## 1.4. 第二范式

```
答  第二范式（2NF）：

    在满足第一范式的基础上，要求表中的非主键列完全依赖于所有主键列，而不是依赖于主键的一部分。
    举例，如果有一个课程表，其中包含 "学生ID"、"课程ID" 和 "教师姓名"，那么 "教师姓名" 依赖于 "学生ID" 和 "课程ID" 的联合主键，而不仅仅是 "学生ID"。

plaintext

错误示例（不符合2NF）：
| 学生ID | 课程ID | 教师姓名 |
|--------|--------|----------|
| 1      | 101    | 张三     |
| 1      | 102    | 李四     |

正确示例（符合2NF）：
| 学生ID | 课程ID | 
|--------|--------|
| 1      | 101    |
| 1      | 102    |

| 课程ID | 教师姓名 |
|--------|----------|
| 101    | 张三     |
| 102    | 李四     |
```

## 1.5. 第二范式引发的思考：

SheQuGouV6A中，找出不满足第二范式的设计要求的地方

## 1.6. 第三范式

```
在满足第二范式的基础上，要求表中的非主键列之间不能存在传递依赖关系。换句话说，如果 A 列依赖于 B 列，而 B 列又依赖于 C 列，那么 A 列不能直接依赖于 C 列。

例子：

考虑一个图书馆数据库，有一张包含学生信息和借阅记录的表。假设表结构如下：

plaintext

| 学生ID | 学生姓名 | 专业            | 借书日期   | 图书编号 | 图书名称       |
|--------|----------|-----------------|------------|----------|--------------|
| 101    | 小明     | 计算机科学       | 2022-01-01 | B001     | 数据结构       |
| 101    | 小明     | 计算机科学       | 2022-01-05 | B002     | 数据库原理     |
| 102    | 小红     | 电子工程         | 2022-02-01 | B003     | 电子电路       |
| 102    | 小红     | 电子工程         | 2022-02-10 | B004     | 信号与系统     |

在这个例子中，我们可以看到：

    学生ID和借书日期是主键。
    学生姓名和专业直接依赖于学生ID，符合第二范式（2NF）。
    图书编号、图书名称直接依赖于借书日期，也符合第二范式（2NF）。

然而，学生姓名和专业之间存在传递依赖，因为学生姓名直接依赖于学生ID，而专业又直接依赖于学生ID。为了符合第三范式（3NF），我们应该将学生姓名和专业分离成两张表：

学生表（Student）：

plaintext

| 学生ID | 学生姓名 | 专业          |
|--------|----------|---------------|
| 101    | 小明     | 计算机科学     |
| 102    | 小红     | 电子工程       |

借阅记录表（BorrowRecord）：

plaintext

| 学生ID | 借书日期   | 图书编号 | 图书名称       |
|--------|------------|----------|--------------|
| 101    | 2022-01-01 | B001     | 数据结构       |
| 101    | 2022-01-05 | B002     | 数据库原理     |
| 102    | 2022-02-01 | B003     | 电子电路       |
| 102    | 2022-02-10 | B004     | 信号与系统     |

通过这样的设计，消除了传递依赖，使得每个表都符合第三范式（3NF）。
```

## 1.7. 第三范式引发的思考：

SheQuGouV6A中，找出不满足第三范式的设计要求的地方

# 2. 库表结构图

## 2.1. SheQuGouV6中A版和B版的不同定位

1. SheQuGouV6A版是按照移动互联网型应用特点改造设计的；
2. SheQuGouV6B版是按照传统型应用特点改造设计的；

  

```
问  互联网型应用程序的数据库设计和传统型应用数据库设计的区别都有哪些？
答  ChatGPT

互联网型应用程序的数据库设计和传统型应用数据库设计之间存在一些区别，主要体现在以下几个方面：

    规模和并发性需求：
        互联网型应用： 通常面临大规模的数据和用户量，因此需要处理更高的并发性。
        	数据库设计需要考虑水平扩展，使用分布式数据库或分片技术，
        	以支持更大规模的数据存储和更高的并发访问。        
        传统型应用： 传统应用通常面对规模相对较小的用户和数据量，
        	垂直扩展（增加服务器性能）可能足以应对需求。

    数据模型和范式：
        互联网型应用： 常常采用更灵活的数据模型，可能选择反范式化设计，
        	以提高查询性能。NoSQL数据库在互联网型应用中也比较常见，
          因为它们能够更好地满足非结构化和大规模数据的存储需求。
        传统型应用： 传统应用通常采用规范的关系型数据库设计，遵循范式化规则，
        	以确保数据的一致性和避免冗余。

    数据访问和缓存：
        互联网型应用： 数据访问需要更高的性能和低延迟，因此可能会使用缓存技术，
        	如Redis或Memcached，以减轻数据库负担。数据库设计可能需要考虑缓存策略和数据分布。
        传统型应用： 对于相对较小的数据量，直接从数据库中检索数据可能足够，
        	不一定需要强调高级的缓存机制。

    多租户支持：
        互联网型应用： 需要考虑支持多租户架构，以便在单一数据库中为多个客户或租户提供服务。
        	这可能涉及到对数据隔离和安全性的更严格要求。
        传统型应用： 通常不涉及多租户支持，因为传统应用更偏向于专用架构。

    实时性要求：
        互联网型应用： 针对实时性要求更高，需要支持实时数据处理和查询。
        	时间序列数据库等技术可能被用于满足实时数据分析的需求。
        传统型应用： 实时性要求相对较低，数据处理通常是批处理方式，不需要立即响应。

总体而言，互联网型应用的数据库设计更加注重水平扩展、高并发、灵活性和实时性，
	而传统型应用则更注重规范性、一致性和相对较小规模的数据管理。
  在选择数据库和设计架构时，需要根据应用的特定需求和预期的规模来权衡这些因素。
```

## 2.2. 库实例名：SheQuGouV6B

因为简单，直接给出脚本

```
-- ----------------------------
--  1.  数据库的创建
-- ---------------------------- 

-- 删除数据库
DROP DATABASE IF EXISTS SheQuGouV6B;

-- 创建数据库
CREATE DATABASE SheQuGouV6B CHARACTER SET 'utf8mb4' COLLATE 'utf8mb4_bin';

-- 切换到新创建的数据库
USE SheQuGouV6B;
-- ----------------------------
--  2.  外键管理  
-- ----------------------------

-- 建表期间 取消外键约束 ，等数据导入完成后再重新设置值为1 开启外键约束 
SET FOREIGN_KEY_CHECKS=0;
-- SET FOREIGN_KEY_CHECKS=1;
```

## 2.3. 表总体需求

![](https://cdn.nlark.com/yuque/0/2023/jpeg/1727964/1700035710885-99c16fc2-9128-40d2-b513-2c048c72ba2f.jpeg)

## 2.4. 表的主要外键依赖关系图

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700899133894-6b6749c7-17e8-40a5-a958-a0218310001e.png)

# 3. 复习

## 3.1. 复习，什么是外键

```
问？ 什么是外键？主要用途有哪些，并用生活中的案例举例说明
答（ChatGPT）
外键（Foreign Key）是数据库中一种约束，用于建立表与表之间的关联关系。外键定义了一个表中的列（或一组列），这些列的值必须在另一表的主键列（或唯一键列）中存在。外键用于维护数据的完整性和一致性。

主要用途：

    确保数据完整性： 外键确保在引用表中插入或更新记录时，相关的参照表中的数据是存在的。这有助于防止引用表中的“孤儿记录”，即引用了不存在的记录。

    建立表之间的关联关系： 外键用于建立表与表之间的关联，使得表之间可以通过共同的列（主键和外键）进行连接，从而进行复杂的查询和数据检索。

    维护数据一致性： 外键的存在有助于维护数据的一致性。当主表中的主键值发生变化时，外键表中的相关数据也会相应地发生变化或被删除，以保持关联数据的一致性。

生活中的案例：

考虑一个图书馆管理系统的数据库，其中有两个表：Books 表和 Borrowers 表。这两个表可以通过图书的 ISBN 编号建立关联。在这个例子中，Books 表的 ISBN 列是主键，而 Borrowers 表的 ISBN 列是外键，它引用了 Books 表的 ISBN 列。

sql

CREATE TABLE Books (
    ISBN INT PRIMARY KEY,
    Title VARCHAR(255),
    Author VARCHAR(255)
);

CREATE TABLE Borrowers (
    BorrowerID INT PRIMARY KEY,
    BookISBN INT,
    BorrowerName VARCHAR(255),
    FOREIGN KEY (BookISBN) REFERENCES Books(ISBN) ON DELETE CASCADE
);

在这个例子中，Borrowers 表中的 BookISBN 列是外键，它引用了 Books 表的 ISBN 列。这表示借阅者只能借阅实际存在于图书馆中的图书，确保了借阅记录的完整性。如果某本书被删除了，与之关联的借阅记录也会被级联删除，从而保持了数据的一致性。
```

## 3.2. 复习，外键约束

```
ChatGPT
问 mysql 中外键有哪几种约束类型 ，
答  在 MySQL 中，外键（Foreign Key）可以使用不同的约束类型，
  这些约束类型定义了外键与参考表的关系，包括行为和完整性。
  以下是 MySQL 中外键的几种约束类型：

    CASCADE（级联）：
        当主表的记录被删除或更新时，从表中相关的记录也会被删除或更新。
        CASCADE 约束是一种自动维护引用完整性的方式。

    sql

CREATE TABLE orders (
  order_id INT PRIMARY KEY,
  customer_id INT,
  FOREIGN KEY (customer_id) REFERENCES customers(customer_id) ON DELETE CASCADE ON UPDATE CASCADE
);

SET NULL：

    当主表的记录被删除或更新时，从表中相关的外键列将被设置为 NULL。这要求外键列允许存储 NULL 值。

sql

CREATE TABLE orders (
  order_id INT PRIMARY KEY,
  customer_id INT,
  FOREIGN KEY (customer_id) REFERENCES customers(customer_id) ON DELETE SET NULL ON UPDATE SET NULL
);

SET DEFAULT：

    当主表的记录被删除或更新时，从表中相关的外键列将被设置为默认值。这要求外键列有一个默认值。

sql

CREATE TABLE orders (
  order_id INT PRIMARY KEY,
  customer_id INT,
  FOREIGN KEY (customer_id) REFERENCES customers(customer_id) ON DELETE SET DEFAULT ON UPDATE SET DEFAULT
);

RESTRICT：

    在 RESTRICT 约束下，当主表的记录被删除或更新时，如果在外键列上存在相关的从表记录，则不允许删除或更新主表记录。RESTRICT 是一种保护约束。

sql

CREATE TABLE orders (
  order_id INT PRIMARY KEY,
  customer_id INT,
  FOREIGN KEY (customer_id) REFERENCES customers(customer_id) ON DELETE RESTRICT ON UPDATE RESTRICT
);

NO ACTION：

    类似于 RESTRICT，当主表的记录被删除或更新时，如果在外键列上存在相关的从表记录，则不允许删除或更新主表记录。

sql

    CREATE TABLE orders (
      order_id INT PRIMARY KEY,
      customer_id INT,
      FOREIGN KEY (customer_id) REFERENCES customers(customer_id) ON DELETE NO ACTION ON UPDATE NO ACTION
    );

这些约束类型允许你定义在进行插入、更新或删除操作时，MySQL 数据库如何处理与外键关联的数据。选择适当的约束类型取决于你的业务需求和数据完整性的要求。
```

## 3.3. 存储过程和触发器

后面学习

# 4. 整理表的外键依赖关系

1. FK ：外键
2. 约束： 目前还没有实现外键约束
3. 冗余：采用冗余，替代外键约束

![](https://cdn.nlark.com/yuque/0/2023/jpeg/1727964/1701053632907-6b3ec58b-aab9-49cf-a305-19924bc0aac9.jpeg)

# 5. 准备工作

1. 执行素材文件SheQuGouV6B1.sql，创建数据库SheQuGouV6B；
2. 目前阶段SheQuGouV6B的表，是没有任何外键的；
3. 后续任务，就是根据前面的依赖关系，为表添加外键，并测试数据外键约束；

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700882702618-5dafc3e9-ef20-47f0-8d54-b3b4798cccb9.png)

# 6. 为表t_dish引入外键

## 6.1. 入口

1. 【标5】处一般默认为空白，不建议填写名称；
2. 【标8】处，可以采用默认值，也可以根据需要修改
3. 【标6】处的3项，通过下拉选择的

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700346224547-57fdc8a2-d831-4bed-8313-46e2e9a35f7d.png)

## 6.2. 预览

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700346390884-f1925f99-8f0c-4618-a816-73d262208943.png)

## 6.3. 保存后回看，默认值自动填写

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1701063871089-7a77897c-0d9c-47a2-baed-f4b1623a024c.png)

## 6.4. 转储SQL文件

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1701064027011-c43d7edc-bf57-4f53-8993-7e74194d693a.png)

## 6.5. 查看转储的 SQL

1. 注意第18行和第72行

```
/*
 Navicat Premium Data Transfer

 Source Server         : local
 Source Server Type    : MySQL
 Source Server Version : 80033
 Source Host           : localhost:3306
 Source Schema         : shequgouv6b

 Target Server Type    : MySQL
 Target Server Version : 80033
 File Encoding         : 65001

 Date: 19/11/2023 06:05:24
*/

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for t_dish
-- ----------------------------
DROP TABLE IF EXISTS `t_dish`;
CREATE TABLE `t_dish`  (
  `id` bigint(0) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '菜品名称',
  `category_id` bigint(0) NOT NULL COMMENT '菜品分类id',
  `price` decimal(10, 2) NULL DEFAULT NULL COMMENT '菜品价格',
  `image` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '图片网址',
  `description` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '描述信息',
  `status` tinyint(0) NULL DEFAULT 1 COMMENT '0 停售 1 起售',
  `sort` int(0) NOT NULL DEFAULT 0 COMMENT '排序',
  `create_time` datetime(0) NULL DEFAULT NULL COMMENT '创建时间',
  `update_time` datetime(0) NULL DEFAULT NULL COMMENT '更新时间',
  `create_user` bigint(0) NULL DEFAULT NULL COMMENT '创建人',
  `update_user` bigint(0) NULL DEFAULT NULL COMMENT '修改人',
  `is_deleted` tinyint(0) NOT NULL DEFAULT 0 COMMENT '逻辑删除标记 0正常 1删除',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `idx_t_dish_name`(`name`) USING BTREE,
  INDEX `category_id`(`category_id`) USING BTREE,
  CONSTRAINT `t_dish_ibfk_1` FOREIGN KEY (`category_id`) REFERENCES `t_category` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 170 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin COMMENT = '菜品表' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of t_dish
-- ----------------------------
INSERT INTO `t_dish` VALUES (46, '王老吉', 11, 6.01, 'p1.png', '红罐王老吉', 1, 10, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (47, '北冰洋', 11, 4.02, 'p2.png', '还是小时候的味道', 1, 20, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (48, '雪花啤酒', 11, 4.03, 'p3.png', '雪花', 1, 30, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (49, '米饭', 12, 2.04, 'p4.png', '精选五常大米', 1, 10, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (50, '馒头', 12, 1.05, 'p5.png', '优质面粉', 1, 20, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (51, '草鱼2斤', 13, 68.20, 'p6.png', '原料：草鱼，黄豆芽，莲藕', 1, 10, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (52, '江团鱼2斤', 13, 119.21, 'p7.png', '配料：江团鱼，黄豆芽，莲藕', 1, 20, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (53, '鮰鱼2斤', 13, 72.22, 'p8.png', '原料：鮰鱼，黄豆芽，莲藕', 1, 30, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (54, '金汤酸菜牛蛙', 14, 88.17, 'p9.png', '原料：鲜活牛蛙，酸菜', 1, 40, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (55, '香锅牛蛙', 14, 88.18, 'p10.png', '配料：鲜活牛蛙，莲藕，青笋', 1, 50, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (56, '馋嘴牛蛙', 14, 88.19, 'p11.png', '配料：鲜活牛蛙，丝瓜，黄豆芽', 1, 60, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (57, '清蒸鲈鱼', 15, 98.13, 'p12.png', '原料：鲈鱼', 1, 10, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (58, '东坡肘子', 15, 138.14, 'p13.png', '原料：猪肘棒', 1, 20, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (59, '梅菜扣肉', 15, 58.15, 'p14.png', '原料：猪肉，梅菜', 1, 30, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (60, '剁椒鱼头', 15, 66.16, 'p15.png', '原料：鲢鱼，剁椒', 1, 40, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (61, '清炒小油菜', 16, 18.09, 'p16.png', '原料：小油菜', 1, 10, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (62, '蒜蓉娃娃菜', 16, 18.10, 'p17.png', '原料：蒜，娃娃菜', 1, 20, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (63, '清炒西兰花', 16, 18.11, 'p18.png', '原料：西兰花', 1, 30, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (64, '炝炒圆白菜', 16, 18.12, 'p19.png', '原料：圆白菜', 1, 40, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (65, '老坛酸菜鱼', 17, 56.06, 'p20.png', '原料：汤，草鱼，酸菜', 1, 10, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (66, '经典酸菜鮰鱼', 17, 66.07, 'p21.png', '原料：酸菜，江团，鮰鱼', 1, 20, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (67, '蜀味水煮草鱼', 17, 38.08, 'p22.png', '原料：草鱼，汤', 1, 30, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (68, '鸡蛋汤', 18, 4.23, 'p23.png', '配料：鸡蛋，紫菜', 1, 10, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (69, '平菇豆腐汤', 18, 6.24, 'p24.png', '配料：豆腐，平菇', 1, 20, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);

SET FOREIGN_KEY_CHECKS = 1;
```

# 7. 测试表t_dish的外键

## 7.1. 测试1.外键表中缺失对应主键值

1. 在表t_dish中插入一条字段category_id为501的记录，因为t_category中有无id为501的记录，提交时看看报什么错误；

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700895988413-62be8ba3-4052-4d62-8144-6ccb3ec3d14d.png)

（2）再把category_id的值修改为 表t_category中有的值，例如 17，是否允许提交？ 为什么？

（3）再把category_id的值修改为null观察，是否允许提交？如果把字段category_id设计为允许为空，是否允许提交呢？

（4）再把新添加的记录删除掉，是否允许提交？

## 7.2. 测试2.在外键表中删除子表中有依赖的记录

（1） 把父表t_category中id值为16的记录删除，是否允许提交？ 为什么？

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700897046340-19b7d4ec-9af8-4f8d-a03b-0f13b2f89c52.png)

（2） 在父表t_category中，把刚才的ID值由17修改为501，是否允许？修改非ID字段呢，是否允许？

（3） 在父表t_category新添加一条记录，是否允许提交？ 是否允许删除？ 为什么？

# 8. 巩固练习

1. 按照【3.整理表的外键依赖关系】所示，为下面的表添加外键外键依赖

## 8.1. 为套餐表引入外键

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700347214975-46a015e0-d7a5-429f-86ab-ac584d7949f7.png)

## 8.2. 为套餐菜品表引入双外键

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700347634643-1333cd59-cf9a-4a3a-a7cc-9ef7ca70634c.png)

## 8.3. 为购物表引入三个外键

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700898725780-2391fce0-39ea-478f-bcdd-ebfe9d792735.png)

## 8.4. 为订单表引入外键

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700347904832-caa20f69-1d73-4922-9bba-0a6ea41483d9.png)

## 8.5. 为订单详情表引入三个外键

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700899050676-83e0cec0-8b67-42e5-bf4f-087caa77b90d.png)

# 9. 传统需求下社区购表总模型

## 9.1. 转储整个库表

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700348089970-76bc576d-aa23-4563-9fd2-900bc0e8826a.png)

## 9.2. 数据模型总示意图

1. 【标5】为缩略图，【标6】为对象结构图；
2. 选中【标7】所示的表，有蓝色和绿色的外键关联线，蓝色为本表所依赖的其它表的字段作为外键，绿色为本表有字段作为其它表的外键；

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700899334967-34fe7cfb-d2cb-4c93-9686-e47e8da7f665.png)

## 9.3. 附 转储的库表结构

```
/*
 Navicat Premium Data Transfer

 Source Server         : local
 Source Server Type    : MySQL
 Source Server Version : 80033
 Source Host           : localhost:3306
 Source Schema         : shequgouv6b

 Target Server Type    : MySQL
 Target Server Version : 80033
 File Encoding         : 65001

 Date: 25/11/2023 16:27:13
*/

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for t_address_book
-- ----------------------------
DROP TABLE IF EXISTS `t_address_book`;
CREATE TABLE `t_address_book`  (
  `id` bigint NOT NULL COMMENT '主键，没有采用自增主键，默认为雪花算法',
  `user_id` bigint NOT NULL COMMENT '用户id',
  `consignee` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '收货人',
  `gender` tinyint NOT NULL DEFAULT 2 COMMENT '性别 1男 2女 3未知',
  `phone` varchar(11) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '手机号',
  `province_code` varchar(12) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '省级区划编号(备用)',
  `province_name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '省级名称(备用)',
  `city_code` varchar(12) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '市级区划编号(备用)',
  `city_name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '市级名称(备用)',
  `district_code` varchar(12) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '区级区划编号(备用)',
  `district_name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '区级名称(备用)',
  `detail` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '详细地址：目前只用到这个',
  `label` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '标签提醒:学校、公司、家等 ',
  `is_default` tinyint NOT NULL DEFAULT 0 COMMENT '默认 0 否 1是',
  `create_time` datetime NOT NULL COMMENT '创建时间',
  `update_time` datetime NOT NULL COMMENT '更新时间',
  `create_user` bigint NOT NULL COMMENT '创建人',
  `update_user` bigint NOT NULL COMMENT '修改人',
  `is_deleted` tinyint NOT NULL DEFAULT 0 COMMENT '逻辑删除标记 0正常 1删除',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `t_address_book_userid_index`(`user_id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin COMMENT = '快递地址管理' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of t_address_book
-- ----------------------------
INSERT INTO `t_address_book` VALUES (10, 1001, '菜鸟驿站代收', 1, '13812341234', '41', '河南省', '01', '郑州市', '10', '高新区', '郑州大学', '学校', 0, '2023-08-01 10:15:28', '2023-08-01 10:15:51', 1001, 1001, 0);
INSERT INTO `t_address_book` VALUES (11, 1001, '菜鸟驿站代收', 2, '13812341234', '41', '河南省', '01', '郑州市', '10', '高新区', '郑州大学', '家', 0, '2023-08-01 10:15:28', '2023-08-01 10:15:51', 1001, 1001, 0);
INSERT INTO `t_address_book` VALUES (12, 1001, '前台代收', 3, '13812341234', '41', '河南省', '01', '郑州市', '10', '高新区', '郑州大学', '公司', 1, '2023-08-01 10:15:28', '2023-08-01 10:15:51', 1001, 1001, 0);

-- ----------------------------
-- Table structure for t_category
-- ----------------------------
DROP TABLE IF EXISTS `t_category`;
CREATE TABLE `t_category`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键',
  `type` tinyint NULL DEFAULT 1 COMMENT '类型: 1菜品分类, 2套餐分类',
  `name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '分类名称',
  `sort` int NOT NULL DEFAULT 0 COMMENT '顺序',
  `status` tinyint NULL DEFAULT 1 COMMENT '分类状态 0:停用,1:启用',
  `create_time` datetime NULL DEFAULT NULL COMMENT '创建时间',
  `update_time` datetime NULL DEFAULT NULL COMMENT '更新时间',
  `create_user` bigint NULL DEFAULT NULL COMMENT '创建人',
  `update_user` bigint NULL DEFAULT NULL COMMENT '修改人',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `idx_t_category_name`(`name`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 201 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin COMMENT = '菜品及套餐分类' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of t_category
-- ----------------------------
INSERT INTO `t_category` VALUES (11, 1, '酒水饮料', 10, 1, '2023-08-28 22:09:18', '2023-08-28 22:09:18', 1001, 1001);
INSERT INTO `t_category` VALUES (12, 1, '传统主食', 20, 1, '2023-08-28 22:09:32', '2023-08-28 22:09:18', 1001, 1001);
INSERT INTO `t_category` VALUES (13, 1, '蜀味烤鱼', 30, 1, '2023-08-28 22:15:37', '2023-08-28 22:09:18', 1001, 1001);
INSERT INTO `t_category` VALUES (14, 1, '蜀味牛蛙', 40, 1, '2023-08-28 22:16:14', '2023-08-28 22:09:18', 1001, 1001);
INSERT INTO `t_category` VALUES (15, 1, '特色蒸菜', 50, 1, '2023-08-28 22:09:18', '2023-08-28 22:09:18', 1001, 1001);
INSERT INTO `t_category` VALUES (16, 1, '新鲜时蔬', 60, 1, '2023-08-28 22:09:18', '2023-08-28 22:09:18', 1001, 1001);
INSERT INTO `t_category` VALUES (17, 1, '水煮鱼', 70, 1, '2023-08-28 22:09:18', '2023-08-28 22:09:18', 1001, 1001);
INSERT INTO `t_category` VALUES (18, 1, '汤类', 80, 1, '2023-08-28 22:09:18', '2023-08-28 22:09:18', 1001, 1001);
INSERT INTO `t_category` VALUES (101, 2, '工作套餐', 220, 1, '2023-08-28 22:09:18', '2023-08-28 22:09:18', 1001, 1001);
INSERT INTO `t_category` VALUES (102, 2, '商务套餐', 230, 1, '2023-08-28 22:09:18', '2023-08-28 22:09:18', 1001, 1001);

-- ----------------------------
-- Table structure for t_dish
-- ----------------------------
DROP TABLE IF EXISTS `t_dish`;
CREATE TABLE `t_dish`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键',
  `name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '菜品名称',
  `category_id` bigint NULL DEFAULT NULL COMMENT '菜品分类id ,外键测试期间，值允许为空',
  `price` decimal(10, 2) NULL DEFAULT NULL COMMENT '菜品价格',
  `image` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '图片网址',
  `description` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '描述信息',
  `status` tinyint NULL DEFAULT 1 COMMENT '0 停售 1 起售',
  `sort` int NOT NULL DEFAULT 0 COMMENT '排序',
  `create_time` datetime NULL DEFAULT NULL COMMENT '创建时间',
  `update_time` datetime NULL DEFAULT NULL COMMENT '更新时间',
  `create_user` bigint NULL DEFAULT NULL COMMENT '创建人',
  `update_user` bigint NULL DEFAULT NULL COMMENT '修改人',
  `is_deleted` tinyint NOT NULL DEFAULT 0 COMMENT '逻辑删除标记 0正常 1删除',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `idx_t_dish_name`(`name`) USING BTREE,
  INDEX `category_id`(`category_id`) USING BTREE,
  CONSTRAINT `t_dish_ibfk_1` FOREIGN KEY (`category_id`) REFERENCES `t_category` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 170 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin COMMENT = '菜品表' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of t_dish
-- ----------------------------
INSERT INTO `t_dish` VALUES (46, '王老吉', 11, 6.01, 'p1.png', '红罐王老吉', 1, 10, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (47, '北冰洋', 11, 4.02, 'p2.png', '还是小时候的味道', 1, 20, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (48, '雪花啤酒', 11, 4.03, 'p3.png', '雪花', 1, 30, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (49, '米饭', 12, 2.04, 'p4.png', '精选五常大米', 1, 10, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (50, '馒头', 12, 1.05, 'p5.png', '优质面粉', 1, 20, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (51, '草鱼2斤', 13, 68.20, 'p6.png', '原料：草鱼，黄豆芽，莲藕', 1, 10, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (52, '江团鱼2斤', 13, 119.21, 'p7.png', '配料：江团鱼，黄豆芽，莲藕', 1, 20, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (53, '鮰鱼2斤', 13, 72.22, 'p8.png', '原料：鮰鱼，黄豆芽，莲藕', 1, 30, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (54, '金汤酸菜牛蛙', 14, 88.17, 'p9.png', '原料：鲜活牛蛙，酸菜', 1, 40, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (55, '香锅牛蛙', 14, 88.18, 'p10.png', '配料：鲜活牛蛙，莲藕，青笋', 1, 50, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (56, '馋嘴牛蛙', 14, 88.19, 'p11.png', '配料：鲜活牛蛙，丝瓜，黄豆芽', 1, 60, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (57, '清蒸鲈鱼', 15, 98.13, 'p12.png', '原料：鲈鱼', 1, 10, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (58, '东坡肘子', 15, 138.14, 'p13.png', '原料：猪肘棒', 1, 20, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (59, '梅菜扣肉', 15, 58.15, 'p14.png', '原料：猪肉，梅菜', 1, 30, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (60, '剁椒鱼头', 15, 66.16, 'p15.png', '原料：鲢鱼，剁椒', 1, 40, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (61, '清炒小油菜', 16, 18.09, 'p16.png', '原料：小油菜', 1, 10, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (62, '蒜蓉娃娃菜', 16, 18.10, 'p17.png', '原料：蒜，娃娃菜', 1, 20, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (63, '清炒西兰花', 16, 18.11, 'p18.png', '原料：西兰花', 1, 30, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (64, '炝炒圆白菜', 16, 18.12, 'p19.png', '原料：圆白菜', 1, 40, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (65, '老坛酸菜鱼', 17, 56.06, 'p20.png', '原料：汤，草鱼，酸菜', 1, 10, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (66, '经典酸菜鮰鱼', 17, 66.07, 'p21.png', '原料：酸菜，江团，鮰鱼', 1, 20, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (67, '蜀味水煮草鱼', 17, 38.08, 'p22.png', '原料：草鱼，汤', 1, 30, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (68, '鸡蛋汤', 18, 4.23, 'p23.png', '配料：鸡蛋，紫菜', 1, 10, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);
INSERT INTO `t_dish` VALUES (69, '平菇豆腐汤', 18, 6.24, 'p24.png', '配料：豆腐，平菇', 1, 20, '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001, 0);

-- ----------------------------
-- Table structure for t_dish_flavor
-- ----------------------------
DROP TABLE IF EXISTS `t_dish_flavor`;
CREATE TABLE `t_dish_flavor`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键',
  `dish_id` bigint NOT NULL COMMENT '菜品',
  `name` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '口味名称',
  `value` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '口味数据list',
  `create_time` datetime NOT NULL COMMENT '创建时间',
  `update_time` datetime NOT NULL COMMENT '更新时间',
  `create_user` bigint NOT NULL COMMENT '创建人',
  `update_user` bigint NOT NULL COMMENT '修改人',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_t_dish_flavor_dish_id`(`dish_id`) USING BTREE,
  CONSTRAINT `t_dish_flavor_ibfk_1` FOREIGN KEY (`dish_id`) REFERENCES `t_dish` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 1001 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin COMMENT = '菜品口味关系表' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of t_dish_flavor
-- ----------------------------
INSERT INTO `t_dish_flavor` VALUES (101, 46, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 09:37:27', '2023-08-28 09:37:27', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (102, 46, '忌口', '[\"不要葱\",\"不要蒜\",\"不要香菜\",\"不要辣\"]', '2023-08-28 09:38:43', '2023-08-28 09:38:43', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (103, 47, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 09:38:43', '2023-08-28 09:38:43', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (104, 47, '忌口', '[\"不要葱\",\"不要蒜\",\"不要香菜\",\"不要辣\"]', '2023-08-28 09:39:30', '2023-08-28 09:39:30', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (105, 48, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 09:39:30', '2023-08-28 09:39:30', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (106, 48, '忌口', '[\"不要葱\",\"不要蒜\",\"不要香菜\",\"不要辣\"]', '2023-08-28 09:40:19', '2023-08-28 09:40:19', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (107, 49, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 09:40:19', '2023-08-28 09:40:19', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (108, 50, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 09:41:19', '2023-08-28 09:41:19', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (109, 51, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 09:41:19', '2023-08-28 09:41:19', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (110, 51, '忌口', '[\"不要葱\",\"不要蒜\",\"不要香菜\",\"不要辣\"]', '2023-08-28 09:42:16', '2023-08-28 09:42:16', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (111, 52, '辣度', '[\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 09:42:16', '2023-08-28 09:42:16', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (112, 52, '忌口', '[\"不要蒜\",\"不要香菜\",\"不要辣\"]', '2023-08-28 09:43:08', '2023-08-28 09:43:08', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (113, 53, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 09:43:08', '2023-08-28 09:43:08', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (114, 53, '忌口', '[\"不要葱\",\"不要蒜\",\"不要香菜\",\"不要辣\"]', '2023-08-28 09:44:08', '2023-08-28 09:44:08', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (115, 54, '辣度', '[\"不辣\",\"微辣\",\"中辣\"]', '2023-08-28 09:44:08', '2023-08-28 09:44:08', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (116, 54, '温度', '[\"热饮\",\"常温\",\"去冰\",\"少冰\",\"多冰\"]', '2023-08-28 09:45:12', '2023-08-28 09:45:12', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (117, 54, '忌口', '[\"不要葱\",\"不要蒜\",\"不要香菜\",\"不要辣\"]', '2023-08-28 09:45:12', '2023-08-28 09:45:12', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (118, 55, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 09:45:12', '2023-08-28 09:45:12', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (119, 56, '温度', '[\"热饮\",\"常温\",\"去冰\",\"少冰\",\"多冰\"]', '2023-08-28 09:46:23', '2023-08-28 09:46:23', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (120, 56, '忌口', '[\"不要葱\",\"不要香菜\",\"不要辣\"]', '2023-08-28 09:49:16', '2023-08-28 09:49:16', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (121, 57, '辣度', '[\"不辣\",\"微辣\",\"重辣\"]', '2023-08-28 09:49:16', '2023-08-28 09:49:16', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (122, 58, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 09:52:24', '2023-08-28 09:52:24', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (123, 59, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 09:53:22', '2023-08-28 09:53:22', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (124, 59, '忌口', '[\"不要葱\",\"不要蒜\",\"不要香菜\",\"不要辣\"]', '2023-08-28 09:54:30', '2023-08-28 09:54:30', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (125, 60, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 09:55:13', '2023-08-28 09:55:13', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (126, 60, '温度', '[\"热饮\",\"常温\",\"去冰\",\"少冰\",\"多冰\"]', '2023-08-28 09:56:11', '2023-08-28 09:56:11', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (127, 60, '忌口', '[\"不要葱\",\"不要蒜\",\"不要香菜\",\"不要辣\"]', '2023-08-28 09:58:15', '2023-08-28 09:58:15', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (128, 61, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 09:58:15', '2023-08-28 09:58:15', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (129, 62, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 09:59:06', '2023-08-28 09:59:06', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (130, 63, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 10:02:35', '2023-08-28 10:02:35', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (131, 63, '忌口', '[\"不要葱\",\"不要蒜\",\"不要香菜\",\"不要辣\"]', '2023-08-28 10:03:14', '2023-08-28 10:03:14', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (134, 64, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 10:04:21', '2023-08-28 10:04:21', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (135, 65, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 10:15:45', '2023-08-28 10:15:45', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (136, 66, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 10:16:37', '2023-08-28 10:16:37', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (137, 67, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 10:17:27', '2023-08-28 10:17:27', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (138, 67, '甜味', '[\"无糖\",\"少糖\",\"半躺\",\"多糖\",\"全糖\"]', '2023-08-28 10:18:32', '2023-08-28 10:18:32', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (139, 68, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 10:20:27', '2023-08-28 10:20:27', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (140, 69, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 10:23:19', '2023-08-28 10:23:19', 1001, 1001);
INSERT INTO `t_dish_flavor` VALUES (151, 69, '甜味', '[\"无糖\",\"少糖\",\"半躺\",\"多糖\",\"全糖\"]', '2023-08-28 10:24:00', '2023-08-28 10:24:00', 1001, 1001);

-- ----------------------------
-- Table structure for t_employee
-- ----------------------------
DROP TABLE IF EXISTS `t_employee`;
CREATE TABLE `t_employee`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键,自动增长',
  `name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '姓名',
  `gh` int NOT NULL COMMENT '工号',
  `username` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '用户登录名',
  `password` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '密码',
  `phone` varchar(11) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '手机号',
  `gender` tinyint NOT NULL DEFAULT 1 COMMENT '性别 1男 2女 3未知',
  `id_number` varchar(18) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '身份证号',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态 1:启用,2:未激活、3:临时停用、4:离职停用',
  `create_time` datetime NOT NULL COMMENT '创建时间',
  `update_time` datetime NOT NULL COMMENT '更新时间',
  `create_user` bigint NOT NULL COMMENT '创建人',
  `update_user` bigint NOT NULL COMMENT '修改人',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `idx_t_employee_username`(`username`) USING BTREE,
  UNIQUE INDEX `idx_t_employee_gh`(`gh`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1101 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin COMMENT = '员工表' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of t_employee
-- ----------------------------
INSERT INTO `t_employee` VALUES (1001, '管理员1', 10, 'admin', 'e10adc3949ba59abbe56e057f20f883e', '13812341234', 1, '110102020101000041', 1, '2023-08-28 15:51:20', '2023-08-28 09:16:20', 1001, 1001);
INSERT INTO `t_employee` VALUES (1002, '管理员2', 11, 'root', 'e10adc3949ba59abbe56e057f20f883e', '13812341234', 2, '110101202010100042', 1, '2023-08-28 15:51:20', '2023-08-28 09:16:20', 1001, 1001);
INSERT INTO `t_employee` VALUES (1003, '张三', 12, 'zhangsan', 'e10adc3949ba59abbe56e057f20f883e', '13812341234', 1, '110101202010100042', 1, '2023-08-28 15:51:20', '2023-08-28 09:16:20', 1001, 1001);
INSERT INTO `t_employee` VALUES (1004, '李四', 13, 'lsii', 'e10adc3949ba59abbe56e057f20f883e', '13812341234', 2, '110101202010100042', 1, '2023-08-28 15:51:20', '2023-08-28 09:16:20', 1001, 1001);
INSERT INTO `t_employee` VALUES (1005, '王五', 14, 'wangwu', 'e10adc3949ba59abbe56e057f20f883e', '13812341234', 1, '110101202010100042', 1, '2023-08-28 15:51:20', '2023-08-28 09:16:20', 1001, 1001);
INSERT INTO `t_employee` VALUES (1006, '赵六', 15, 'zhangliu', 'e10adc3949ba59abbe56e057f20f883e', '13812341234', 2, '110101202010100042', 1, '2023-08-28 15:51:20', '2023-08-28 09:16:20', 1001, 1001);

-- ----------------------------
-- Table structure for t_flavor
-- ----------------------------
DROP TABLE IF EXISTS `t_flavor`;
CREATE TABLE `t_flavor`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键',
  `name` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '口味名称',
  `value` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '口味数据list',
  `create_time` datetime NOT NULL COMMENT '创建时间',
  `update_time` datetime NOT NULL COMMENT '更新时间',
  `create_user` bigint NOT NULL COMMENT '创建人',
  `update_user` bigint NOT NULL COMMENT '修改人',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 107 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin COMMENT = '菜品口味表' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of t_flavor
-- ----------------------------
INSERT INTO `t_flavor` VALUES (101, '辣度', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001);
INSERT INTO `t_flavor` VALUES (102, '忌口', '[\"不要葱\",\"不要蒜\",\"不要香菜\",\"不要辣\"]', '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001);
INSERT INTO `t_flavor` VALUES (103, '温度', '[\"热饮\",\"常温\",\"去冰\",\"少冰\",\"多冰\"]', '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001);
INSERT INTO `t_flavor` VALUES (104, '甜味', '[\"无糖\",\"少糖\",\"半躺\",\"多糖\",\"全糖\"]', '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001);
INSERT INTO `t_flavor` VALUES (105, '份量', '[\"小份\",\"中份\",\"大份\"]', '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001);
INSERT INTO `t_flavor` VALUES (106, '套餐', '[\"套餐1\",\"套餐2\",\"套餐3\",\"套餐4\"]', '2023-08-28 22:40:47', '2023-08-28 22:40:47', 1001, 1001);

-- ----------------------------
-- Table structure for t_orders
-- ----------------------------
DROP TABLE IF EXISTS `t_orders`;
CREATE TABLE `t_orders`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键',
  `tracking_number` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '快递单号，雪花算法模拟物流订单',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '订单状态: 1待付款 2付款未确认 3待接单 4已接单 5派送中 6已完成 7已取消 8退款',
  `user_id` bigint NOT NULL COMMENT '下单用户id',
  `address_book_id` bigint NOT NULL COMMENT '地址id',
  `order_time` datetime NOT NULL COMMENT '下单时间',
  `checkout_time` datetime NULL DEFAULT NULL COMMENT '结账时间',
  `pay_method` tinyint NOT NULL DEFAULT 4 COMMENT '支付方式 1微信,2支付宝,3网银,4,其它',
  `pay_status` tinyint NOT NULL DEFAULT 0 COMMENT '支付状态: 0未支付 1已支付 2支付确认  3退款',
  `amount` decimal(10, 2) NOT NULL COMMENT '实收金额',
  `remark` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '备注',
  `phone` varchar(11) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '手机号',
  `address` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '地址,冗余字段',
  `user_name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '用户名称,冗余字段',
  `consignee` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '收货人,冗余字段',
  `cancel_reason` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '订单取消原因',
  `rejection_reason` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '订单拒绝原因',
  `cancel_time` datetime NULL DEFAULT NULL COMMENT '订单取消时间',
  `estimated_delivery_time` datetime NULL DEFAULT NULL COMMENT '预计送达时间',
  `delivery_status` tinyint NOT NULL DEFAULT 1 COMMENT '配送状态  1立即送出  0选择具体时间',
  `delivery_time` datetime NULL DEFAULT NULL COMMENT '送达时间',
  `pack_amount` int NULL DEFAULT NULL COMMENT '打包费',
  `tableware_number` int NULL DEFAULT NULL COMMENT '餐具数量',
  `tableware_status` tinyint NOT NULL DEFAULT 1 COMMENT '餐具数量状态  1按餐量提供  0选择具体数量',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_t_orders_userid`(`user_id`) USING BTREE,
  CONSTRAINT `t_orders_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `t_user` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 201 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin COMMENT = '订单表' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of t_orders
-- ----------------------------
INSERT INTO `t_orders` VALUES (100, '100', 3, 1001, 10, '2023-08-28 11:37:31', '2023-08-28 11:37:35', 4, 2, 280.66, '放到门外自动签收', '13812341234', '郑州市高新区郑州大学', '张三', '菜鸟驿站代收', NULL, NULL, NULL, NULL, 1, NULL, 1, 2, 2);

-- ----------------------------
-- Table structure for t_orders_detail
-- ----------------------------
DROP TABLE IF EXISTS `t_orders_detail`;
CREATE TABLE `t_orders_detail`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键',
  `orders_id` bigint NOT NULL COMMENT '订单id',
  `name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '商品名字(冗余字段)',
  `image` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '商品图片(冗余字段)',
  `dish_id` bigint NULL DEFAULT NULL COMMENT '菜品id',
  `setmeal_id` bigint NULL DEFAULT NULL COMMENT '套餐id',
  `dish_flavor` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '口味(冗余字段)',
  `price` decimal(10, 2) NOT NULL COMMENT '单价',
  `quantity` int NOT NULL DEFAULT 1 COMMENT '数量',
  `amount` decimal(10, 2) NOT NULL COMMENT '小计金额',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `orders_id`(`orders_id`) USING BTREE,
  INDEX `t_orders_detail_ibfk_2`(`dish_id`) USING BTREE,
  INDEX `t_orders_detail_ibfk_3`(`setmeal_id`) USING BTREE,
  CONSTRAINT `t_orders_detail_ibfk_1` FOREIGN KEY (`orders_id`) REFERENCES `t_orders` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `t_orders_detail_ibfk_2` FOREIGN KEY (`dish_id`) REFERENCES `t_dish` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `t_orders_detail_ibfk_3` FOREIGN KEY (`setmeal_id`) REFERENCES `t_setmeal` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 201 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin COMMENT = '订单明细表' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of t_orders_detail
-- ----------------------------
INSERT INTO `t_orders_detail` VALUES (150, 100, '草鱼2斤', 'p6.png', 51, NULL, '微辣', 68.20, 2, 136.22);
INSERT INTO `t_orders_detail` VALUES (151, 100, '江团鱼2斤', 'p7.png', 52, NULL, '少糖', 72.22, 2, 144.44);

-- ----------------------------
-- Table structure for t_setmeal
-- ----------------------------
DROP TABLE IF EXISTS `t_setmeal`;
CREATE TABLE `t_setmeal`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键',
  `category_id` bigint NOT NULL COMMENT '菜品分类id',
  `name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '套餐名称',
  `price` decimal(10, 2) NOT NULL COMMENT '套餐价格',
  `status` tinyint NULL DEFAULT 1 COMMENT '售卖状态 0:停售 1:起售',
  `code` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '二维条码',
  `description` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '描述信息',
  `image` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '图片',
  `create_time` datetime NULL DEFAULT NULL COMMENT '创建时间',
  `update_time` datetime NULL DEFAULT NULL COMMENT '更新时间',
  `create_user` bigint NULL DEFAULT NULL COMMENT '创建人',
  `update_user` bigint NULL DEFAULT NULL COMMENT '修改人',
  `is_deleted` tinyint NOT NULL DEFAULT 0 COMMENT '逻辑删除标记 0正常 1删除',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `idx_t_setmeal_name`(`name`) USING BTREE,
  INDEX `category_id`(`category_id`) USING BTREE,
  CONSTRAINT `t_setmeal_ibfk_1` FOREIGN KEY (`category_id`) REFERENCES `t_category` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 200 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin COMMENT = '套餐表' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of t_setmeal
-- ----------------------------
INSERT INTO `t_setmeal` VALUES (31, 101, '实惠午餐', 54.44, 1, '', '经济实惠,一荤二素', 'p27.png', '2023-07-22 11:26:01', '2023-07-22 11:26:01', 1001, 1001, 0);
INSERT INTO `t_setmeal` VALUES (32, 101, '超量午餐', 54.44, 1, '', '量大实惠,二荤二素', 'p28.png', '2023-07-22 11:26:01', '2023-07-22 11:26:01', 1001, 1001, 0);
INSERT INTO `t_setmeal` VALUES (33, 102, '商务午餐', 54.44, 1, '', '商务套餐,二荤二素一汤', 'p29.png', '2023-07-22 11:26:01', '2023-07-22 11:26:01', 1001, 1001, 0);
INSERT INTO `t_setmeal` VALUES (34, 102, '金牌商务午餐', 54.44, 1, '', '商务套餐,三荤二素一汤带水果', 'p30.png', '2023-07-22 11:26:01', '2023-07-22 11:26:01', 1001, 1001, 0);

-- ----------------------------
-- Table structure for t_setmeal_dish
-- ----------------------------
DROP TABLE IF EXISTS `t_setmeal_dish`;
CREATE TABLE `t_setmeal_dish`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键',
  `setmeal_id` bigint NULL DEFAULT NULL COMMENT '套餐id',
  `dish_id` bigint NULL DEFAULT NULL COMMENT '菜品id',
  `name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '菜品名称 （冗余字段）',
  `price` decimal(10, 2) NULL DEFAULT NULL COMMENT '菜品单价（冗余字段）',
  `copies` tinyint NULL DEFAULT 1 COMMENT '菜品份数',
  `sort` int NOT NULL DEFAULT 0 COMMENT '排序',
  `create_time` datetime NOT NULL COMMENT '创建时间',
  `update_time` datetime NOT NULL COMMENT '更新时间',
  `create_user` bigint NOT NULL COMMENT '创建人',
  `update_user` bigint NOT NULL COMMENT '修改人',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `setmeal_id`(`setmeal_id`) USING BTREE,
  INDEX `dish_id`(`dish_id`) USING BTREE,
  CONSTRAINT `t_setmeal_dish_ibfk_1` FOREIGN KEY (`setmeal_id`) REFERENCES `t_setmeal` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `t_setmeal_dish_ibfk_2` FOREIGN KEY (`dish_id`) REFERENCES `t_dish` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 101 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin COMMENT = '套餐菜品关系' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of t_setmeal_dish
-- ----------------------------
INSERT INTO `t_setmeal_dish` VALUES (47, 31, 49, '米饭', 2.01, 1, 10, '2023-07-22 11:24:55', '2023-07-22 11:24:55', 1001, 1001);
INSERT INTO `t_setmeal_dish` VALUES (48, 31, 54, '清炒小油菜', 18.11, 1, 20, '2023-07-22 11:24:55', '2023-07-22 11:24:55', 1001, 1001);
INSERT INTO `t_setmeal_dish` VALUES (49, 31, 55, '蒜蓉娃娃菜', 18.22, 1, 30, '2023-07-22 11:24:55', '2023-07-22 11:24:55', 1001, 1001);
INSERT INTO `t_setmeal_dish` VALUES (50, 32, 50, '馒头', 1.02, 1, 10, '2023-07-22 11:24:55', '2023-07-22 11:24:55', 1001, 1001);
INSERT INTO `t_setmeal_dish` VALUES (51, 32, 54, '清炒小油菜', 18.11, 1, 20, '2023-07-22 11:24:55', '2023-07-22 11:24:55', 1001, 1001);
INSERT INTO `t_setmeal_dish` VALUES (52, 32, 65, '草鱼2斤', 68.33, 1, 30, '2023-07-22 11:24:55', '2023-07-22 11:24:55', 1001, 1001);
INSERT INTO `t_setmeal_dish` VALUES (53, 33, 49, '米饭', 2.01, 1, 10, '2023-07-22 11:26:01', '2023-07-22 11:26:01', 1001, 1001);
INSERT INTO `t_setmeal_dish` VALUES (54, 33, 56, '清炒西兰花', 18.66, 1, 20, '2023-07-22 11:26:01', '2023-07-22 11:26:01', 1001, 1001);
INSERT INTO `t_setmeal_dish` VALUES (55, 33, 54, '清炒小油菜', 18.11, 1, 30, '2023-07-22 11:24:55', '2023-07-22 11:24:55', 1001, 1001);
INSERT INTO `t_setmeal_dish` VALUES (56, 34, 50, '馒头', 1.02, 1, 30, '2023-07-22 11:26:01', '2023-07-22 11:26:01', 1001, 1001);
INSERT INTO `t_setmeal_dish` VALUES (57, 34, 63, '香锅牛蛙', 88.55, 1, 10, '2023-07-22 11:26:01', '2023-07-22 11:26:01', 1001, 1001);
INSERT INTO `t_setmeal_dish` VALUES (58, 34, 65, '草鱼2斤', 68.33, 1, 20, '2023-07-22 11:24:55', '2023-07-22 11:24:55', 1001, 1001);

-- ----------------------------
-- Table structure for t_shopping_cart
-- ----------------------------
DROP TABLE IF EXISTS `t_shopping_cart`;
CREATE TABLE `t_shopping_cart`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键',
  `user_id` bigint NOT NULL COMMENT '客户ID,索引字段',
  `dish_id` bigint NULL DEFAULT NULL COMMENT '对应菜品id',
  `setmeal_id` bigint NULL DEFAULT NULL COMMENT '对应套餐id',
  `name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '商品名称(冗余字段)',
  `image` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '图片(冗余字段)',
  `dish_flavor` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '口味(冗余字段)',
  `price` decimal(10, 2) NOT NULL COMMENT '单价',
  `quantity` int NOT NULL DEFAULT 1 COMMENT '数量',
  `amount` decimal(10, 2) NOT NULL COMMENT '小计金额',
  `create_time` datetime NULL DEFAULT NULL COMMENT '创建时间',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_t_shopping_cart_userid`(`user_id`) USING BTREE,
  INDEX `t_shopping_cart_ibfk_2`(`dish_id`) USING BTREE,
  INDEX `t_shopping_cart_ibfk_3`(`setmeal_id`) USING BTREE,
  CONSTRAINT `t_shopping_cart_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `t_user` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `t_shopping_cart_ibfk_2` FOREIGN KEY (`dish_id`) REFERENCES `t_dish` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `t_shopping_cart_ibfk_3` FOREIGN KEY (`setmeal_id`) REFERENCES `t_setmeal` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 101 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin COMMENT = '购物车' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of t_shopping_cart
-- ----------------------------
INSERT INTO `t_shopping_cart` VALUES (11, 1001, 65, NULL, '草鱼2斤', 'p20.png', '[\"不辣\",\"微辣\",\"中辣\",\"重辣\"]', 68.11, 2, 136.22, '2023-07-22 17:49:59');
INSERT INTO `t_shopping_cart` VALUES (12, 1001, 66, NULL, '鮰鱼2斤', 'p21.png', NULL, 72.22, 3, 216.66, '2023-07-22 17:53:49');
INSERT INTO `t_shopping_cart` VALUES (13, 1001, 49, NULL, '精选五常大米', 'p4.png', NULL, 2.04, 3, 6.12, '2023-07-22 17:53:49');
INSERT INTO `t_shopping_cart` VALUES (14, 1001, NULL, 32, '超量午餐', 'p28.png', NULL, 54.44, 1, 54.44, '2023-07-22 17:53:49');

-- ----------------------------
-- Table structure for t_user
-- ----------------------------
DROP TABLE IF EXISTS `t_user`;
CREATE TABLE `t_user`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键',
  `phone` varchar(11) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '手机号',
  `username` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '用户登录名',
  `password` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '密码，采用短信动态密码',
  `openid` varchar(45) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '微信用户唯一标识',
  `avatar` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '微信等头像网址',
  `nickname` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '昵称',
  `gender` tinyint NOT NULL DEFAULT 2 COMMENT '性别 1男 2女 3未知',
  `id_number` varchar(18) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '身份证号',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态 1:启用,2:未激活、5:禁用',
  `create_time` datetime NULL DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `idx_t_user_phone`(`phone`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1101 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin COMMENT = '客户表' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of t_user
-- ----------------------------
INSERT INTO `t_user` VALUES (1001, '13812341234', 'zhangsan', NULL, NULL, NULL, '痞子三', 1, '1101020201010041', 1, '2023-08-28 22:09:18');
INSERT INTO `t_user` VALUES (1002, '13812000000', 'lisi', NULL, NULL, NULL, '李老三', 2, '1101020201010042', 1, '2023-08-28 22:09:18');
INSERT INTO `t_user` VALUES (1003, '13812111111', '王五', NULL, NULL, NULL, '王老五', 3, '1101020201010042', 1, '2023-08-28 22:09:18');

-- ----------------------------
-- View structure for v_dish
-- ----------------------------
DROP VIEW IF EXISTS `v_dish`;
CREATE ALGORITHM = UNDEFINED SQL SECURITY DEFINER VIEW `v_dish` AS select `t_category`.`name` AS `category_name`,`t_dish`.`id` AS `id`,`t_dish`.`name` AS `name`,`t_dish`.`category_id` AS `category_id`,`t_dish`.`price` AS `price`,`t_dish`.`image` AS `image`,`t_dish`.`description` AS `description`,`t_dish`.`status` AS `status`,`t_dish`.`sort` AS `sort`,`t_dish`.`create_time` AS `create_time`,`t_dish`.`update_time` AS `update_time`,`t_dish`.`create_user` AS `create_user`,`t_dish`.`update_user` AS `update_user`,`t_dish`.`is_deleted` AS `is_deleted` from (`t_dish` left join `t_category` on((`t_dish`.`category_id` = `t_category`.`id`))) where (`t_dish`.`is_deleted` = 0) order by `t_dish`.`category_id`,`t_dish`.`sort`;

-- ----------------------------
-- View structure for v_shop_cart
-- ----------------------------
DROP VIEW IF EXISTS `v_shop_cart`;
CREATE ALGORITHM = UNDEFINED SQL SECURITY DEFINER VIEW `v_shop_cart` AS select `c`.`id` AS `id`,`c`.`user_id` AS `user_id`,`c`.`dish_id` AS `dish_id`,`c`.`setmeal_id` AS `setmeal_id`,`c`.`name` AS `name`,`c`.`image` AS `image`,`c`.`dish_flavor` AS `dish_flavor`,`c`.`price` AS `price`,`c`.`quantity` AS `quantity`,`c`.`amount` AS `amount`,`c`.`create_time` AS `create_time`,`d`.`name` AS `dish_name`,`d`.`price` AS `dish_price`,`s`.`name` AS `setmeal_name`,`s`.`price` AS `setmeal_price` from ((`t_shopping_cart` `c` left join `t_dish` `d` on((`c`.`dish_id` = `d`.`id`))) left join `t_setmeal` `s` on((`c`.`setmeal_id` = `s`.`id`))) order by `c`.`id`;

SET FOREIGN_KEY_CHECKS = 1;
```

# 10. 视图

## 10.1. 复习

```
问 数据库中，视图主要有哪些用途
答  ChatGPT

在数据库中，视图（View）是虚拟表，其内容是基于一个或多个实际表的查询结果。
  视图本身并不存储数据，而是根据定义的查询从一个或多个基本表中获取数据。视图的主要用途包括：

    简化复杂的查询： 视图可以将复杂的查询逻辑封装在一个虚拟表中，使用户只需查询视图
       而不必了解底层的表结构和复杂的查询语句。这提高了查询的简洁性和可维护性。

    提供定制的数据访问： 视图允许用户以一种定制的方式访问数据库中的数据。
       通过在视图中选择特定的列或行，用户可以定制自己的数据访问方式，而不必直接查询原始表。

    增强安全性： 视图可以用于限制用户对数据库的访问权限。通过只向用户提供访问特定列或
      特定行的视图，可以隐藏底层表的实际结构，提高数据安全性。

    简化复杂的数据操作： 在某些情况下，通过视图可以简化对数据的更新、插入和删除操作。
       通过定义合适的视图，可以将多个表的操作简化为单个视图的操作。

    聚合和计算： 视图可以包含聚合函数和计算字段，从而提供汇总数据的功能。
       这使得用户可以直接从视图中获取所需的计算结果，而无需手动进行复杂的计算。

    重用查询逻辑： 视图可以用于封装和重用查询逻辑。如果某个查询在多个地方被频繁使用，
       可以将其定义为一个视图，以提高代码的可维护性和可复用性。

    简化数据模型： 视图可以在逻辑上简化数据模型。通过只向用户显示必要的数据，
      可以隐藏底层表的复杂性，使数据模型更易于理解。

    分离数据层和应用层： 视图可以用于将数据层与应用层分离。应用程序只需关注视图
       而不必了解实际表的结构，这提高了应用程序的灵活性和可维护性。

总体而言，视图在数据库中提供了一种灵活且有用的机制，用于简化数据访问、
   提高数据安全性和封装查询逻辑。
```

## 10.2. 创建菜品列表视图

（1）入口

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700440761856-a823c950-46c0-4967-b542-e7605134a790.png)

（2）拖入依赖的两个表，选择出需要查询的字段

1. 按【标1】~【标4】所示的顺序，先拖入菜品表后拖入分类表；
2. 【标9】所示，两个表中都有字段name，因此需要按照【标10】和【标11】所示，把菜品分类表中的name以别名形式出现

  

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700442440336-974ebbdc-7e5f-40e3-b951-353cb6822074.png)

（2）选择连接关系

1. 按照【标2】和【标2】所示，先拖入的作为左表后拖入的作为右表，主表和附表（也称大表和小表、还称为左表和右表），先删除再调整拖入顺序，观察【标8】处主表和附表的变化；
2. 按照【标4】到【标8】执行一遍，在【标8】处的选择不同的类型值，观察【标9】处代码的变化

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700443269042-f6a1a03b-148a-44c4-a898-1dcf9aaed2f0.png)

（3）添加where条件

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700444214400-651d71c1-ea8c-4619-ad0d-7316bdd76646.png)

（4）添加排序

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700444256764-64291892-665c-4b63-b998-988c6cb4caf6.png)

（5）创建并预览

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700444283925-1304ba21-e674-462a-984c-ed78ec122572.png)

  

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700444655433-2728350a-9174-4b76-8d14-3c954d30f0ff.png)

（6）保存并取名

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700444433438-56b2f7b6-216f-449e-a306-ae2aaf8d7e64.png)

（7）查看视图的数据

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700444724844-db67d01f-249a-463b-bd23-d64a09a7c4b7.png)

（8） 附，创建视图时生成的脚本

```
DROP VIEW IF EXISTS `v_dish`;
CREATE ALGORITHM = UNDEFINED SQL SECURITY 
 	DEFINER VIEW `v_dish` AS 
  select `t_category`.`name` AS `category_name`,`t_dish`.`id` AS `id`,
  		`t_dish`.`name` AS `name`,`t_dish`.`category_id` AS `category_id`,
      `t_dish`.`price` AS `price`,`t_dish`.`image` AS `image`,`t_dish`.
      `description` AS `description`,`t_dish`.`status` AS `status`,
      `t_dish`.`sort` AS `sort`,`t_dish`.`create_time` AS `create_time`,
      `t_dish`.`update_time` AS `update_time`,`t_dish`.`create_user` AS `create_user`,
      `t_dish`.`update_user` AS `update_user`,`t_dish`.`is_deleted` AS `is_deleted`
  from (`t_dish` left join `t_category` 
        on((`t_dish`.`category_id` = `t_category`.`id`))) 
  where (`t_dish`.`is_deleted` = 0) 
  order by `t_dish`.`category_id`,`t_dish`.`sort`;
```

## 10.3. 创建购物车列表视图

（1）添加视图所需要的表

1. 依次添加购物车表、菜品表、套餐表；
2. 购物车选所有字段、菜品表和套餐表分别勾选名称和单价字段；
3. 按照【标12】所示，分别为菜品表和套餐表的名称、单价字段修改别名；
4. 检查【标11】所示的脚本

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700479245930-dc51b5bb-a9a4-42ea-80bf-a7ee16759afc.png)

（2）外键呢？这三个表之间没有外键关系，因此没法自动添加关联关系，需要手工添加

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700480117747-be9c1181-487f-4f6c-a65c-4c7b325ccdaa.png)

（3）添加关联条件

1. 点击在表名后面的提示，根据提示修改表的别名，修改后见【标1】所示；
2. 点击两个表之间的逗号，按照提示添加左连接；
3. 添加完成后，观察【标3】和【标4】的变化

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700480979472-dc4affe6-6e1f-49f6-819f-08ab780d42ea.png)

（4）添加排序规则

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700482193058-3e82a53b-4d1d-4542-a825-87a317db75d0.png)

（5）创建

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700482242322-fb24d717-6cae-4fee-8259-0c04914cbf59.png)

（6）预览

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700482310928-548d157d-b5e7-4d7e-91ef-015cc28591cf.png)

（7）保存

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700482377750-2f83ea0c-027a-4d8c-969f-ce95911c3993.png)

（8）测试

1. 【标3】和【标4】，因为屏幕窄显示不下，分成两屏截的图；
2. 【标7】的名称和【标8】【标9】的名称不一致，因为造测试数据时，人为修改的不一样。

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1700482740575-e27d0ef5-62eb-480c-a5fc-7b7384ad5ef9.png)

（9）附

```
-- ----------------------------
-- View structure for v_shop_cart
-- ----------------------------
DROP VIEW IF EXISTS `v_shop_cart`;
CREATE ALGORITHM = UNDEFINED SQL SECURITY DEFINER VIEW `v_shop_cart` AS 
	select `c`.`id` AS `id`,`c`.`user_id` AS `user_id`,`c`.`dish_id` AS `dish_id`,`c`.
  `setmeal_id` AS `setmeal_id`,`c`.`name` AS `name`,`c`.`image` AS `image`,`c`.
  `dish_flavor` AS `dish_flavor`,`c`.`price` AS `price`,`c`.`quantity` AS `quantity`,
  `c`.`amount` AS `amount`,`c`.`create_time` AS `create_time`,`d`.`name` AS `dish_name`,
  `d`.`price` AS `dish_price`,`s`.`name` AS `setmeal_name`,`s`.`price` AS `setmeal_price` 
  from ((`t_shopping_cart` `c` 
        left join `t_dish` `d` on((`c`.`dish_id` = `d`.`id`))) 
        left join `t_setmeal` `s` on((`c`.`setmeal_id` = `s`.`id`))) 
order by `c`.`id`;
```

## 10.4. 利用大模型，把含有冗余字段的表，添加对应的视图

# 11. 附，BTREE和B+TREE

1. CSDN网友分享：

[https://blog.csdn.net/weixin_44203782/article/details/131202433](https://blog.csdn.net/weixin_44203782/article/details/131202433)

2. 知乎分享

[https://www.zhihu.com/question/591053709/answer/3039461507?utm_id=0](https://www.zhihu.com/question/591053709/answer/3039461507?utm_id=0)