# 1. 创建两个测试表

1. 在数据库SheQuGouV6B中，添加两个测试表t_shopping_cart01、t_shopping_cart02；
2. 拟通过后续的环节，向每个表分别插入一万条测试数据；

## 1.1. 测试表t_shopping_cart01

```
-- 切换到新创建的数据库
USE SheQuGouV6B;

DROP TABLE IF EXISTS `t_shopping_cart01`;
CREATE TABLE `t_shopping_cart01` (
  `id` bigint NOT NULL  COMMENT '主键',
  `user_id` bigint NOT NULL COMMENT '客户ID,索引字段',
  `dish_id` bigint DEFAULT NULL COMMENT '对应菜品id',
  `setmeal_id` bigint DEFAULT NULL COMMENT '对应套餐id',
  `name` varchar(32) COLLATE utf8mb4_bin DEFAULT NULL COMMENT '商品名称(冗余字段)',
  `image` varchar(255) COLLATE utf8mb4_bin DEFAULT NULL COMMENT '图片(冗余字段)',  
  `dish_flavor` varchar(50) COLLATE utf8mb4_bin DEFAULT NULL COMMENT '口味(冗余字段)',
  `price` decimal(10,2) NOT NULL COMMENT '单价',  
  `quantity` int NOT NULL DEFAULT 1 COMMENT '数量',
  `amount` decimal(10,2) NOT NULL COMMENT '小计金额',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间'   
  -- 没有任何 主键  索引、外键
   -- 没有任何主键，索引、外键
  -- INDEX idx_t_shopping_cart_userid (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin COMMENT='购物车01';
```

## 1.2. 测试表t_shopping_cart02

```
-- 切换到新创建的数据库
USE SheQuGouV6B;

DROP TABLE IF EXISTS `t_shopping_cart02`;
CREATE TABLE `t_shopping_cart02` (
  `id` bigint NOT NULL  COMMENT '主键',
  `user_id` bigint NOT NULL COMMENT '客户ID,索引字段',
  `dish_id` bigint DEFAULT NULL COMMENT '对应菜品id',
  `setmeal_id` bigint DEFAULT NULL COMMENT '对应套餐id',
  `name` varchar(32) COLLATE utf8mb4_bin DEFAULT NULL COMMENT '商品名称(冗余字段)',
  `image` varchar(255) COLLATE utf8mb4_bin DEFAULT NULL COMMENT '图片(冗余字段)',  
  `dish_flavor` varchar(50) COLLATE utf8mb4_bin DEFAULT NULL COMMENT '口味(冗余字段)',
  `price` decimal(10,2) NOT NULL COMMENT '单价',  
  `quantity` int NOT NULL DEFAULT 1 COMMENT '数量',
  `amount` decimal(10,2) NOT NULL COMMENT '小计金额',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间'   
  -- 没有任何 主键  索引、外键
   -- 没有任何主键，索引、外键
  -- INDEX idx_t_shopping_cart_userid (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin COMMENT='购物车02';
```

## 1.3. 创建巩固练习表

### 1.3.1. 学生表

```
-- 学生表
DROP TABLE IF EXISTS `Student`;
CREATE TABLE `Student`(
  `s_id` VARCHAR(20),
  `s_name` VARCHAR(20) NOT NULL DEFAULT '',
  `s_birth` VARCHAR(20) NOT NULL DEFAULT '',
  `s_sex` VARCHAR(10) NOT NULL DEFAULT '',
  PRIMARY KEY(`s_id`)
); 

-- 插入学生表测试数据
insert into Student values('01' , '赵雷' , '1990-01-01' , '男');
insert into Student values('02' , '钱电' , '1990-12-21' , '男');
insert into Student values('03' , '孙风' , '1990-05-20' , '男');
insert into Student values('04' , '李云' , '1990-08-06' , '男');
insert into Student values('05' , '周梅' , '1991-12-01' , '女');
insert into Student values('06' , '吴兰' , '1992-03-01' , '女');
insert into Student values('07' , '郑竹' , '1989-07-01' , '女');
insert into Student values('08' , '王菊' , '1990-01-20' , '女');
```

### 1.3.2. 课程表

```
-- 课程表
DROP TABLE IF EXISTS `Course`;
CREATE TABLE `Course`(
  `c_id`  VARCHAR(20),
  `c_name` VARCHAR(20) NOT NULL DEFAULT '',
  `t_id` VARCHAR(20) NOT NULL,
  PRIMARY KEY(`c_id`)
);
-- 课程表测试数据
insert into Course values('01' , '语文' , '02');
insert into Course values('02' , '数学' , '01');
insert into Course values('03' , '英语' , '03');
```

### 1.3.3. 教师表

```
-- 教师表
DROP TABLE IF EXISTS `Teacher`;
CREATE TABLE `Teacher`(
  `t_id` VARCHAR(20),
  `t_name` VARCHAR(20) NOT NULL DEFAULT '',
  PRIMARY KEY(`t_id`)
);

-- 教师表测试数据
insert into Teacher values('01' , '张三');
insert into Teacher values('02' , '李四');
insert into Teacher values('03' , '王五');
```

### 1.3.4. 成绩表

```
-- 成绩表
DROP TABLE IF EXISTS `Score`;
CREATE TABLE `Score`(
  `s_id` VARCHAR(20),
  `c_id`  VARCHAR(20),
  `s_score` INT(3),
  PRIMARY KEY(`s_id`,`c_id`)
);

-- 成绩表测试数据
insert into Score values('01' , '01' , 80);
insert into Score values('01' , '02' , 90);
insert into Score values('01' , '03' , 99);
insert into Score values('02' , '01' , 70);
insert into Score values('02' , '02' , 60);
insert into Score values('02' , '03' , 80);
insert into Score values('03' , '01' , 80);
insert into Score values('03' , '02' , 80);
insert into Score values('03' , '03' , 80);
insert into Score values('04' , '01' , 50);
insert into Score values('04' , '02' , 30);
insert into Score values('04' , '03' , 20);
insert into Score values('05' , '01' , 76);
insert into Score values('05' , '02' , 87);
insert into Score values('06' , '01' , 31);
insert into Score values('06' , '03' , 34);
insert into Score values('07' , '02' , 89);
insert into Score values('07' , '03' , 98);
```

  

# 2. 创建测试表的关联视图

## 2.1. 创建视图1

（1）步骤1

1. 【标2】，选中（选中左侧的图标部分），复制，粘贴；
2. 【标3】，改名；
3. 【标3】，鼠标右键，在弹窗中选择【设计视图】，进入设计窗口，选择【视图创建工具】，进入工具设计窗口，
4. 在工具设计窗口中，选择【标4】，点击【标5】，在下拉弹窗中选择【标8】所示的表名【t_shop_car01】

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1702018382849-7531dc2e-a159-4ae7-b597-82fcdd4d38b8.png)

（2）步骤2

1. 出现红色告警

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1702018646354-d4288813-5f19-4a58-801f-05b6aeb644b2.png)

（3）步骤3

1. 切换到【select】标签页，能看到红色告警项，任意点击一列【标3】，弹出【标4】所示的弹窗，再次点击任何一列如【标5】，则红色警告消失，恢复正常色【标6】、【标7】
2. 点击【构建】

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1702019200760-999cdfba-04f3-4193-afdb-9c5b32f79691.png)

（4）步骤4，保存

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1702019555069-ec4dbd7e-40b7-4549-ab01-c9a6c1ac7f2f.png)

## 2.2. 创建视图2

同样方式创建视图2

## 2.3. 测试

等生成测试数据后，查看新生成视图中的测试数据

# 3. 通过存储过程创建测试数据

## 3.1. 创建一个测试存储过程

```
CREATE DEFINER = CURRENT_USER PROCEDURE `p_testAddToShopCart`()
BEGIN
	#Routine body goes here...

END;
```

## 3.2. 添加一个循环语句

（1）

```
CREATE DEFINER=`root`@`localhost` PROCEDURE `p_testAddToShopCart`()
BEGIN
    -- 从1到2的循环，后续修改为从1到10000的循环 
    DECLARE i INT DEFAULT 1;	
    
    -- 先清除测试表的数据，再在循环内生成测试数据
		TRUNCATE TABLE t_shopping_cart01;
		TRUNCATE TABLE t_shopping_cart02;
    WHILE i<=2 DO
			BEGIN
         SELECT i;
				 --  这一句别忘了，否则死循环
				 set i=i+1;
      END;
		END WHILE;
END
```

（2）

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1701353418409-7643c5a6-60a7-42a3-a97b-a09d9ab17afb.png)

## 3.3. 在循环内为测试表1添加测试数据

（1）代码

```
CREATE DEFINER=`root`@`localhost` PROCEDURE `p_testAddToShopCart`()
BEGIN    
		DECLARE i INT DEFAULT 1;
	
		-- 先清除测试表的数据，再在循环内生成测试数据
		TRUNCATE TABLE t_shopping_cart01;
		TRUNCATE TABLE t_shopping_cart02;   
		 
		-- 测试表1，循环2次，共生成(24+4)*2=56条 
    WHILE i<=2 DO
			BEGIN
				INSERT INTO t_shopping_cart01 
					select i*1000+d.id%1000, 1001+d.id%2,d.id,null,d.name,
						d.image,'单品口味:等待合成处理',
						d.price,d.id%3+1,d.price*(d.id%3+1),NOW() 
					FROM t_dish d	where d.is_deleted=0;					
				INSERT INTO t_shopping_cart01 
					select i*1000+100+c.id%1000, 1001+c.id%2,null,c.id,c.name,
						c.image,'套餐口味:无',
						c.price,c.id%3+1,c.price*(c.id%3+1),NOW() 
						FROM t_setmeal c	where c.is_deleted=0;		
				
        --  这一句别忘了，否则死循环
				set i=i+1;				
      END;
		END WHILE; 			
END
```

（2）运行效果1

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1701694515373-56a6839b-dfe1-4dcd-9ee9-cc7919cb0d34.png)

（3）运行效果2

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1701694649972-13c237bd-d890-4c98-9198-2d918d23dd64.png)

## 3.4. 正式为测试表添加测试数据

1. 在第4-5行、34-35行添加事物管理，不过目前又被注释掉了，因为存储过程默认有自己的事物管理
2. 第12行的循环，修改成1万次；
3. 第30行~32行，从测试表1复制数据到测试表2

（1）代码

```
CREATE DEFINER=`root`@`localhost` PROCEDURE `p_testAddToShopCart`()
BEGIN    
		DECLARE i INT DEFAULT 1;
		-- 开始事务
    -- START TRANSACTION;
		
		-- 先清除测试表的数据，再在循环内生成测试数据
		TRUNCATE TABLE t_shopping_cart01;
		TRUNCATE TABLE t_shopping_cart02;   
		 
		-- 测试表1，循环1万次，共生成(24+4)*10000=28万条 
    WHILE i<=10000 DO
			BEGIN
				INSERT INTO t_shopping_cart01 
					select i*1000+d.id%1000, 1001+d.id%2,d.id,null,d.name,
						d.image,'单品口味:等待合成处理',
						d.price,d.id%3+1,d.price*(d.id%3+1),NOW() 
					FROM t_dish d	where d.is_deleted=0;-- 逻辑删除					
				INSERT INTO t_shopping_cart01 
					select i*1000+100+c.id%1000, 1001+c.id%2,null,c.id,c.name,
						c.image,'套餐口味:无',
						c.price,c.id%3+1,c.price*(c.id%3+1),NOW() 
						FROM t_setmeal c	where c.is_deleted=0;		
		
        --  这一句别忘了，否则死循环
				set i=i+1;				
      END;
		END WHILE; 
		
		-- 从测试表1 拷贝数据到测试表2
		INSERT INTO t_shopping_cart02 
			select * from t_shopping_cart01; 				
			
		-- 提交事物 
		--  COMMIT;
		
END
```

（2）运行效果

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1701695488302-9e8024c7-8667-45f8-a61b-b5a460701daa.png)

# 4. 为测试表2添加主键、索引、外键

## 4.1. 执行添加约束的脚本

（1）脚本文件

```
-- 添加主键
ALTER TABLE `shequgouv6b`.`t_shopping_cart02` 
MODIFY COLUMN `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键' FIRST,
ADD PRIMARY KEY (`id`),
AUTO_INCREMENT = 300000;

-- 添加索引和外键
ALTER TABLE `t_shopping_cart02`
ADD INDEX `idx_t_shopping02_cart_userid`(`user_id`),
ADD INDEX `idx_t_shopping02_cart_3`(`dish_id`,`setmeal_id`),
ADD CONSTRAINT `t_shopping02_cart_ibfk_1` FOREIGN KEY (`user_id`) 
	REFERENCES `t_user` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
ADD CONSTRAINT `t_shopping02_cart_ibfk_2` FOREIGN KEY (`dish_id`) 
	REFERENCES `t_dish` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
ADD CONSTRAINT `t_shopping02_cart_ibfk_3` FOREIGN KEY (`setmeal_id`) 
	REFERENCES `t_setmeal` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT;
```

（2）运行效果

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1701695629289-980dcbaf-1391-4136-ba9d-73058a7e1a64.png)

## 4.2. 附，带完整约束的测试表2

```
DROP TABLE IF EXISTS `t_shopping_cart02`;
CREATE TABLE `t_shopping_cart02`  (
  `id` bigint(0) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `user_id` bigint(0) NOT NULL COMMENT '客户ID,索引字段',
  `dish_id` bigint(0) NULL DEFAULT NULL COMMENT '对应菜品id',
  `setmeal_id` bigint(0) NULL DEFAULT NULL COMMENT '对应套餐id',
  `name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '商品名称(冗余字段)',
  `image` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '图片(冗余字段)',
  `dish_flavor` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '口味(冗余字段)',
  `price` decimal(10, 2) NOT NULL COMMENT '单价',
  `quantity` int(0) NOT NULL DEFAULT 1 COMMENT '数量',
  `amount` decimal(10, 2) NOT NULL COMMENT '小计金额',
  `create_time` datetime(0) NULL DEFAULT NULL COMMENT '创建时间',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_t_shopping01_cart_userid`(`user_id`) USING BTREE,
  INDEX `idx_t_shopping01_cart_3`(`dish_id`,`setmeal_id`),
  CONSTRAINT `t_shopping01_cart_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `t_user` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `t_shopping01_cart_ibfk_2` FOREIGN KEY (`dish_id`) REFERENCES `t_dish` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `t_shopping01_cart_ibfk_3` FOREIGN KEY (`setmeal_id`) REFERENCES `t_setmeal` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT

) ENGINE = InnoDB AUTO_INCREMENT = 101 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin COMMENT = '购物车' ROW_FORMAT = Dynamic;
```

# 5. 通过视图看测试数据

## 5.1. 视图1

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1701436800728-4d588386-6a77-4ad3-a988-fe8ea857aa8d.png)

## 5.2. 视图2

![](https://cdn.nlark.com/yuque/0/2023/png/1727964/1701436961393-fb8c96d5-53d5-4727-8166-5deed58cf6ea.png)