### “四周精通 Spring Boot 邮件发送”学习规划

**核心理念：** 以实践驱动理论，每周完成一个可量化的目标，四周后你将不仅仅是“会用”，而是“精通”。

---

#### **第一周：基础入门 - “我能发邮件了！”**

**学习目标：** 成功发送你的第一封纯文本和 HTML 邮件。理解最核心的配置和类。

**学习内容：**

1.  **环境准备：**
    *   了解什么是 SMTP (Simple Mail Transfer Protocol)，只需知道它是邮件发送的协议即可。
    *   准备一个邮箱账号（推荐 QQ 邮箱或 163 邮箱），并**开启 SMTP 服务**，获取**授权码**。这是新手最容易卡住的地方，务必搞定！

2.  **Spring Boot 集成：**
    *   学习如何在 Maven/Gradle 中引入 `spring-boot-starter-mail`。
    *   掌握在 `application.yml` (或 `.properties`) 中配置邮件服务器的核心参数：`host`, `port`, `username`, `password`, `properties.mail.smtp.auth`, `properties.mail.smtp.starttls.enable`。理解每一项的含义。

3.  **核心 API 学习：**
    *   `JavaMailSender` 接口：了解这是 Spring 提供的发送邮件的核心入口。
    *   `SimpleMailMessage` 类：学习用它来构建和发送一封简单的纯文本邮件。
    *   `MimeMessage` 和 `MimeMessageHelper`：初步接触，知道它们是用来发送复杂邮件（如 HTML）的。

**实践任务：**

*   创建一个全新的 Spring Boot 项目。
*   编写一个 `MailService`，包含一个 `sendSimpleMail` 方法。
*   创建一个简单的 Controller，提供一个 API 接口（如 `/send-test-mail`），调用该 Service 发送一封写死的纯文本邮件给你自己的邮箱。
*   **挑战任务：** 改造 `MailService`，增加一个 `sendHtmlMail` 方法，发送一封包含简单 HTML（例如，一个加粗的 "Hello" 和一个换行）的邮件。

**第一周检验标准：**

*   你能独立配置并成功发送纯文本邮件和 HTML 邮件。
*   你能向别人解释 `application.yml` 中邮件配置各项的意义。
*   你知道发送纯文本和 HTML 邮件在代码层面上的主要区别（`SimpleMailMessage` vs `MimeMessageHelper`）。

---

#### **第二周：内容进阶 - “我的邮件变好看了！”**

**学习目标：** 掌握发送复杂、动态内容的邮件，让邮件内容与业务代码解耦。

**学习内容：**

1.  **精通 `MimeMessageHelper`：**
    *   发送带**附件**（`addAttachment`）。
    *   发送带**内联资源**（`addInline`），如在邮件正文中嵌入图片。理解 `cid:` 的用法。
    *   设置抄送（`setCc`）和密送（`setBcc`）。

2.  **集成模板引擎（首推 Thymeleaf）：**
    *   学习为何要用模板引擎（代码与视图分离，易于维护）。
    *   在项目中引入 `spring-boot-starter-thymeleaf`。
    *   学习 Thymeleaf 的基本语法，如何在模板中展示变量（`th:text`）。
    *   学习在 Java 代码中如何使用 `TemplateEngine` 和 `Context` 来渲染模板，生成最终的 HTML 字符串。

**实践任务：**

*   **模拟用户注册场景：**
    1.  创建一个 `mail-templates/register.html` 的 Thymeleaf 模板。模板中应包含动态的用户名和随机生成的 6 位验证码。
    2.  模板中嵌入一个公司 Logo（使用内联资源 `cid:` 的方式）。
    3.  在 `MailService` 中创建一个 `sendRegistrationMail` 方法，它接收 `收件人邮箱`、`用户名`、`验证码` 作为参数。
    4.  该方法会渲染 `register.html` 模板，并将最终的 HTML 作为邮件内容发送出去。
    5.  **挑战任务：** 在发送这封邮件时，附上一个名为 `用户协议.pdf` 的附件。

**第二周检验标准：**

*   你能熟练地发送带附件和内联图片的邮件。
*   你能使用 Thymeleaf 模板动态生成邮件内容。
*   你能解释清楚“附件”和“内联资源”的区别及其在代码中的实现。

---

#### **第三周：企业级增强 - “我的应用变快了，也更可靠了！”**

**学习目标：** 掌握邮件发送的性能优化和测试方法，使功能达到生产级别标准。

**学习内容：**

1.  **异步发送 (`@Async`)：**
    *   理解为什么邮件发送需要异步（网络 IO 耗时，不能阻塞主线程）。
    *   学习如何在 Spring Boot 中开启异步支持（`@EnableAsync`）。
    *   学习如何将邮件发送方法标记为异步（`@Async`）。

2.  **单元测试 (GreenMail)：**
    *   理解为什么不能在单元测试中直接发邮件（速度慢、依赖外部网络、产生垃圾邮件）。
    *   学习引入 `GreenMail` 测试库。
    *   学习如何使用 JUnit 5 配合 GreenMail 启动一个内存中的邮件服务器。
    *   在测试代码中，发送邮件后，从 GreenMail 中获取“收到”的邮件，并断言其收件人、主题、内容是否正确。

**实践任务：**

*   将第二周的 `sendRegistrationMail` 方法改造为异步方法。
*   为你的 `MailService` 编写一个单元测试类 `MailServiceTest`。
*   使用 GreenMail 测试你的 `sendRegistrationMail` 方法。测试需要验证：
    *   是否收到了邮件。
    *   收件人地址是否正确。
    *   邮件主题是否符合预期。
    *   邮件内容（HTML）中是否包含了传入的用户名和验证码。

**第三周检验标准：**

*   你能在项目中自如地应用 `@Async` 来提升响应速度。
*   你能独立编写针对邮件发送逻辑的单元测试，而无需连接真实的 SMTP 服务器。
*   你能向团队成员解释清楚异步发送和单元测试的重要性。

---

#### **第四周：大师之路 - “我懂原理，更知安全！”**

**学习目标：** 深入理解邮件发送的底层机制、安全性以及更高级的应用场景。

**学习内容：**

1.  **安全最佳实践：**
    *   **凭证管理：** 学习为什么不能将密码/授权码硬编码或明文存在配置文件中。了解使用**环境变量**或**配置中心**（如 Nacos, Apollo）来管理敏感信息。
    *   **连接安全：** 深入理解 `STARTTLS` 和 `SSL/TLS` 的区别。

2.  **高级主题：**
    *   **重试机制：** 如果邮件服务器临时不可用，发送失败了怎么办？了解 Spring Retry (`@Retryable`)，为邮件发送增加简单的重试能力。
    *   **邮件队列：** 在大流量场景下（如营销邮件群发），仅用 `@Async` 可能不足以应对。了解使用消息队列（如 RabbitMQ, Kafka）来削峰填谷，将邮件发送任务放入队列，由独立的消费者来处理。
    *   **OAuth 2.0 认证：** 了解对于 Google Workspace / Microsoft 365 等现代邮件服务，使用 OAuth 2.0 认证是比密码更安全、更推荐的方式。

3.  **知识溯源：**
    *   了解 `JavaMail` 和 `Jakarta Mail` 的历史渊源和包名变化 (`javax.mail` -> `jakarta.mail`)。

**实践任务：**

*   将 `application.yml` 中的邮箱密码改为从环境变量读取（例如 `${MAIL_PASSWORD}`）。
*   **研究课题：** 查阅资料，用自己的话总结一下，在什么场景下应该使用消息队列来发送邮件，而不是简单的 `@Async`。
*   **挑战任务：** 引入 `spring-boot-starter-aop` 和 `spring-retry`，给你其中一个发送邮件的方法加上 `@Retryable` 注解，实现失败后自动重试 3 次。

**第四周检验标准：**

*   你养成了不在代码/配置中暴露敏感信息的习惯。
*   你能清晰地阐述 `@Async`、`@Retryable` 和 `消息队列` 在邮件发送场景下的不同应用和优劣。
*   你对 Java 邮件技术的生态演进有了清晰的认识。

---

**心态与建议：**

*   **多动手：** 每一周的实践任务是核心，务必亲手完成。
*   **多思考：** 遇到问题先自己思考，尝试解决，这个过程远比直接看答案收获更多。
*   **读官方：** 当有疑问时，Spring Boot 的官方文档永远是最好的老师。
*   **总结分享：** 尝试把每周学到的东西用博客或笔记的形式记录下来，这是巩固知识的最好方式。