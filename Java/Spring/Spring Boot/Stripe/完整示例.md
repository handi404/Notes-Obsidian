以下是一个基于 **Spring Boot** 的 Stripe 集成完整示例项目结构，包括典型的分层架构（Controller、Service、配置类等），用于实现创建收费（Charge）、退款（Refund）和管理订阅等功能。

---

## 🗂 项目结构概览

```
src/
├── main/
│   └── java/
│       └── com/example/stripe/
│           ├── config/
│           │   └── StripeConfig.java
│           ├── controller/
│           │   └── PaymentController.java
│           ├── dto/
│           │   ├── ChargeRequest.java
│           │   ├── RefundRequest.java
│           │   └── SubscriptionRequest.java
│           ├── service/
│           │   └── StripeService.java
│           └── StripeApplication.java
│
└── resources/
    └── application.properties
```

---

## 🧾 1. application.properties

```properties
stripe.secret-key=sk_test_your_secret_key_here
server.port=8080
```

---

## ⚙️ 2. StripeConfig.java

```java
package com.example.stripe.config;

import com.stripe.Stripe;
import jakarta.annotation.PostConstruct;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

@Component
public class StripeConfig {

    @Value("${stripe.secret-key}")
    private String secretKey;

    @PostConstruct
    public void init() {
        Stripe.apiKey = secretKey;
    }
}
```

---

## 📦 3. DTO 类（用于接收请求参数）

### ChargeRequest.java

```java
package com.example.stripe.dto;

import lombok.Data;

@Data
public class ChargeRequest {
    private Long amount;
    private String currency;
    private String source; // 前端传来的 token，如 "tok_visa"
    private String description;
}
```

### RefundRequest.java

```java
package com.example.stripe.dto;

import lombok.Data;

@Data
public class RefundRequest {
    private String chargeId;
    private Long amount; // 可选，null 表示全额退款
}
```

### SubscriptionRequest.java

```java
package com.example.stripe.dto;

import lombok.Data;

@Data
public class SubscriptionRequest {
    private String customerId;
    private String priceId;
}
```

---

## 🧠 4. StripeService.java

```java
package com.example.stripe.service;

import com.example.stripe.dto.ChargeRequest;
import com.example.stripe.dto.RefundRequest;
import com.example.stripe.dto.SubscriptionRequest;
import com.stripe.exception.StripeException;
import com.stripe.model.*;
import com.stripe.param.*;

import org.springframework.stereotype.Service;

@Service
public class StripeService {

    public Charge createCharge(ChargeRequest request) throws StripeException {
        ChargeCreateParams params = ChargeCreateParams.builder()
            .setAmount(request.getAmount())
            .setCurrency(request.getCurrency())
            .setSource(request.getSource())
            .setDescription(request.getDescription())
            .build();

        return Charge.create(params);
    }

    public Refund createRefund(RefundRequest request) throws StripeException {
        RefundCreateParams.Builder builder = RefundCreateParams.builder()
            .setCharge(request.getChargeId());

        if (request.getAmount() != null) {
            builder.setAmount(request.getAmount());
        }

        return Refund.create(builder.build());
    }

    public Subscription createSubscription(SubscriptionRequest request) throws StripeException {
        SubscriptionCreateParams params = SubscriptionCreateParams.builder()
            .setCustomer(request.getCustomerId())
            .addItem(SubscriptionCreateParams.Item.builder()
                .setPrice(request.getPriceId())
                .build())
            .build();

        return Subscription.create(params);
    }

    public Subscription cancelSubscription(String subscriptionId) throws StripeException {
        Subscription subscription = Subscription.retrieve(subscriptionId);
        return subscription.cancel();
    }

    public PaymentMethod getPaymentMethodDetails(String paymentMethodId) throws StripeException {
        return PaymentMethod.retrieve(paymentMethodId);
    }
}
```

---

## 🌐 5. PaymentController.java

```java
package com.example.stripe.controller;

import com.example.stripe.dto.ChargeRequest;
import com.example.stripe.dto.RefundRequest;
import com.example.stripe.dto.SubscriptionRequest;
import com.example.stripe.service.StripeService;
import com.stripe.exception.StripeException;
import com.stripe.model.*;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/stripe")
public class PaymentController {

    @Autowired
    private StripeService stripeService;

    @PostMapping("/charge")
    public Charge charge(@RequestBody ChargeRequest request) throws StripeException {
        return stripeService.createCharge(request);
    }

    @PostMapping("/refund")
    public Refund refund(@RequestBody RefundRequest request) throws StripeException {
        return stripeService.createRefund(request);
    }

    @PostMapping("/subscribe")
    public Subscription subscribe(@RequestBody SubscriptionRequest request) throws StripeException {
        return stripeService.createSubscription(request);
    }

    @PostMapping("/cancel-subscription/{id}")
    public Subscription cancel(@PathVariable("id") String id) throws StripeException {
        return stripeService.cancelSubscription(id);
    }

    @GetMapping("/payment-method/{id}")
    public PaymentMethod getPaymentMethod(@PathVariable("id") String id) throws StripeException {
        return stripeService.getPaymentMethodDetails(id);
    }
}
```

---

## 🚀 6. 启动类 StripeApplication.java

```java
package com.example.stripe;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class StripeApplication {
    public static void main(String[] args) {
        SpringApplication.run(StripeApplication.class, args);
    }
}
```

---

## ✅ 测试示例（使用 Postman）

1. 创建收费：
    

```http
POST http://localhost:8080/api/stripe/charge
Content-Type: application/json

{
  "amount": 1000,
  "currency": "usd",
  "source": "tok_visa",
  "description": "测试商品"
}
```

2. 退款：
    

```http
POST http://localhost:8080/api/stripe/refund
Content-Type: application/json

{
  "chargeId": "ch_1234567890abcdef",
  "amount": 500
}
```

3. 创建订阅：
    

```http
POST http://localhost:8080/api/stripe/subscribe
Content-Type: application/json

{
  "customerId": "cus_ABC123",
  "priceId": "price_1NqABCxyz"
}
```

---

## 🔐 安全建议

- 所有接口建议添加认证（如 JWT）。
    
- 不要将 Secret Key 写死在代码中或公开版本控制中。
    
- 对敏感数据（如 token、chargeId）做校验。
    

---
