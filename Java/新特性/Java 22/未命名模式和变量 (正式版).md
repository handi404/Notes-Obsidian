Java 22 中正式发布的、用于提升代码清晰度和减少冗余的精巧特性——**未命名模式和变量 (Unnamed Patterns and Variables)**。

---

### 未命名模式和变量

#### 1. 核心概念 (Core Concept)

这个特性允许你在某些必须声明变量或模式，但又**完全不需要使用它们**的场景下，使用**下划线 `_`** 作为一个特殊的占位符来替代变量名。

**核心目的：**
1.  **明确代码意图：** `_` 明确地告诉阅读代码的人（以及编译器）：“这个变量在这里是必需的，但它的值是被**有意忽略**的。”
2.  **减少认知负担：** 避免为了应付语法而起一些无意义的变量名，如 `ignored`、`unused`、`dummy`。
3.  **消除编译器警告：** 避免因声明了未使用变量而产生的编译器警告。
4.  **未来扩展：** 为未来更复杂的模式匹配特性铺路。

**通俗比喻：**
想象你在填写一张表格，其中有些栏目是**必填项**，但对你来说**毫无意义**。
*   **Java 22 之前：** 你不得不在这些栏目里随便写点东西，比如“无”、“N/A”或者“随便填的”。这既浪费时间，又可能让看表格的人感到困惑。
*   **Java 22 之后：** 表格提供了一个“**忽略此项**”的打勾选项 `_`。你直接勾选它，就清晰地表明了“我知道这里要填，但我不需要它”。

#### 2. 演进与现代化 (Evolution & Modernization)

*   **Java 22 之前 (The Pain Point):**
    在很多常见场景中，我们被迫声明一些永远不会被使用的变量。
    *   **`try-catch` 块：**
        ```java
        try {
            // ... some code that might throw an exception
        } catch (NumberFormatException ex) { // `ex` 只是为了捕获类型，从未使用
            System.err.println("Invalid number format.");
        }
        ```
    *   **`for` 循环：**
        ```java

        int count = 0;
        for (Order order : orders) { // `order` 变量从未使用
            count++;
        }
        ```
    *   **Lambda 表达式：**
        ```java
        map.forEach((key, value) -> { // `value` 从未使用
            System.out.println("Processing key: " + key);
        });
        ```
    *   **模式匹配：**
        ```java
        switch (shape) {
            case Circle(Point center, int radius) -> ... // `center` 从未使用
            ...
        }
        ```
    这些“幽灵变量”虽然功能上无害，但它们是代码中的噪音，降低了可读性。

*   **预览阶段 (Java 21):**
    这个特性在 Java 21 中作为预览特性引入，受到了社区的普遍欢迎，因为它解决了多个长期存在的小痛点。

*   **Java 22 (The Solution - 正式版):**
    未命名模式和变量正式成为 Java 语言的一部分，为上述所有场景提供了统一、优雅的解决方案。

#### 3. 应用场景与代码示例

##### **1. 未命名变量 (Unnamed Variables)**

*   **`catch` 子句：**
    ```java
    // 新写法
    try {
        int number = Integer.parseInt(someString);
    } catch (NumberFormatException _) { // 明确忽略异常对象
        System.err.println("Invalid number format. Please enter a valid integer.");
    }
    ```

*   **`try-with-resources` 语句：**
    ```java
    // 新写法
    try (var _ = new ScopedContext()) { // 资源变量本身不重要，重要的是它的生命周期
        // ... a block of code that uses the context
    }
    ```

*   **增强型 `for` 循环：**
    ```java
    // 新写法
    int count = 0;
    for (var _ : orders) { // 明确忽略循环中的每个元素
        count++;
    }
    ```

*   **Lambda 表达式：**
    ```java
    // 新写法
    map.forEach((key, _) -> { // 明确忽略 value
        System.out.println("Processing key: " + key);
    });
    ```
    特别注意：在 Lambda 中，如果只有一个参数且是未命名变量，括号不能省略。 `_ -> ...` 是非法的，必须写成 `(_) -> ...`。

##### **2. 未命名模式 (Unnamed Patterns)**

*   **`instanceof` 模式匹配：**
    ```java
    // 新写法
    if (obj instanceof Point(_, _)) { // 只关心类型是 Point，不关心其组件
        System.out.println("The object is a Point.");
    }
    ```

*   **`switch` 模式匹配：**
    ```java
    // 新写法
    switch (shape) {
        // 只关心半径，忽略中心点
        case Circle(Point _, int radius) ->
            System.out.println("A circle with radius: " + radius);
            
        // 只关心这是一个 Rectangle，不关心其任何组件
        case Rectangle(_, _) ->
            System.out.println("It's a Rectangle.");
            
        default -> System.out.println("Other shape.");
    }
    ```

#### 4. 语法要点

*   **`_` 是上下文关键字：** `_` 并不是一个通用的新关键字。它只在可以出现局部变量或模式的地方有特殊含义。你仍然可以有一个名为 `_` 的字段或方法。
*   **`_` 不能被读取：** `_` 的核心就是“不可用”。任何尝试读取 `_` 值的操作都会导致编译错误。例如 `System.out.println(_)` 是非法的。
*   **多次使用 `_`：** 在同一个声明中，你可以多次使用 `_`。每个 `_` 都是独立的，表示一个被忽略的组件。
    `case Point(_, _) -> ...` 是合法的。
*   **与 `var` 的关系：** 你可以把 `_` 看作 `var` 的一个特例，`var _` 也是合法的，并且和单独的 `_` 效果一样。

#### 5. 要点与注意事项 (Key Points & Cautions)

1.  **目的在于清晰性，而非偷懒：** 使用 `_` 的首要原则是为了让代码意图更清晰。如果一个变量虽然当前未使用，但在未来的代码迭代中很可能会被用到，那么给它一个有意义的名字仍然是更好的选择。
2.  **Lambda 参数的特殊规则：**
    *   `(key, _)`: 忽略第二个参数。
    *   `(_, value)`: 忽略第一个参数。
    *   `(_, _)`: 忽略所有参数。
    *   `(_) -> ...`: 忽略**唯一**的那个参数。
    *   `_ -> ...`: **非法语法**，必须有括号。
3.  **顶级 `_` vs. 嵌套 `_`：**
    *   `if (obj instanceof _)`: **非法**。未命名模式必须嵌套在另一个模式中，不能作为顶级模式。这是为了避免歧义。
    *   `if (obj instanceof Point(_, _))`: **合法**。

总结来说，未命名模式和变量是一个小而精的语言改进。它通过引入一个简单直观的符号 `_`，解决了多个场景下声明“无用”变量的普遍问题，让代码更干净、意图更明确，是 Java 语言在追求代码简洁性和表现力道路上持续努力的又一体现。