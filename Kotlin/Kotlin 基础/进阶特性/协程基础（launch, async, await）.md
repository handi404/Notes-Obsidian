### **Kotlin åç¨‹åŸºç¡€ï¼š`launch`, `async`, å’Œ `await`**

---

Kotlin åç¨‹æ˜¯ä¸€ç§è½»é‡çº§çš„çº¿ç¨‹ï¼Œå®ƒè®©å¼‚æ­¥ç¼–ç¨‹å˜å¾—ç®€å•ç›´è§‚ã€‚é€šè¿‡åç¨‹ï¼Œç¨‹åºå¯ä»¥ä»¥åŒæ­¥çš„æ–¹å¼ä¹¦å†™å¼‚æ­¥ä»£ç ï¼Œä»è€Œæé«˜ä»£ç çš„å¯è¯»æ€§ï¼ŒåŒæ—¶é¿å…å›è°ƒåœ°ç‹±ã€‚

åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†è®²è§£ Kotlin åç¨‹çš„åŸºç¡€ï¼Œå°¤å…¶æ˜¯å¦‚ä½•ä½¿ç”¨ `launch`ã€`async` å’Œ `await` æ¥ç®¡ç†åç¨‹çš„æ‰§è¡Œã€‚

---

## **1. ä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿ**

åç¨‹æ˜¯ä¸€ç§å¯æŒ‚èµ·çš„å‡½æ•°ï¼Œå®ƒæ˜¯è½»é‡çº§çš„å¹¶å‘å·¥å…·ã€‚åç¨‹ç”± **Kotlin åç¨‹åº“** æä¾›ï¼Œè¿è¡Œåœ¨ **åç¨‹ä¸Šä¸‹æ–‡** å’Œ **åç¨‹ä½œç”¨åŸŸ** ä¸­ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ï¼š

1. **è½»é‡çº§**ï¼šç›¸æ¯”çº¿ç¨‹ï¼Œåç¨‹æ¶ˆè€—çš„èµ„æºæ›´å°‘ï¼Œå¯ä»¥åŒæ—¶è¿è¡Œæ•°åƒä¸ªåç¨‹ã€‚
2. **æŒ‚èµ·ä¸æ¢å¤**ï¼šåç¨‹å¯ä»¥æŒ‚èµ·å½“å‰ä»»åŠ¡å¹¶å°†èµ„æºé‡Šæ”¾ï¼Œç¨ååœ¨éœ€è¦æ—¶æ¢å¤æ‰§è¡Œã€‚
3. **ç»“æ„åŒ–å¹¶å‘**ï¼šåç¨‹æ›´å®¹æ˜“ç®¡ç†çˆ¶å­åç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚

---

## **2. ä½¿ç”¨åç¨‹çš„å‰ç½®æ¡ä»¶**

åœ¨ä½¿ç”¨åç¨‹ä¹‹å‰ï¼Œéœ€è¦åœ¨é¡¹ç›®ä¸­å¼•å…¥ Kotlin çš„åç¨‹ä¾èµ–ï¼š

```kotlin
implementation("org.jetbrains.kotlinx:kotlinx-coroutines-core:1.x.x")  // æ ¸å¿ƒåº“
implementation("org.jetbrains.kotlinx:kotlinx-coroutines-android:1.x.x")  // Android ç¯å¢ƒï¼ˆå¯é€‰ï¼‰
```

---

## **3. å¯åŠ¨åç¨‹ï¼š`launch` å’Œ `async`**

### **3.1 `launch` å¯åŠ¨åç¨‹**

- `launch` æ˜¯æœ€å¸¸è§çš„åç¨‹æ„å»ºå™¨ï¼Œå¯åŠ¨ä¸€ä¸ªåç¨‹å¹¶ç«‹å³è¿”å›ã€‚
- å®ƒæ²¡æœ‰è¿”å›å€¼ï¼Œé€‚åˆç”¨äºæ‰§è¡Œä¸éœ€è¦ç»“æœçš„ä»»åŠ¡ã€‚

#### ç¤ºä¾‹ï¼šä½¿ç”¨ `launch` å¯åŠ¨åç¨‹

```kotlin
import kotlinx.coroutines.*

fun main() = runBlocking {
    launch {
        delay(1000L)
        println("Hello from Coroutine!")
    }
    println("Hello from Main!")
}
// è¾“å‡ºï¼š
// Hello from Main!
// ï¼ˆå»¶è¿Ÿ1ç§’ï¼‰
// Hello from Coroutine!
```

#### å…³é”®ç‚¹ï¼š

1. **`launch` æ˜¯å¼‚æ­¥çš„**ï¼šå®ƒä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œè€Œæ˜¯åœ¨åå°è¿è¡Œåç¨‹ã€‚
2. **`delay` æŒ‚èµ·å‡½æ•°**ï¼šå»¶è¿ŸæŒ‡å®šæ—¶é—´ï¼Œä½†ä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚

---

### **3.2 `async` å¯åŠ¨åç¨‹**

- `async` ä¹Ÿä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„åç¨‹ï¼Œä½†å®ƒä¼šè¿”å›ä¸€ä¸ª **`Deferred`** å¯¹è±¡ï¼Œç”¨äºè¡¨ç¤ºåç¨‹çš„ç»“æœã€‚
- `async` é€‚åˆç”¨äºéœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ã€‚

#### ç¤ºä¾‹ï¼šä½¿ç”¨ `async` å¯åŠ¨åç¨‹

```kotlin
import kotlinx.coroutines.*

fun main() = runBlocking {
    val deferred = async {
        delay(1000L)
        "Result from Coroutine"
    }
    println("Waiting for result...")
    println("Result: ${deferred.await()}")
}
// è¾“å‡ºï¼š
// Waiting for result...
// ï¼ˆå»¶è¿Ÿ1ç§’ï¼‰
// Result: Result from Coroutine
```

#### å…³é”®ç‚¹ï¼š

1. **`Deferred` å¯¹è±¡**ï¼šç±»ä¼¼äº `Future`ï¼Œè¡¨ç¤ºåç¨‹çš„å»¶è¿Ÿç»“æœã€‚
2. **`await`**ï¼šæŒ‚èµ·å½“å‰åç¨‹ï¼Œç›´åˆ° `Deferred` ç»“æœå¯ç”¨ã€‚

---

## **4. `launch` å’Œ `async` çš„åŒºåˆ«**

|ç‰¹æ€§|`launch`|`async`|
|---|---|---|
|è¿”å›å€¼|æ— è¿”å›å€¼ (`Job`)|è¿”å› `Deferred`ï¼ˆå¸¦ç»“æœï¼‰|
|é€‚ç”¨åœºæ™¯|ä¸éœ€è¦ç»“æœçš„ä»»åŠ¡|éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡|
|è°ƒç”¨æ–¹å¼|ç›´æ¥è°ƒç”¨å³å¯|é€šå¸¸éœ€è¦ç”¨ `await` è·å–ç»“æœ|

#### ç¤ºä¾‹ï¼šåŒæ—¶ä½¿ç”¨ `launch` å’Œ `async`

```kotlin
import kotlinx.coroutines.*

fun main() = runBlocking {
    launch {
        println("Launch: Start")
        delay(500L)
        println("Launch: End")
    }

    val result = async {
        println("Async: Start")
        delay(1000L)
        "Async Result"
    }

    println("Waiting for async result...")
    println("Result: ${result.await()}")
}
// è¾“å‡ºï¼š
// Launch: Start
// Async: Start
// Launch: End
// Waiting for async result...
// Result: Async Result
```

---

## **5. åç¨‹çš„æŒ‚èµ·å‡½æ•°**

### **5.1 ä»€ä¹ˆæ˜¯æŒ‚èµ·å‡½æ•°ï¼Ÿ**

æŒ‚èµ·å‡½æ•°æ˜¯ä½¿ç”¨ **`suspend`** å…³é”®å­—å®šä¹‰çš„å‡½æ•°ï¼Œå¯ä»¥åœ¨åç¨‹ä¸­è°ƒç”¨ï¼Œå¹¶å¯ä»¥è¢«æŒ‚èµ·å’Œæ¢å¤ã€‚

#### ç¤ºä¾‹ï¼šè‡ªå®šä¹‰æŒ‚èµ·å‡½æ•°

```kotlin
suspend fun mySuspendFunction() {
    delay(1000L)
    println("Hello from suspend function!")
}

fun main() = runBlocking {
    launch {
        mySuspendFunction()
    }
}
```

---

### **5.2 æŒ‚èµ·å‡½æ•°ä¸çº¿ç¨‹çš„åŒºåˆ«**

- **æŒ‚èµ·å‡½æ•°**ï¼šä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œåªæ˜¯æš‚åœåç¨‹çš„æ‰§è¡Œï¼Œé‡Šæ”¾çº¿ç¨‹èµ„æºã€‚
- **é˜»å¡å‡½æ•°**ï¼šç›´æ¥é˜»å¡çº¿ç¨‹ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆã€‚

---

## **6. ç»“æ„åŒ–å¹¶å‘**

Kotlin åç¨‹æä¾›äº†ç»“æ„åŒ–å¹¶å‘æ¥ç®¡ç†åç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œç¡®ä¿åç¨‹å¯åŠ¨åä¼šæœ‰æ˜ç¡®çš„çˆ¶ä½œç”¨åŸŸï¼Œå¹¶ä¸”æ‰€æœ‰å­åç¨‹éƒ½ä¼šåœ¨çˆ¶åç¨‹ç»“æŸå‰å®Œæˆã€‚

#### ç¤ºä¾‹ï¼šç»“æ„åŒ–å¹¶å‘çš„ä½œç”¨

```kotlin
import kotlinx.coroutines.*

fun main() = runBlocking {
    launch {
        delay(1000L)
        println("Task from launch")
    }

    coroutineScope { // åˆ›å»ºä¸€ä¸ªåç¨‹ä½œç”¨åŸŸ
        launch {
            delay(500L)
            println("Task from nested launch")
        }

        delay(100L)
        println("Task from coroutineScope")
    }

    println("Coroutine scope is over")
}
// è¾“å‡ºï¼š
// Task from coroutineScope
// Task from nested launch
// Task from launch
// Coroutine scope is over
```

- **`coroutineScope`**ï¼šåœ¨ä½œç”¨åŸŸå†…å¯åŠ¨çš„æ‰€æœ‰å­åç¨‹éƒ½æ‰§è¡Œå®Œåæ‰ä¼šç»“æŸã€‚
- **`runBlocking`**ï¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œé€šå¸¸åªç”¨äºæµ‹è¯•æˆ–å…¥å£å‡½æ•°ã€‚

---

## **7. ä½¿ç”¨ç¤ºä¾‹ï¼šå¹¶å‘è®¡ç®—**

ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºå¦‚ä½•é€šè¿‡ `async` å¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œå¹¶è·å–å®ƒä»¬çš„ç»“æœã€‚

#### ç¤ºä¾‹ï¼šè®¡ç®—ä¸¤ä¸ªä»»åŠ¡çš„ç»“æœ

```kotlin
import kotlinx.coroutines.*

suspend fun calculateTask1(): Int {
    delay(1000L)
    return 10
}

suspend fun calculateTask2(): Int {
    delay(2000L)
    return 20
}

fun main() = runBlocking {
    val result1 = async { calculateTask1() }
    val result2 = async { calculateTask2() }

    println("Waiting for results...")
    println("Total: ${result1.await() + result2.await()}")
}
// è¾“å‡ºï¼š
// Waiting for results...
// ï¼ˆæ€»å…±å»¶è¿Ÿ 2 ç§’ï¼Œå› ä¸ºä¸¤ä¸ªä»»åŠ¡æ˜¯å¹¶å‘çš„ï¼‰
// Total: 30
```

---

## **8. å¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹**

1. **åç¨‹ä¸Šä¸‹æ–‡ä¸è°ƒåº¦å™¨**ï¼š
    
    - é»˜è®¤æƒ…å†µä¸‹ï¼Œåç¨‹è¿è¡Œåœ¨è°ƒç”¨è€…çº¿ç¨‹ä¸Šï¼Œå¯ä»¥é€šè¿‡ `Dispatchers` æ”¹å˜åç¨‹çš„æ‰§è¡Œçº¿ç¨‹ï¼ˆä¾‹å¦‚ `IO`ã€`Main` æˆ– `Default`ï¼‰ã€‚
2. **å¼‚å¸¸å¤„ç†**ï¼š
    
    - åç¨‹ä¸­çš„å¼‚å¸¸ä¼šä¼ æ’­åˆ°çˆ¶ä½œç”¨åŸŸä¸­ï¼Œå»ºè®®ä½¿ç”¨ `try-catch` æˆ– `supervisorScope` æ¥æ•è·å¼‚å¸¸ã€‚
3. **ä½¿ç”¨ `launch` å’Œ `async` çš„é€‰æ‹©**ï¼š
    
    - å¦‚æœä½ åªéœ€è¦æ‰§è¡Œä»»åŠ¡è€Œä¸éœ€è¦è¿”å›å€¼ï¼Œç”¨ `launch`ã€‚
    - å¦‚æœéœ€è¦è¿”å›å€¼ï¼Œç”¨ `async`ã€‚

---

## **9. ç»ƒä¹ é¢˜**

1. ä½¿ç”¨ `launch` å¯åŠ¨ä¸¤ä¸ªåç¨‹ï¼Œåˆ†åˆ«å»¶è¿Ÿ 1 ç§’å’Œ 2 ç§’åæ‰“å°æ¶ˆæ¯ã€‚
2. åˆ›å»ºä¸€ä¸ªæŒ‚èµ·å‡½æ•° `fetchData`ï¼Œæ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶åœ¨ `main` å‡½æ•°ä¸­è°ƒç”¨å®ƒã€‚
3. ä½¿ç”¨ `async` å¹¶å‘æ‰§è¡Œä¸‰ä¸ªä»»åŠ¡ï¼Œå¹¶è¿”å›å®ƒä»¬ç»“æœçš„æ€»å’Œã€‚
4. ç»“åˆ `launch` å’Œ `coroutineScope`ï¼Œå®ç°ä¸€ä¸ªçˆ¶åç¨‹å’Œå­åç¨‹çš„ç»“æ„åŒ–å¹¶å‘æ¨¡å‹ã€‚
5. ä½¿ç”¨ `try-catch` æ•è·åç¨‹ä¸­çš„å¼‚å¸¸ã€‚

å®Œæˆç»ƒä¹ åï¼Œå¯ä»¥éšæ—¶ä¸æˆ‘è®¨è®ºç­”æ¡ˆæˆ–é—®é¢˜ï¼ ğŸ˜Š