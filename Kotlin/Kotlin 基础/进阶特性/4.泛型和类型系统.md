### **Kotlin æ³›å‹å’Œç±»å‹ç³»ç»Ÿè¯¦è§£**

---

Kotlin çš„æ³›å‹å’Œç±»å‹ç³»ç»Ÿæ˜¯å…¶å¼ºå¤§è€Œçµæ´»çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå…è®¸ä»£ç åœ¨ä¿è¯ç±»å‹å®‰å…¨çš„åŒæ—¶å®ç°æ›´é«˜çš„å¤ç”¨æ€§å’Œçµæ´»æ€§ã€‚åœ¨è¿™ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥è®²è§£ **æ³›å‹ï¼ˆGenericsï¼‰** çš„æ¦‚å¿µåŠå…¶åœ¨ Kotlin ä¸­çš„ä½¿ç”¨ï¼Œä»¥åŠ Kotlin ç±»å‹ç³»ç»Ÿä¸­çš„é‡è¦ç‰¹æ€§ã€‚

---

## **1. æ³›å‹åŸºç¡€**

### **1.1 ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ**

æ³›å‹æ˜¯ä¸€ç§ç”¨äºç¼–å†™ç±»å‹å®‰å…¨ã€çµæ´»ä»£ç çš„æŠ€æœ¯ï¼Œå…è®¸ç±»ã€æ¥å£æˆ–å‡½æ•°åœ¨å£°æ˜æ—¶ä¸æŒ‡å®šå…·ä½“çš„æ•°æ®ç±»å‹ï¼Œè€Œæ˜¯ä½¿ç”¨ **ç±»å‹å‚æ•°** æ¥ä»£æ›¿ï¼Œå…·ä½“ç±»å‹ä¼šåœ¨å®ä¾‹åŒ–æˆ–è°ƒç”¨æ—¶ç¡®å®šã€‚

#### ä¸ºä»€ä¹ˆä½¿ç”¨æ³›å‹ï¼Ÿ

1. **ç±»å‹å®‰å…¨**ï¼šé¿å…ç±»å‹å¼ºåˆ¶è½¬æ¢å¸¦æ¥çš„è¿è¡Œæ—¶é”™è¯¯ã€‚
2. **ä»£ç å¤ç”¨**ï¼šç›¸åŒçš„ä»£ç é€»è¾‘å¯ä»¥æ”¯æŒä¸åŒçš„æ•°æ®ç±»å‹ã€‚

---

### **1.2 æ³›å‹ç±»**

#### å®šä¹‰æ³›å‹ç±»

ä½¿ç”¨å°–æ‹¬å· `<T>` å®šä¹‰æ³›å‹ç±»ï¼Œå…¶ä¸­ `T` æ˜¯ç±»å‹å‚æ•°ã€‚

```kotlin
class Box<T>(val value: T)

fun main() {
    val intBox = Box(123)  // T æ¨æ–­ä¸º Int
    val stringBox = Box("Hello")  // T æ¨æ–­ä¸º String
    
    println(intBox.value)  // è¾“å‡º: 123
    println(stringBox.value)  // è¾“å‡º: Hello
}
```

#### å…³é”®ç‚¹ï¼š

- **`<T>`** æ˜¯æ³›å‹ç±»å‹å‚æ•°ï¼Œå¯ä»¥ç”¨ä»»æ„å­—æ¯æˆ–å•è¯è¡¨ç¤ºï¼ˆå¦‚ `<E>`ã€`<K, V>`ï¼‰ã€‚
- å®ä¾‹åŒ–æ—¶ï¼Œç±»å‹å‚æ•°ä¼šè¢«æ¨æ–­æˆ–æ˜¾å¼æŒ‡å®šã€‚

---

### **1.3 æ³›å‹å‡½æ•°**
[[æ³›å‹å‡½æ•°çš„ç±»å‹å‚æ•°]]
#### å®šä¹‰æ³›å‹å‡½æ•°

æ³›å‹å‡½æ•°åœ¨å‡½æ•°åå‰æ·»åŠ ç±»å‹å‚æ•° `<T>`ã€‚

```kotlin
fun <T> printItem(item: T) {
    println("Item: $item")
}

fun main() {
    printItem(123)  // è¾“å‡º: Item: 123
    printItem("Hello")  // è¾“å‡º: Item: Hello
}
```

#### æ³›å‹å‡½æ•°çš„åº”ç”¨

- é€‚åˆç¼–å†™ä¸å…·ä½“ç±»å‹æ— å…³çš„å·¥å…·å‡½æ•°ã€‚
- æ”¯æŒç±»å‹å‚æ•°çš„è‡ªåŠ¨æ¨æ–­ã€‚

---

### **1.4 å¤šä¸ªç±»å‹å‚æ•°**

æ³›å‹æ”¯æŒå¤šä¸ªç±»å‹å‚æ•°ï¼Œä½¿ç”¨é€—å·åˆ†éš”ã€‚

```kotlin
class PairBox<K, V>(val key: K, val value: V)

fun main() {
    val pair = PairBox("name", "Alice")
    println("Key: ${pair.key}, Value: ${pair.value}")
    // è¾“å‡º: Key: name, Value: Alice
}
```

---

## **2. Kotlin æ³›å‹çš„é«˜çº§ç‰¹æ€§**

### **2.1 ç±»å‹å‚æ•°çº¦æŸ**

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ³›å‹å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ã€‚å¦‚æœéœ€è¦å¯¹æ³›å‹ç±»å‹è¿›è¡Œçº¦æŸï¼Œå¯ä»¥ä½¿ç”¨ **`where` å­å¥** æˆ–ç»§æ‰¿å…³é”®å­—ã€‚

#### é™åˆ¶ä¸ºæŸç§ç±»å‹åŠå…¶å­ç±»

```kotlin
//toDouble()æ–¹æ³•ä¸èƒ½ç›´æ¥ç”¨äºæ³›å‹ç±»å‹`T`ã€‚éœ€è¦ç¡®ä¿`T`æ˜¯ä¸€ä¸ªå¯ä»¥è½¬æ¢ä¸ºÂ `Double`Â çš„ç±»å‹ã€‚
fun <T : Number> sum(a: T, b: T): Double {
    return a.toDouble() + b.toDouble()
}

fun main() {
    println(sum(5, 10))  // è¾“å‡º: 15.0
    println(sum(3.5, 4.5))  // è¾“å‡º: 8.0
    // println(sum("Hello", "World"))  // ç¼–è¯‘é”™è¯¯
}
```

#### å¤šçº¦æŸé™åˆ¶

```kotlin
fun <T> ensureStringLength(value: T) where T : CharSequence, T : Comparable<T> {
    println("Length: ${value.length}")
}

fun main() {
    ensureStringLength("Hello")  // è¾“å‡º: Length: 5
    // ensureStringLength(123)  // ç¼–è¯‘é”™è¯¯
}
```

---

### **2.2 æ³›å‹çš„åå˜ä¸é€†å˜**

#### ä»€ä¹ˆæ˜¯åå˜ä¸é€†å˜ï¼Ÿ

- **åå˜ï¼ˆCovarianceï¼‰**ï¼šå­ç±»å‹å¯ä»¥å®‰å…¨åœ°æ›¿æ¢çˆ¶ç±»å‹ï¼Œç”¨ **`out`** ä¿®é¥°ã€‚
- **é€†å˜ï¼ˆContravarianceï¼‰**ï¼šçˆ¶ç±»å‹å¯ä»¥å®‰å…¨åœ°æ›¿æ¢å­ç±»å‹ï¼Œç”¨ **`in`** ä¿®é¥°ã€‚
- **ä¸å˜ï¼ˆInvarianceï¼‰**ï¼šç±»å‹å‚æ•°æ—¢ä¸èƒ½æ˜¯å­ç±»å‹ï¼Œä¹Ÿä¸èƒ½æ˜¯çˆ¶ç±»å‹ã€‚

---

#### åå˜ï¼ˆ`out`ï¼‰

ç”¨äº **ç”Ÿäº§è€…**ï¼ˆåªè¿”å›ç±»å‹ï¼Œä¸æ¶ˆè´¹ç±»å‹ï¼‰ã€‚

```kotlin
class Producer<out T>(val value: T)

fun main() {
    val stringProducer: Producer<String> = Producer("Hello")
    val anyProducer: Producer<Any> = stringProducer  // åå˜å…è®¸
    println(anyProducer.value)  // è¾“å‡º: Hello
}
```

---

#### é€†å˜ï¼ˆ`in`ï¼‰

ç”¨äº **æ¶ˆè´¹è€…**ï¼ˆåªæ¶ˆè´¹ç±»å‹ï¼Œä¸è¿”å›ç±»å‹ï¼‰ã€‚

```kotlin
class Consumer<in T> {
    fun consume(item: T) {
        println("Consumed: $item")
    }
}

fun main() {
    val stringConsumer: Consumer<String> = Consumer()
    val anyConsumer: Consumer<Any> = stringConsumer  // é€†å˜å…è®¸
    anyConsumer.consume(123)  // è¾“å‡º: Consumed: 123
}
```

---

#### ä¸å˜ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰

ä¸å˜ç±»å‹å‚æ•°æ—¢ä¸èƒ½åå˜ï¼Œä¹Ÿä¸èƒ½é€†å˜ã€‚

```kotlin
class Container<T>(val value: T)

fun main() {
    val stringContainer: Container<String> = Container("Hello")
    // val anyContainer: Container<Any> = stringContainer  // ç¼–è¯‘é”™è¯¯
}
```

---

### **2.3 æ˜Ÿå·æŠ•å½±ï¼ˆStar Projectionï¼‰**

å¦‚æœä¸ç¡®å®šæ³›å‹çš„å…·ä½“ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨æ˜Ÿå· `*` æ¥ä»£æ›¿ã€‚

#### ç¤ºä¾‹ï¼šæ˜Ÿå·æŠ•å½±

```kotlin
fun printList(list: List<*>) {
    for (item in list) {
        println(item)
    }
}

fun main() {
    val stringList: List<String> = listOf("A", "B", "C")
    val intList: List<Int> = listOf(1, 2, 3)
    
    printList(stringList)
    printList(intList)
}
// è¾“å‡º:
// A
// B
// C
// 1
// 2
// 3
```

---

## **3. Kotlin ç±»å‹ç³»ç»Ÿ**

### **3.1 ç±»å‹æ¨æ–­**

Kotlin æ‹¥æœ‰å¼ºå¤§çš„ç±»å‹æ¨æ–­èƒ½åŠ›ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æ— éœ€æ˜¾å¼å£°æ˜å˜é‡çš„ç±»å‹ã€‚

#### ç¤ºä¾‹ï¼š

```kotlin
val x = 10  // æ¨æ–­ä¸º Int
val y = "Hello"  // æ¨æ–­ä¸º String
val z = listOf(1, 2, 3)  // æ¨æ–­ä¸º List<Int>
```

---

### **3.2 ç©ºå®‰å…¨ç±»å‹ï¼ˆNullable Typesï¼‰**

Kotlin ç±»å‹ç³»ç»Ÿå¤©ç„¶æ”¯æŒ **ç©ºå®‰å…¨**ï¼Œä½¿ç”¨ `?` è¡¨ç¤ºå¯ä¸ºç©ºç±»å‹ï¼Œå¼ºåˆ¶å¼€å‘è€…åœ¨å¤„ç†ç©ºå€¼æ—¶è¿›è¡Œæ˜¾å¼æ£€æŸ¥ã€‚

#### ç¤ºä¾‹ï¼š

```kotlin
var nullableString: String? = "Hello"
println(nullableString?.length)  // å®‰å…¨è°ƒç”¨
nullableString = null
println(nullableString?.length)  // è¾“å‡º: null
```

---

### **3.3 ç±»å‹åˆ«å**

ç±»å‹åˆ«åä½¿ç”¨ `typealias` å®šä¹‰ï¼Œç®€åŒ–å¤æ‚ç±»å‹çš„ä½¿ç”¨ã€‚

#### ç¤ºä¾‹ï¼š

```kotlin
typealias StringMap = Map<String, String>

fun printMap(map: StringMap) {
    map.forEach { (key, value) -> println("$key -> $value") }
}

fun main() {
    val map: StringMap = mapOf("Name" to "Alice", "Age" to "25")
    printMap(map)
}
```

---

## **4. æ³›å‹å’Œç±»å‹ç³»ç»Ÿç»¼åˆç»ƒä¹ **

### **ç»ƒä¹ é¢˜**

1. å®šä¹‰ä¸€ä¸ªæ³›å‹ç±» `Storage<T>`ï¼Œå¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„å€¼ï¼Œå¹¶å®ç°è·å–å’Œè®¾ç½®å€¼çš„åŠŸèƒ½ã€‚
2. ç¼–å†™ä¸€ä¸ªæ³›å‹å‡½æ•° `compareValues`ï¼Œæ¥å—ä¸¤ä¸ªå€¼ï¼Œå¹¶è¿”å›å®ƒä»¬ä¸­è¾ƒå¤§çš„å€¼ã€‚
3. ä½¿ç”¨åå˜ï¼ˆ`out`ï¼‰å®šä¹‰ä¸€ä¸ª `Producer` ç±»ï¼Œç¡®ä¿å­ç±»å‹å¯ä»¥å®‰å…¨èµ‹å€¼ç»™çˆ¶ç±»å‹ã€‚
4. ä½¿ç”¨é€†å˜ï¼ˆ`in`ï¼‰å®šä¹‰ä¸€ä¸ª `Consumer` ç±»ï¼Œç¡®ä¿çˆ¶ç±»å‹å¯ä»¥å®‰å…¨èµ‹å€¼ç»™å­ç±»å‹ã€‚
5. å®šä¹‰ä¸€ä¸ª `PairBox` ç±»ï¼Œæ”¯æŒä¸¤ä¸ªç±»å‹å‚æ•°ï¼Œå¹¶å®ç°ä¸€ä¸ª `swap` å‡½æ•°ï¼Œç”¨äºäº¤æ¢è¿™ä¸¤ä¸ªå€¼çš„ä½ç½®ã€‚

å®Œæˆç»ƒä¹ åï¼Œå¯ä»¥éšæ—¶ä¸æˆ‘è®¨è®ºç­”æ¡ˆæˆ–é‡åˆ°çš„é—®é¢˜ï¼ ğŸ˜Š