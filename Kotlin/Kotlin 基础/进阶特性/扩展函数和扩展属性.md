### **Kotlin 进阶特性：扩展函数和扩展属性**

---

扩展（Extension）是 Kotlin 提供的一种强大功能，它允许你**为现有的类添加新的函数和属性，而无需继承或修改其源码**。扩展函数和属性能提升代码的简洁性和可读性，非常适合在实际开发中使用。

---

## **1. 扩展函数**

扩展函数允许你为已有的类（包括第三方类和标准库类）添加新函数。

### **1.1 定义扩展函数**

扩展函数的定义语法为：  
`fun ClassName.functionName(parameters): ReturnType { // Function body }`

#### 示例：给 `String` 类添加一个扩展函数

```kotlin
fun String.isPalindrome(): Boolean {
    return this == this.reversed()
}

fun main() {
    val word = "madam"
    println(word.isPalindrome())  // 输出: true
}
```

- **`String`**：扩展的目标类。
- **`isPalindrome()`**：扩展函数，检查字符串是否是回文。
- **`this`**：代表被扩展的对象（此处是字符串本身）。

---

### **1.2 使用扩展函数的注意事项**

1. **扩展函数不会真正修改类**：它只是对该类的一个“静态”扩展。
    - 你不能通过扩展函数直接访问类的私有成员或受保护成员。
2. **扩展函数的调用优先级**：如果类中已经定义了同名函数，则优先调用类本身的函数，而非扩展函数。

#### 示例：

```kotlin
class Example {
    fun greet() {
        println("Class function")
    }
}

fun Example.greet() {
    println("Extension function")
}

fun main() {
    val example = Example()
    example.greet()  // 输出: Class function
}
```

---

### **1.3 实用示例：扩展集合操作**

扩展函数可以用于集合的增强操作。

#### 示例：统计集合中偶数的个数

```kotlin
fun List<Int>.countEvens(): Int {
    return this.count { it % 2 == 0 }
}

fun main() {
    val numbers = listOf(1, 2, 3, 4, 5, 6)
    println(numbers.countEvens())  // 输出: 3
}
```

---

## **2. 扩展属性**

扩展属性允许你为类添加新的属性，但实际上扩展属性是通过 **getter/setter** 模拟实现的，因此它们不能存储状态。

### **2.1 定义扩展属性**

扩展属性的定义语法为：  
`val/var ClassName.propertyName: PropertyType get() { // Getter body }`

#### 示例：为 `String` 添加一个扩展属性，获取第一个字符

```kotlin
val String.firstChar: Char
    get() = this[0]

fun main() {
    val word = "Kotlin"
    println(word.firstChar)  // 输出: K
}
```

- **`firstChar`**：扩展属性，用于获取字符串的第一个字符。
- **`get()`**：扩展属性的 getter 方法。

---

### **2.2 使用扩展属性的注意事项**

1. **扩展属性无法存储状态**：因为它们没有背后的字段（backing field）。
2. **只能通过 getter 或 setter 定义值**：如果定义为 `val`，只能提供 `get()`；如果定义为 `var`，需要提供 `get()` 和 `set()`。

#### 示例：为 `List` 添加扩展属性，获取集合的中位数

```kotlin
val List<Int>.median: Double
    get() {
        val sortedList = this.sorted()
        return if (size % 2 == 0) {
            (sortedList[size / 2 - 1] + sortedList[size / 2]) / 2.0
        } else {
            sortedList[size / 2].toDouble()
        }
    }

fun main() {
    val numbers = listOf(1, 3, 5, 7)
    println(numbers.median)  // 输出: 4.0
}
```

---

## **3. 扩展与继承**

扩展函数和属性无法被子类重写（override），因为它们在编译期静态解析。即使子类重写了父类中的某个方法，扩展函数依旧调用的是父类的扩展版本。

#### 示例：

```kotlin
open class Parent
class Child : Parent()

fun Parent.greet() = "Hello from Parent"
fun Child.greet() = "Hello from Child"

fun main() {
    val parent: Parent = Child()
    println(parent.greet())  // 输出: Hello from Parent
}
```

---

## **4. 常见用途**

### **4.1 添加实用功能**

扩展函数非常适合为第三方库或标准库的类添加自定义功能。

#### 示例：为 `Int` 添加扩展函数，判断是否为偶数

```kotlin
fun Int.isEven(): Boolean = this % 2 == 0

fun main() {
    println(4.isEven())  // 输出: true
    println(5.isEven())  // 输出: false
}
```

---

### **4.2 更优雅的代码**

扩展函数可以简化代码逻辑，使得代码更直观和可读。

#### 示例：检查 `String` 是否为空或仅包含空格

```kotlin
fun String?.isNullOrEmptyOrBlank(): Boolean {
    return this == null || this.isEmpty() || this.isBlank()
}

fun main() {
    val str: String? = "  "
    println(str.isNullOrEmptyOrBlank())  // 输出: true
}
```

---

## **5. Kotlin 标准库中的扩展函数与属性**

Kotlin 标准库中有许多扩展函数和扩展属性，以下是一些常见的例子：

### **5.1 字符串的扩展函数**

- `String.isNullOrEmpty()`：检查字符串是否为 `null` 或空。
- `String.isNullOrBlank()`：检查字符串是否为 `null`、空或仅包含空格。

#### 示例：

```kotlin
fun main() {
    val str: String? = null
    println(str.isNullOrEmpty())  // 输出: true
    println(str.isNullOrBlank())  // 输出: true
}
```

---

### **5.2 集合的扩展函数**

- `List<Int>.sum()`：计算列表中所有数字的和。
- `List<Int>.average()`：计算列表的平均值。

#### 示例：

```kotlin
fun main() {
    val numbers = listOf(1, 2, 3, 4, 5)
    println(numbers.sum())  // 输出: 15
    println(numbers.average())  // 输出: 3.0
}
```

---

## **6. 练习题**

1. 定义一个扩展函数 `Int.isOdd()`，判断整数是否是奇数。
2. 为 `String` 定义一个扩展函数 `wordCount()`，统计字符串中单词的数量。
3. 创建一个扩展属性 `List<Int>.maxValue`，返回集合中最大的值。
4. 使用扩展函数为 `List<String>` 提供一个 `longestWord()` 方法，返回最长的字符串。
5. 编写一个扩展函数 `Double.roundTo(n: Int)`，将浮点数保留到指定的小数位数。

完成后随时可以和我讨论答案或问题！ 😊