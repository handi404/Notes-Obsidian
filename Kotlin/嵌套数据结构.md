**Kotlin 中的嵌套数据结构**是指将一种数据结构嵌套到另一种数据结构中，比如列表中包含列表、集合中包含集合，或者 Map 的值中存储集合等。嵌套数据结构是解决复杂数据存储需求的重要工具，广泛用于多维数据、树形结构、表格数据等场景。

以下是 Kotlin 中嵌套数据结构的详解，包括如何定义、使用以及常见的操作。

---

### **1. 嵌套列表（`List<List>`）**

#### **定义**

嵌套列表是指列表中每个元素又是一个列表。

```kotlin
val nestedList: List<List<Int>> = listOf(
    listOf(1, 2, 3),
    listOf(4, 5, 6),
    listOf(7, 8, 9)
)
```

#### **操作**

1. **访问元素**
    
    - 使用两层索引：第一层访问外部列表，第二层访问内部列表。
    
    ```kotlin
    println(nestedList[0][1]) // 输出：2
    ```
    
2. **迭代**
    
    - 使用嵌套循环。
    
    ```kotlin
    for (innerList in nestedList) {
        for (value in innerList) {
            print("$value ") // 输出：1 2 3 4 5 6 7 8 9
        }
    }
    ```
    
3. **扁平化处理**
    
    - 使用 `flatten()` 将嵌套列表展开为单层列表。
    
    ```kotlin
    val flatList = nestedList.flatten()
    println(flatList) // 输出：[1, 2, 3, 4, 5, 6, 7, 8, 9]
    ```
    

---

### **2. 嵌套集合（`Set<Set>`）**

#### **定义**

集合中包含集合。嵌套集合适合用于存储去重的分组数据。

```kotlin
val nestedSet: Set<Set<String>> = setOf(
    setOf("Apple", "Banana"),
    setOf("Orange", "Grape"),
    setOf("Apple", "Cherry")
)
```

#### **操作**

1. **访问元素**
    
    - 需要通过迭代访问，因为 `Set` 无法通过索引直接访问。
    
    ```kotlin
    for (innerSet in nestedSet) {
        println(innerSet) // 输出每个内部集合
    }
    ```
    
2. **扁平化处理**
    
    - 使用 `flatMap` 将嵌套集合合并为单层集合。
    
    ```kotlin
    val flatSet = nestedSet.flatMap { it }.toSet()
    println(flatSet) // 输出：[Apple, Banana, Orange, Grape, Cherry]
    ```
    

---

### **3. 嵌套映射（Map<K, Map<K, V>>）**

#### **定义**

Map 中的值本身是一个 Map，适合存储树形结构或分层的数据。

```kotlin
val nestedMap: Map<String, Map<String, Int>> = mapOf(
    "Group1" to mapOf("A" to 1, "B" to 2),
    "Group2" to mapOf("C" to 3, "D" to 4)
)
```

#### **操作**

1. **访问元素**
    
    - 通过两次 `get` 或两次中括号访问。
    
    ```kotlin
    println(nestedMap["Group1"]?.get("A")) // 输出：1
    ```
    
2. **迭代**
    
    - 嵌套迭代外层和内层 Map。
    
    ```kotlin
    for ((key, innerMap) in nestedMap) {
        println("$key: $innerMap")
        for ((innerKey, value) in innerMap) {
            println("$innerKey -> $value")
        }
    }
    ```
    

---

### **4. 组合嵌套（复杂嵌套结构）**

Kotlin 支持任意组合的嵌套数据结构，比如 `Map<String, List<Set<Int>>>` 或 `List<Map<String, Double>>`。

#### **示例：复杂嵌套结构**

```kotlin
val complexStructure: Map<String, List<Set<Int>>> = mapOf(
    "First" to listOf(setOf(1, 2, 3), setOf(4, 5)),
    "Second" to listOf(setOf(6, 7), setOf(8, 9))
)
```

#### **操作**

1. **访问元素**
    
    - 按层级依次访问。
    
    ```kotlin
    println(complexStructure["First"]?.get(0)?.contains(2)) // 输出：true
    ```
    
2. **迭代**
    
    - 嵌套迭代所有层级。
    
    ```kotlin
    for ((key, list) in complexStructure) {
        println("$key:")
        for (set in list) {
            println(set)
        }
    }
    ```
    
3. **数据扁平化**
    
    - 使用 `flatMap` 或自定义处理。
    
    ```kotlin
    val flattened = complexStructure.values.flatMap { it }.flatMap { it }
    println(flattened) // 输出：[1, 2, 3, 4, 5, 6, 7, 8, 9]
    ```
    

---

### **5. 嵌套数据结构的常见操作总结**

|操作|函数/方法|示例|
|---|---|---|
|**扁平化处理**|`flatten()`, `flatMap()`|嵌套列表、集合等展开为单层结构|
|**访问嵌套元素**|多层索引或迭代|通过 `list[index]` 或 `map[key]`|
|**过滤**|`filter`, `filterKeys`, `filterValues`|过滤外层或内层数据|
|**映射**|`map`, `mapValues`, `mapKeys`|修改嵌套结构的内容或键值|
|**查找**|`find`, `contains`|查找嵌套元素是否存在|

---

### **6. 使用场景**

- **多维数据存储**
    - 比如棋盘、表格、矩阵等，可以用 `List<List<Int>>` 表示。
- **树形结构**
    - 比如文件系统或组织架构，可以用 `Map<String, Map<String, Any>>` 表示。
- **分组和分类**
    - 比如学生成绩分组，可以用 `Map<String, List<Int>>` 表示。

---

### **7. 小技巧与注意事项**

1. **嵌套层次不宜过深**
    
    - 嵌套层次过深会导致代码难以阅读和维护，建议合理设计结构。
    - 可以用 **自定义类** 替代过深的嵌套结构。
2. **结合 Kotlin 的函数式工具**
    
    - 使用 `map`, `flatMap`, `filter`, `reduce` 等函数式工具简化嵌套数据的操作。
3. **类型推断**
    
    - Kotlin 通常可以推断嵌套数据的类型，但在复杂场景下可以显式声明类型以提高代码可读性。

---

### **示例项目：学生成绩管理系统**

```kotlin
val studentScores: Map<String, Map<String, Int>> = mapOf(
    "Alice" to mapOf("Math" to 85, "English" to 90),
    "Bob" to mapOf("Math" to 78, "English" to 88)
)

// 访问 Alice 的数学成绩
println(studentScores["Alice"]?.get("Math")) // 输出：85

// 计算所有学生的平均成绩
val averageScore = studentScores.values
    .flatMap { it.values }
    .average()

println("Average Score: $averageScore") // 输出：平均成绩
```

---

**总结：**  
Kotlin 的嵌套数据结构强大而灵活，可用于存储和处理复杂的分层数据。熟练掌握嵌套数据结构需要理解基本操作和函数式工具的结合使用，同时注意避免嵌套层次过深的问题以保证代码的可维护性。