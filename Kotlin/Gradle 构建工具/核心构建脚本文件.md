Gradle 的核心构建脚本文件主要是 `build.gradle`（Groovy DSL）或 `build.gradle.kts`（Kotlin DSL）。它定义了项目的构建逻辑，包括插件、依赖、任务、自定义逻辑等内容。以下是对核心构建脚本文件的详细讲解：

---

## **核心结构**

### 1. **插件配置**

插件是 Gradle 的扩展点，提供特定功能（如构建 Java 项目或运行 Spring 应用）。

- **Groovy DSL**：
    
    ```groovy
    plugins {
        id 'java'
        id 'org.springframework.boot' version '3.1.4'
    }
    ```
    
- **Kotlin DSL**：
    
    ```kotlin
    plugins {
        java
        id("org.springframework.boot") version "3.1.4"
    }
    ```
    

---

### 2. **项目属性**

`group` 和 `version` 定义了项目的组织信息，通常用于发布。

- **Groovy DSL**：
    
    ```groovy
    group = 'com.example'
    version = '1.0.0'
    ```
    
- **Kotlin DSL**：
    
    ```kotlin
    group = "com.example"
    version = "1.0.0"
    ```
    

---

### 3. **仓库配置**

指定依赖从哪里下载（如 Maven Central 或本地仓库）。

- **Groovy DSL**：
    
    ```groovy
    repositories {
        mavenCentral()
    }
    ```
    
- **Kotlin DSL**：
    
    ```kotlin
    repositories {
        mavenCentral()
    }
    ```
    

---

### 4. **依赖管理**

定义项目所需的库和模块，包括编译时依赖、测试依赖等。

- **Groovy DSL**：
    
    ```groovy
    dependencies {
        implementation 'org.springframework.boot:spring-boot-starter'
        testImplementation 'org.springframework.boot:spring-boot-starter-test'
    }
    ```
    
- **Kotlin DSL**：
    
    ```kotlin
    dependencies {
        implementation("org.springframework.boot:spring-boot-starter")
        testImplementation("org.springframework.boot:spring-boot-starter-test")
    }
    ```
    

#### **依赖配置范围**

- `implementation`：主代码使用的依赖，编译期和运行期都需要。
- `testImplementation`：测试代码所需的依赖，仅在测试时可用。
- `compileOnly`：仅编译时可用，运行时不需要。
- `runtimeOnly`：仅运行时需要，编译时不需要。

---

### 5. **任务定义**

Gradle 的核心是任务（`Task`），可以通过构建脚本定义和定制任务。

- **定义自定义任务**：
    
    - **Groovy DSL**：
        
        ```groovy
        tasks.register('hello') {
            doLast {
                println 'Hello, Gradle!'
            }
        }
        ```
        
    - **Kotlin DSL**：
        
        ```kotlin
        tasks.register("hello") {
            doLast {
                println("Hello, Gradle!")
            }
        }
        ```
        
- **依赖关系的任务**：
    
    ```groovy
    tasks.register('buildApp') {
        dependsOn 'compileJava'
        doLast {
            println 'Building the app...'
        }
    }
    ```
    

---

### 6. **自定义属性**

在构建脚本中定义或使用自定义属性。

- **Groovy DSL**：
    
    ```groovy
    ext {
        springBootVersion = '3.1.4'
    }
    dependencies {
        implementation "org.springframework.boot:spring-boot-starter:$springBootVersion"
    }
    ```
    
- **Kotlin DSL**：
    
    ```kotlin
    val springBootVersion: String by extra("3.1.4")
    dependencies {
        implementation("org.springframework.boot:spring-boot-starter:$springBootVersion")
    }
    ```
    

---

### 7. **多模块支持**

在多模块项目中，`build.gradle` 配置模块依赖关系。

- **根项目 `build.gradle`**：
    
    ```groovy
    allprojects {
        repositories {
            mavenCentral()
        }
    }
    ```
    
- **子模块依赖**：
    
    ```groovy
    dependencies {
        implementation project(':moduleA')
    }
    ```
    

---

## **构建脚本详细示例**

以下是一个包含 Spring Boot 和 Kotlin 的 Gradle 构建脚本示例（Kotlin DSL）：

```kotlin
plugins {
    kotlin("jvm") version "1.9.10"
    id("org.springframework.boot") version "3.1.4"
    id("io.spring.dependency-management") version "1.1.3"
}

group = "com.example"
version = "1.0.0"
java.sourceCompatibility = JavaVersion.VERSION_17

repositories {
    mavenCentral()
}

dependencies {
    implementation("org.springframework.boot:spring-boot-starter")
    implementation("org.springframework.boot:spring-boot-starter-web")
    implementation("com.fasterxml.jackson.module:jackson-module-kotlin")
    implementation("org.jetbrains.kotlin:kotlin-reflect")
    testImplementation("org.springframework.boot:spring-boot-starter-test")
}

tasks.withType<Test> {
    useJUnitPlatform()
}
```

---

## **常用的 Gradle 配置块**

- **`java` 插件配置**：
    
    ```kotlin
    java {
        sourceCompatibility = JavaVersion.VERSION_17
        targetCompatibility = JavaVersion.VERSION_17
    }
    ```
    
- **日志输出控制**：
    
    ```kotlin
    tasks.withType<JavaCompile> {
        options.isFork = true
        options.compilerArgs.add("-Xlint:unchecked")
    }
    ```
    
- **Spring Boot 特定配置**：
    
    ```kotlin
    tasks.withType<org.springframework.boot.gradle.tasks.run.BootRun> {
        args("--spring.profiles.active=dev")
    }
    ```
    

---
