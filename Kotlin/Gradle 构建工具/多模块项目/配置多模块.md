多模块项目（Multi-Project Build）是 Gradle 中一个重要的特性，允许你将一个大型项目分解为多个子项目，并在一个构建中管理这些模块。在 Gradle 中，每个子项目通常都有自己的 `build.gradle` 文件，同时可以共享父项目的配置。接下来，我会介绍如何在 **Groovy DSL** 和 **Kotlin DSL** 中配置多模块项目，并详细说明两者的区别。

### 基本概念

1. **根项目**：包含所有子项目的顶级项目，通常在根项目的 `build.gradle` 中定义一些通用的配置、仓库、插件等。
2. **子项目**：根项目下的各个模块，每个子项目也可以有自己的 `build.gradle` 文件，定义该模块的特定构建配置和依赖。

### 多模块配置的步骤

#### 1. **根项目的 `settings.gradle` 或 `settings.gradle.kts`**

在多模块构建中，`settings.gradle` 文件用于声明项目的结构，指定哪些子项目会包含在构建中。这个文件位于项目根目录。

#### **Groovy DSL**

```groovy
// settings.gradle
rootProject.name = 'my-multi-project'
include 'moduleA', 'moduleB'  // 包含两个子项目 moduleA 和 moduleB
```

#### **Kotlin DSL**

```kotlin
// settings.gradle.kts
rootProject.name = "my-multi-project"
include("moduleA", "moduleB")  // 包含两个子项目 moduleA 和 moduleB
```

- `rootProject.name`：指定根项目的名称。
- `include`：指定包含的子项目。

#### 2. **根项目的 `build.gradle` 或 `build.gradle.kts`**

根项目的 `build.gradle` 文件中通常包含一些公共配置，比如仓库、插件、依赖版本等，所有子项目都会继承这些配置。

#### **Groovy DSL**

```groovy
// build.gradle
plugins {
    id 'java'
}

allprojects {
    repositories {
        mavenCentral()
    }
    version = '1.0.0'  // 所有子项目共享的版本号
}

subprojects {
    apply plugin: 'java'

    dependencies {
        implementation 'org.springframework:spring-core:5.3.8'
    }

    java {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
}
```

#### **Kotlin DSL**

```kotlin
// build.gradle.kts
plugins {
    id("java")
}

allprojects {
    repositories {
        mavenCentral()
    }
    version = "1.0.0"  // 所有子项目共享的版本号
}

subprojects {
    apply(plugin = "java")

    dependencies {
        implementation("org.springframework:spring-core:5.3.8")
    }

    java {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
}
```

- `allprojects`：这个块中的配置会应用于所有项目（包括根项目和子项目）。通常用于定义公共的插件、仓库等配置。
- `subprojects`：这个块中的配置仅适用于子项目。你可以在这里指定子项目的插件、依赖等。

#### 3. **子项目的 `build.gradle` 或 `build.gradle.kts`**

每个子项目可以有自己的构建脚本，专门处理该模块的依赖、任务和其他配置。通常子项目继承父项目的配置，除非子项目有特别的配置需求。

#### **Groovy DSL**

```groovy
// moduleA/build.gradle
dependencies {
    implementation project(':moduleB')  // 引用其他子项目 moduleB
}
```

#### **Kotlin DSL**

```kotlin
// moduleA/build.gradle.kts
dependencies {
    implementation(project(":moduleB"))  // 引用其他子项目 moduleB
}
```

- `implementation project(':moduleB')`：表示 `moduleA` 依赖 `moduleB` 这个子项目。

#### 4. **任务配置**

在多模块项目中，你可以在根项目或者子项目中定义任务，并在整个项目中共享或定制这些任务。

#### **Groovy DSL**

```groovy
task hello {
    doLast {
        println 'Hello from the root project!'
    }
}
```

#### **Kotlin DSL**

```kotlin
tasks.register("hello") {
    doLast {
        println("Hello from the root project!")
    }
}
```

### 完整示例：多模块项目配置

假设我们有一个多模块项目 `my-multi-project`，它包含两个子项目 `moduleA` 和 `moduleB`。

#### **根项目的 `settings.gradle`**

```groovy
rootProject.name = 'my-multi-project'
include 'moduleA', 'moduleB'
```

#### **根项目的 `build.gradle`**

```groovy
plugins {
    id 'java'
}

allprojects {
    repositories {
        mavenCentral()
    }
    version = '1.0.0'
}

subprojects {
    apply plugin: 'java'

    dependencies {
        implementation 'org.springframework:spring-core:5.3.8'
    }

    java {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
}
```

#### **子项目 `moduleA` 的 `build.gradle`**

```groovy
dependencies {
    implementation project(':moduleB')  // 依赖模块 B
}
```

#### **子项目 `moduleB` 的 `build.gradle`**

```groovy
// moduleB 没有额外的依赖，只使用公共依赖
```

### Kotlin DSL 示例

#### **根项目的 `settings.gradle.kts`**

```kotlin
rootProject.name = "my-multi-project"
include("moduleA", "moduleB")
```

#### **根项目的 `build.gradle.kts`**

```kotlin
plugins {
    id("java")
}

allprojects {
    repositories {
        mavenCentral()
    }
    version = "1.0.0"
}

subprojects {
    apply(plugin = "java")

    dependencies {
        implementation("org.springframework:spring-core:5.3.8")
    }

    java {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
}
```

#### **子项目 `moduleA` 的 `build.gradle.kts`**

```kotlin
dependencies {
    implementation(project(":moduleB"))  // 依赖模块 B
}
```

#### **子项目 `moduleB` 的 `build.gradle.kts`**

```kotlin
// moduleB 没有额外的依赖，只使用公共依赖
```

### 总结

- **多模块构建**：通过在根项目的 `settings.gradle` 中声明子项目，并在根项目的 `build.gradle` 中通过 `subprojects` 配置共享通用配置。每个子项目可以有自己的 `build.gradle` 来处理该模块特定的构建逻辑。
- **共享配置**：通过 `allprojects` 和 `subprojects` 块在根项目中共享配置，减少冗余。
- **子项目依赖**：通过 `implementation project(':moduleName')` 在子项目间建立依赖关系。