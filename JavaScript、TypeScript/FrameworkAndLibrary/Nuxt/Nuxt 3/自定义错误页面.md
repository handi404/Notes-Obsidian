åœ¨ Nuxt 3 ä¸­åˆ›å»º**è‡ªå®šä¹‰é”™è¯¯é¡µé¢**ã€‚

å½“ä½ çš„ Nuxt åº”ç”¨é‡åˆ°æ— æ³•å¤„ç†çš„é”™è¯¯æ—¶ï¼ˆæ¯”å¦‚è®¿é—®äº†ä¸å­˜åœ¨çš„é¡µé¢å¯¼è‡´ 404 Not Foundï¼Œæˆ–è€…æœåŠ¡ç«¯æ¸²æŸ“æ—¶ API è¯·æ±‚å¤±è´¥å¯¼è‡´ 500 Internal Server Errorï¼‰ï¼ŒNuxt éœ€è¦æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯æç¤ºé¡µé¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒNuxt ä¼šæä¾›ä¸€ä¸ªåŸºç¡€çš„é”™è¯¯é¡µé¢ï¼Œä½†é€šå¸¸ä½ ä¼šå¸Œæœ›ç”¨ä¸€ä¸ªç¬¦åˆä½ ç½‘ç«™è®¾è®¡ã€æ›´å‹å¥½çš„é¡µé¢æ¥æ›¿ä»£å®ƒã€‚

**æ ¸å¿ƒæœºåˆ¶ï¼šæ ¹ç›®å½•ä¸‹çš„ `error.vue` æ–‡ä»¶**

ä¸ Nuxt 2 ä¸åŒï¼ˆNuxt 2 ä½¿ç”¨ `layouts/error.vue`ï¼‰ï¼Œ**Nuxt 3** çš„æ–¹å¼æ›´åŠ ç›´æ¥ï¼š

1.  **åˆ›å»º `error.vue` æ–‡ä»¶**ï¼šåœ¨ä½ çš„ Nuxt é¡¹ç›®çš„**æ ¹ç›®å½•**ä¸‹ï¼ˆä¸ `app.vue`, `nuxt.config.ts` åŒçº§ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `error.vue` çš„æ–‡ä»¶ã€‚
    ```
    your-nuxt-project/
    â”œâ”€â”€ app.vue
    â”œâ”€â”€ nuxt.config.ts
    â”œâ”€â”€ package.json
    â”œâ”€â”€ pages/
    â”œâ”€â”€ components/
    â”œâ”€â”€ layouts/
    â””â”€â”€ error.vue  <-- å°±æ˜¯è¿™ä¸ªæ–‡ä»¶ï¼
    ```

2.  **ç¼–å†™é”™è¯¯é¡µé¢ç»„ä»¶**ï¼šè¿™ä¸ª `error.vue` æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ Vue ç»„ä»¶ã€‚Nuxt ä¼šåœ¨æ•è·åˆ°æœªå¤„ç†çš„é”™è¯¯æ—¶ï¼Œè‡ªåŠ¨æ¸²æŸ“è¿™ä¸ªç»„ä»¶ã€‚

**å…³é”®ï¼šæ¥æ”¶é”™è¯¯ä¿¡æ¯ (`error` Prop)**

ä¸ºäº†åœ¨ä½ çš„è‡ªå®šä¹‰é”™è¯¯é¡µé¢ä¸­æ˜¾ç¤ºç›¸å…³çš„é”™è¯¯ä¿¡æ¯ï¼ˆæ¯”å¦‚é”™è¯¯çŠ¶æ€ç ã€é”™è¯¯æ¶ˆæ¯ï¼‰ï¼ŒNuxt ä¼šè‡ªåŠ¨å°†ä¸€ä¸ªåŒ…å«é”™è¯¯è¯¦æƒ…çš„**å¯¹è±¡**ä½œä¸ºåä¸º `error` çš„ **prop** ä¼ é€’ç»™ä½ çš„ `error.vue` ç»„ä»¶ã€‚

ä½ éœ€è¦ä½¿ç”¨ `defineProps` æ¥æ¥æ”¶è¿™ä¸ª propï¼š

```vue
<!-- error.vue -->
<template>
  <div class="error-page">
    <!-- æ ¹æ®çŠ¶æ€ç æ˜¾ç¤ºä¸åŒå†…å®¹ -->
    <div v-if="error.statusCode === 404">
      <h1>ğŸ˜• é¡µé¢æœªæ‰¾åˆ° (404)</h1>
      <p>æŠ±æ­‰ï¼Œæˆ‘ä»¬æ‰¾ä¸åˆ°æ‚¨è¦è®¿é—®çš„é¡µé¢ï¼š<code>{{ error.url || $route.path }}</code></p>
      <p>ä¹Ÿè®¸æ‚¨å¯ä»¥å°è¯•è¿”å›é¦–é¡µï¼Ÿ</p>
    </div>
    <div v-else>
      <h1>ğŸ˜Ÿ å‘ç”Ÿé”™è¯¯ ({{ error.statusCode }})</h1>
      <p>æŠ±æ­‰ï¼ŒæœåŠ¡å™¨æˆ–åº”ç”¨å†…éƒ¨å‡ºç°äº†ä¸€äº›é—®é¢˜ã€‚</p>
      <p>{{ error.message || 'æœªçŸ¥é”™è¯¯' }}</p>
      <!-- åœ¨å¼€å‘æ¨¡å¼ä¸‹å¯ä»¥æ˜¾ç¤ºå †æ ˆä¿¡æ¯ -->
      <pre v-if="isDevelopment && error.stack">{{ error.stack }}</pre>
      <p>æ‚¨å¯ä»¥å°è¯•åˆ·æ–°é¡µé¢ï¼Œæˆ–è¿”å›é¦–é¡µã€‚</p>
    </div>

    <button @click="handleErrorClear">è¿”å›é¦–é¡µ</button>
  </div>
</template>

<script setup>
// æ¥æ”¶ Nuxt ä¼ é€’è¿‡æ¥çš„ error å¯¹è±¡ prop
const props = defineProps({
  error: {
    type: Object,
    required: true
  }
});

// åˆ¤æ–­æ˜¯å¦ä¸ºå¼€å‘ç¯å¢ƒï¼Œå¯é€‰
const isDevelopment = process.dev;

// è·å– Nuxt æä¾›çš„ clearError å·¥å…·å‡½æ•°
const handleErrorClear = () => {
  // clearError ä¼šæ¸…é™¤å½“å‰çš„ Nuxt é”™è¯¯çŠ¶æ€ï¼Œå¹¶å¯ä»¥é‡å®šå‘ç”¨æˆ·
  clearError({ redirect: '/' }); // é‡å®šå‘åˆ°é¦–é¡µ
};

// å¯é€‰ï¼šè®¾ç½®é¡µé¢æ ‡é¢˜
useHead({
  title: `é”™è¯¯ ${props.error.statusCode}`,
});
</script>

<style scoped>
.error-page {
  padding: 2rem;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 80vh; /* è®©å†…å®¹å‚ç›´å±…ä¸­ */
}
.error-page h1 {
  color: #e74c3c; /* çº¢è‰² */
  margin-bottom: 1rem;
}
.error-page p {
  margin-bottom: 1rem;
  color: #555;
}
.error-page code {
  background-color: #f0f0f0;
  padding: 2px 5px;
  border-radius: 3px;
}
.error-page button {
  padding: 0.8rem 1.5rem;
  background-color: #3498db; /* è“è‰² */
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
  transition: background-color 0.3s ease;
}
.error-page button:hover {
  background-color: #2980b9;
}
.error-page pre {
  background-color: #f5f5f5;
  padding: 1rem;
  border-radius: 4px;
  overflow-x: auto; /* æ°´å¹³æ»šåŠ¨ */
  text-align: left;
  max-width: 80%;
  margin-top: 1rem;
  white-space: pre-wrap; /* ä¿æŒæ¢è¡Œ */
  word-wrap: break-word;
}
</style>
```

**`error` Prop å¯¹è±¡çš„å¸¸è§å±æ€§ï¼š**

*   `statusCode` (Number): HTTP é”™è¯¯çŠ¶æ€ç  (å¦‚ `404`, `500`, `403` ç­‰)ã€‚è¿™æ˜¯æœ€æœ‰ç”¨çš„å±æ€§ï¼Œå¯ä»¥ç”¨æ¥åŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯ã€‚
*   `statusMessage` (String): ä¸çŠ¶æ€ç å¯¹åº”çš„æ–‡æœ¬æ¶ˆæ¯ (å¦‚ `'Not Found'`, `'Internal Server Error'`)ã€‚
*   `message` (String): æ›´å…·ä½“çš„é”™è¯¯æè¿°ä¿¡æ¯ã€‚
*   `description` (String): é”™è¯¯çš„è¯¦ç»†æè¿°ï¼ˆä¸å¸¸ç”¨ï¼‰ã€‚
*   `data` (Any): é™„åŠ çš„é”™è¯¯æ•°æ®ï¼ˆå¦‚æœé€šè¿‡ `showError` ä¼ é€’äº†ï¼‰ã€‚
*   `stack` (String, **ä»…é™å¼€å‘æ¨¡å¼**): é”™è¯¯çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯ï¼Œç”¨äºè°ƒè¯•ã€‚**ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒæ˜¾ç¤ºï¼**
*   `url` (String): å¯¼è‡´é”™è¯¯çš„åŸå§‹ URL (é€šå¸¸æ˜¯ 404 æ—¶æä¾›)ã€‚

**`clearError` å‡½æ•°ï¼š**

*   å½“ç”¨æˆ·åœ¨é”™è¯¯é¡µé¢ä¸Šæ—¶ï¼Œåº”ç”¨ä»ç„¶å¤„äºâ€œé”™è¯¯çŠ¶æ€â€ã€‚
*   `clearError` æ˜¯ Nuxt æä¾›çš„å…¨å±€è¾…åŠ©å‡½æ•°ï¼Œç”¨äº**æ¸…é™¤è¿™ä¸ªé”™è¯¯çŠ¶æ€**ã€‚
*   é€šå¸¸ä½ ä¼šç»™ç”¨æˆ·æä¾›ä¸€ä¸ªæŒ‰é’®ï¼ˆæ¯”å¦‚â€œè¿”å›é¦–é¡µâ€ï¼‰ï¼Œç‚¹å‡»æ—¶è°ƒç”¨ `clearError` å¹¶**é‡å®šå‘**åˆ°ä¸€ä¸ªå®‰å…¨çš„é¡µé¢ï¼ˆé€šå¸¸æ˜¯é¦–é¡µ `/`ï¼‰ã€‚
*   `clearError({ redirect: '/' })`

**å¦‚ä½•è§¦å‘é”™è¯¯ï¼ˆç”¨äºæµ‹è¯•æˆ–ç¨‹åºé€»è¾‘ï¼‰ï¼š**

*   **404 é”™è¯¯**ï¼šè®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯ç”±å³å¯ã€‚
*   **ç¼–ç¨‹å¼é”™è¯¯**ï¼šåœ¨ä½ çš„é¡µé¢ã€ç»„ä»¶ã€æ’ä»¶æˆ–æœåŠ¡å™¨è·¯ç”±çš„ `<script setup>` æˆ–é€»è¾‘ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ `showError` è¾…åŠ©å‡½æ•°æ¥ä¸»åŠ¨è§¦å‘ä¸€ä¸ªé”™è¯¯ï¼Œå¹¶äº¤ç”± `error.vue` å¤„ç†ã€‚

    ```javascript
    // åœ¨æŸä¸ªé¡µé¢æˆ–ç»„ä»¶ä¸­
    import { showError } from '#app'; // æˆ– #imports

    async function fetchData() {
      try {
        const data = await $fetch('/api/protected-resource');
        // ... å¤„ç†æ•°æ®
      } catch (err) {
        if (err.response?.status === 403) {
          // è§¦å‘ä¸€ä¸ª 403 é”™è¯¯é¡µé¢
          return showError({
            statusCode: 403,
            statusMessage: 'Forbidden',
            message: 'æ‚¨æ²¡æœ‰æƒé™è®¿é—®æ­¤èµ„æºã€‚'
          });
        } else {
          // è§¦å‘ä¸€ä¸ªé€šç”¨çš„ 500 é”™è¯¯é¡µé¢
          return showError({
            statusCode: 500,
            statusMessage: 'Internal Server Error',
            message: 'è·å–æ•°æ®æ—¶å‘ç”ŸæœåŠ¡å™¨é”™è¯¯ã€‚'
          });
        }
      }
    }
    ```

**æ€»ç»“ï¼š**

åˆ›å»º Nuxt 3 è‡ªå®šä¹‰é”™è¯¯é¡µé¢éå¸¸ç®€å•ï¼š

1.  åœ¨é¡¹ç›®**æ ¹ç›®å½•**åˆ›å»º `error.vue` æ–‡ä»¶ã€‚
2.  åœ¨ `error.vue` ä¸­ä½¿ç”¨ `defineProps({ error: Object })` æ¥æ”¶é”™è¯¯ä¿¡æ¯ã€‚
3.  æ ¹æ® `props.error.statusCode` å’Œ `props.error.message` ç­‰å±æ€§æ¥å®šåˆ¶é”™è¯¯æ˜¾ç¤ºã€‚
4.  æä¾›ä¸€ä¸ªæŒ‰é’®ï¼Œè°ƒç”¨ `clearError({ redirect: '...' })` è®©ç”¨æˆ·å¯ä»¥ç¦»å¼€é”™è¯¯é¡µé¢ã€‚
5.  ä½¿ç”¨ `showError(errorObject)` å¯ä»¥åœ¨ä»£ç ä¸­ä¸»åŠ¨è§¦å‘é”™è¯¯å¤„ç†ã€‚

è¿™æ ·ä½ å°±èƒ½ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªç»Ÿä¸€ä¸”ç¬¦åˆåº”ç”¨é£æ ¼çš„é”™è¯¯å¤„ç†ä½“éªŒäº†ã€‚