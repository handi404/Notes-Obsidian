Home.vue
```vue
<template>
  <div class="home">
    <h1>Home</h1>
    <PostList :posts="posts" v-if="showPosts" />
    <button @click="showPosts = !showPosts">toggle posts</button>
    <button @click="posts.pop()">delete a post</button>
  </div>
</template>

<script>
import { computed, watch, ref, watchEffect } from "vue";
import PostList from "../components/PostList.vue";
export default {
  components: {
    PostList,
  },
  setup() {
    const posts = ref([
      {
        title: "welcome to the blog",
        body: "Lorem ipsum dolor, sit amet consectetur adipisicing elit. Minus quo repudiandae labore iusto ut nisi suscipit, mollitia ex, rem id obcaecati consectetur tenetur commodi doloribus facilis rerum autem beatae ab!",
        id: 1,
      },
      { title: "top 5 css tips", body: "Lorem ipsum", id: 2 },
    ]);
    const showPosts = ref(true);
    return {
      posts,
      showPosts,
    };
  },
};
</script>
<style></style>
```
PostList.vue
```vue
<template>
  <div class="post-list">
    <div v-for="post in posts" :key="post.id">
      <SinglePost :post="post" />
    </div>
  </div>
</template>

<script>
import { onMounted, onUnmounted, onUpdated } from "vue";
import SinglePost from "./SinglePost.vue";
export default {
  props: ["posts"],
  components: {
    SinglePost,
  },
  setup(props) {
    onMounted(() => {
      console.log("component mounted");
    });
    onUnmounted(() => {
      console.log("component unmounted");
    });
    onUpdated(() => {
      console.log("component updated");
    });
  },
};
</script>

<style lang="scss" scoped></style>
```

---

# **在 `setup()` 中的生命周期钩子详解**

Vue 3 的组合式 API (`Composition API`) 中，生命周期钩子函数在 `setup()` 中以不同的方式被使用。生命周期钩子用于在组件的不同阶段执行代码，比如组件创建、更新、销毁等。

在 `setup()` 中，可以通过`onX` 系列函数来处理生命周期钩子。

---

## **1. `onBeforeMount`**

`onBeforeMount` 在**组件挂载之前**被调用，**DOM 元素尚未被插入页面**。

### **示例：`onBeforeMount` 使用**

```vue
<script>
import { onBeforeMount } from 'vue';

export default {
  setup() {
    onBeforeMount(() => {
      console.log('组件挂载前');
    });

    return {};
  }
};
</script>
```

### **📌 解析**

- `onBeforeMount` 在组件挂载到 DOM 之前执行，可以用于初始化一些数据，或者执行一些依赖于 DOM 的操作（但此时 DOM 尚未可用）。

---

## **2. `onMounted`**

`onMounted` 在**组件挂载到 DOM 后**被调用，**DOM 元素已被渲染到页面**。

### **示例：`onMounted` 使用**

```vue
<script>
import { onMounted } from 'vue';

export default {
  setup() {
    onMounted(() => {
      console.log('组件挂载后');
    });

    return {};
  }
};
</script>
```

### **📌 解析**

- `onMounted` 可以用于执行**依赖于 DOM 的操作**，比如 DOM 查询、事件绑定等，因为此时组件的 DOM 已经渲染完毕。

---

## **3. `onBeforeUpdate`**

`onBeforeUpdate` 在**组件数据更新之前**被调用，**DOM 尚未更新**。

### **示例：`onBeforeUpdate` 使用**

```vue
<script>
import { onBeforeUpdate } from 'vue';

export default {
  setup() {
    onBeforeUpdate(() => {
      console.log('数据更新前');
    });

    return {};
  }
};
</script>
```

### **📌 解析**

- `onBeforeUpdate` 在组件更新前触发，适合做一些准备工作，比如缓存旧值，或者执行一些数据验证等。

---

## **4. `onUpdated`**

`onUpdated` 在**组件数据更新后**被调用，**DOM 更新完毕**。

### **示例：`onUpdated` 使用**

```vue
<script>
import { onUpdated } from 'vue';

export default {
  setup() {
    onUpdated(() => {
      console.log('数据更新后');
    });

    return {};
  }
};
</script>
```

### **📌 解析**

- `onUpdated` 在组件更新完成后触发，适合用于操作更新后的 DOM，或者执行依赖于组件渲染后的其他任务。

---

## **5. `onBeforeUnmount`**

`onBeforeUnmount` 在**组件卸载之前**被调用，**DOM 尚未被销毁**。

### **示例：`onBeforeUnmount` 使用**

```vue
<script>
import { onBeforeUnmount } from 'vue';

export default {
  setup() {
    onBeforeUnmount(() => {
      console.log('组件卸载前');
    });

    return {};
  }
};
</script>
```

### **📌 解析**

- `onBeforeUnmount` 可以用于清理工作，**解绑事件**、**取消定时器**、**清理网络请求**等，防止内存泄漏。

---

## **6. `onUnmounted`**

`onUnmounted` 在**组件卸载之后**被调用，**DOM 元素已被销毁**。

### **示例：`onUnmounted` 使用**

```vue
<script>
import { onUnmounted } from 'vue';

export default {
  setup() {
    onUnmounted(() => {
      console.log('组件卸载后');
    });

    return {};
  }
};
</script>
```

### **📌 解析**

- `onUnmounted` 用于做组件卸载后的清理工作，通常用于解除定时器、事件监听器等。

---

## **7. `onActivated`**

`onActivated` 在**组件激活时**被调用，通常用于 `keep-alive` 包裹的组件。组件在缓存时会被暂停，而在再次激活时会触发此钩子。

### **示例：`onActivated` 使用**

```vue
<script>
import { onActivated } from 'vue';

export default {
  setup() {
    onActivated(() => {
      console.log('组件激活');
    });

    return {};
  }
};
</script>
```

### **📌 解析**

- `onActivated` 只在组件被 `keep-alive` 缓存并再次激活时触发，适合用来执行在组件显示时的操作。

---

## **8. `onDeactivated`**

`onDeactivated` 在**组件停用时**被调用，通常用于 `keep-alive` 缓存的组件。

### **示例：`onDeactivated` 使用**

```vue
<script>
import { onDeactivated } from 'vue';

export default {
  setup() {
    onDeactivated(() => {
      console.log('组件停用');
    });

    return {};
  }
};
</script>
```

### **📌 解析**

- `onDeactivated` 只在组件被 `keep-alive` 缓存并停用时触发，适合做一些缓存数据的清理工作。

---

## **9. `onErrorCaptured`**

`onErrorCaptured` 用于**捕获子组件的错误**，并处理错误。

### **示例：`onErrorCaptured` 使用**

```vue
<script>
import { onErrorCaptured } from 'vue';

export default {
  setup() {
    onErrorCaptured((err, vm, info) => {
      console.error('捕获错误:', err);
      return false; // 阻止错误继续传播
    });

    return {};
  }
};
</script>
```

### **📌 解析**

- `onErrorCaptured` 可以捕获组件内部或者子组件的错误，返回 `false` 可以阻止错误继续传播。
- 适合用于全局错误处理。

---

## **10. 总结：在 `setup()` 中的生命周期钩子**

|生命周期钩子|说明|触发时机|
|---|---|---|
|`onBeforeMount`|组件挂载前|组件创建完成，尚未挂载到 DOM|
|`onMounted`|组件挂载后|组件挂载到 DOM 后|
|`onBeforeUpdate`|数据更新前|组件更新前|
|`onUpdated`|数据更新后|组件更新后|
|`onBeforeUnmount`|组件卸载前|组件销毁前|
|`onUnmounted`|组件卸载后|组件销毁后|
|`onActivated`|组件激活|组件被 `keep-alive` 缓存并激活|
|`onDeactivated`|组件停用|组件被 `keep-alive` 缓存并停用|
|`onErrorCaptured`|错误捕获|捕获子组件错误|

---

在 `setup()` 中使用这些生命周期钩子，可以帮助你更好地管理组件的生命周期，处理数据变化、DOM 更新、事件绑定与清理等。