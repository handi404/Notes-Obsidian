在 Vue (Vite) 项目中如何配置和使用环境变量。这是一个至关重要的工程化环节。

### 核心理念：配置与代码分离

为什么需要环境变量？

核心目标是**将配置从代码中分离出来**。你的应用在不同环境下（如本地开发、测试服务器、生产环境）会有不同的配置，比如：

*   API 请求的基地址 (Base URL)
*   第三方服务的 API Key
*   开关某些调试功能

如果把这些配置硬编码在代码里，每次部署到不同环境都需要手动修改代码，这非常容易出错且难以维护。环境变量就是解决这个问题的标准方案。

---

### Vite 中的环境变量实践

在以 Vite 为构建工具的 Vue 项目中，环境变量的管理非常简单和强大，它内置了对 `dotenv` 的支持。

#### 1. `.env` 文件

你可以在项目根目录下创建以下文件，Vite 会自动加载它们：

| 文件名 | 用途 | 是否应提交到 Git |
| :--- | :--- | :--- |
| **`.env`** | **所有环境下**都会加载的基础配置。 | **是** |
| **`.env.local`** | **所有环境下**都会加载，但会**覆盖** `.env` 的同名变量。 | **否**（通常用于存放个人配置或敏感信息，应加入 `.gitignore`） |
| **`.env.[mode]`** | **仅在指定模式下**加载。例如 `.env.development`。 | **是** |
| **`.env.[mode].local`**| **仅在指定模式下**加载，但会**覆盖** `.env.[mode]` 的同名变量。 | **否** |

**加载优先级（后面的会覆盖前面的）：**

` .env ` -> ` .env.local ` -> ` .env.[mode] ` -> ` .env.[mode].local `

#### 2. 模式 (Modes)

Vite 有两个基本模式：

*   **`development`**：当你运行 `npm run dev` (即 `vite`) 时使用。
*   **`production`**：当你运行 `npm run build` (即 `vite build`) 时使用。

你可以通过在 `package.json` 的 `scripts` 中添加 `--mode` 标志来创建自定义模式。例如，创建一个 "staging" (预发布) 模式：

```json
// package.json
"scripts": {
  "dev": "vite",
  "build": "vite build",
  "build:staging": "vite build --mode staging", // 新增
  "preview": "vite preview"
},
```
当你运行 `npm run build:staging` 时，Vite 会加载 `.env.staging` 和 `.env.staging.local` 文件。

#### 3. 定义环境变量

在 `.env` 文件中，语法非常简单：`KEY=VALUE`。

**⚠️ 核心规则：** 为了安全起见，Vite **只会将以 `VITE_` 为前缀的变量暴露给客户端代码**。这是为了防止意外地将服务器端的敏感密钥（如数据库密码）泄露到前端。

**示例文件结构：**

```
.
├── .env
├── .env.development
├── .env.production
├── .gitignore
└── package.json
```

**`.env`** (基础配置，所有环境共享)
```
VITE_APP_TITLE=My Awesome App
```

**`.env.development`** (仅开发环境)
```
VITE_API_BASE_URL=http://localhost:8080/api
```

**`.env.production`** (仅生产环境)
```
VITE_API_BASE_URL=https://api.myapp.com/v1
```

**`.gitignore`** (确保不提交本地配置)
```
# ...其他忽略项
.env.local
.env.*.local
```

#### 4. 在代码中使用环境变量

在你的 Vue 组件或任何 TypeScript/JavaScript 文件中，通过 `import.meta.env` 对象来访问。

```vue
<script setup lang="ts">
// 获取环境变量
const apiUrl = import.meta.env.VITE_API_BASE_URL;
const appTitle = import.meta.env.VITE_APP_TITLE;

console.log(`API Base URL is: ${apiUrl}`); // 根据环境输出不同值
console.log(`App Title is: ${appTitle}`);   // 输出 "My Awesome App"

// 假设有一个 useFetch 的 composable
// useFetch(`${apiUrl}/users`);
</script>

<template>
  <h1>{{ appTitle }}</h1>
</template>
```

#### 5. 结合 TypeScript (实现类型安全)

默认情况下，TypeScript 并不知道 `import.meta.env` 上有哪些自定义的变量，直接使用会报类型错误。我们需要为它提供类型定义。

在你的 `src` 目录下，通常会有一个 `vite-env.d.ts` 文件（如果脚手架没有自动创建，可以手动创建）。修改它，扩充 `ImportMetaEnv` 接口：

```typescript
// src/vite-env.d.ts

/// <reference types="vite/client" />

interface ImportMetaEnv {
  readonly VITE_APP_TITLE: string;
  readonly VITE_API_BASE_URL: string;
  // 在这里添加你所有 VITE_ 开头的环境变量的类型定义
}

interface ImportMeta {
  readonly env: ImportMetaEnv;
}
```

**这样做的好处：**

1.  **类型检查**：如果你拼错了变量名（例如 `import.meta.env.VITE_API_URL`），TypeScript 会立即报错。
2.  **自动补全**：在编辑器中输入 `import.meta.env.` 时，VSCode 会智能提示出你定义的所有环境变量。

---

### 总结与要点

1.  **文件命名**：使用 `.env`, `.env.[mode]` 的标准命名。
2.  **`VITE_` 前缀**：**必须**给所有想在前端代码中访问的变量加上 `VITE_` 前缀。
3.  **访问方式**：使用 `import.meta.env.VARIABLE_NAME`。
4.  **类型安全**：在 `vite-env.d.ts` 文件中扩展 `ImportMetaEnv` 接口，为你的环境变量提供类型定义。
5.  **安全性**：绝不要将 API Key、密码等敏感信息提交到 Git 仓库。将它们存放在 `.env.local` 或 `.env.[mode].local` 文件中，并确保这些文件已被添加到 `.gitignore`。
6.  **重启服务**：当你修改了 `.env` 文件后，需要**重新启动 Vite 开发服务器** (`npm run dev`) 才能让新的配置生效。Vite 不会热重载 `.env` 文件的变更。
7.  **构建时替换**：Vite 在构建项目时（`npm run build`），会将代码中所有 `import.meta.env.VITE_*` 的引用直接替换为其对应的**静态字符串值**。这意味着它不是一个真正的运行时对象，而是一个编译时特性。