## C++ 析构函数

### 什么是析构函数？

析构函数是与构造函数相对应的一种特殊成员函数，它的作用是在对象被销毁之前执行一些清理工作。当一个对象超出其作用域或者被显式删除时，系统会自动调用该对象的析构函数。

### 析构函数的语法

```C++
~类名() {
    // 析构函数的函数体
}
```

- **~类名：** 析构函数的名字与类名相同，但前面加了一个波浪号 (~) 来表示。
- **函数体：** 这里放置需要在对象销毁前执行的代码，比如释放动态分配的内存、关闭文件等。

### 析构函数的特点

- **自动调用：** 当对象超出作用域或被 delete 时，析构函数会自动调用，无需手动触发。
- **没有返回值：** 析构函数没有返回值类型。
- **不能被重载：** 一个类只能有一个析构函数。
- **不能被继承：** 派生类不继承基类的析构函数。

### 析构函数的作用

- **释放资源：** 析构函数的主要目的是释放对象在生命周期内申请的资源，比如动态分配的内存、打开的文件等。
- **清理数据：** 可以执行一些清理工作，比如关闭连接、清除临时文件等。
- **调用基类析构函数：** 如果派生类有基类，派生类的析构函数会自动调用基类的析构函数。

### 析构函数的示例

```C++
#include <iostream>

class MyClass {
public:
    MyClass() {
        std::cout << "构造函数" << std::endl;
        ptr = new int(10);
    }
    ~MyClass() {
        std::cout << "析构函数" << std::endl;
        delete ptr;
    }
private:
    int *ptr;
};

int main() {
    MyClass obj; // 创建对象
}
```

在这个例子中，当 `obj` 超出作用域时，它的析构函数会被自动调用，释放动态分配的内存。

### 虚析构函数

- **作用：** 当基类指针指向派生类对象时，确保调用正确的析构函数。
- **语法：** 在基类的析构函数前加上 virtual 关键字。
- **示例：**

```C++
class Base {
public:
    virtual ~Base() {
        std::cout << "Base 析构函数" << std::endl;
    }
};

class Derived : public Base {
public:
    ~Derived() {
        std::cout << "Derived 析构函数" << std::endl;
    }
};
```

### 总结

析构函数是 C++ 中非常重要的一个概念，它保证了对象在生命周期结束时能正确地释放资源。在编写 C++ 程序时，尤其是在涉及到动态内存分配和资源管理时，一定要注意析构函数的使用。

**常见问题：**

- **析构函数的调用顺序：** 当一个对象被销毁时，其成员对象的析构函数会先被调用，然后才是该对象的析构函数。如果该对象是一个派生类对象，那么基类的析构函数会在派生类的析构函数之前调用。
- **析构函数和 RAII：** RAII（Resource Acquisition Is Initialization）是一种资源管理技术，它将资源的获取与对象的生存期绑定在一起，通过析构函数来释放资源。